<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="本篇是Android群英传的读书笔记。涵盖了一下的内容：

Android体系与系统架构
Android开发工具新接触
Android控件架构与自定义控件详解
ListView使用技巧
Android Scroller分析
Android绘制机制与处理技巧
Android动画机制与使用技巧
Activity与Activity调用栈分析
Android系统信息与安全机制
Android性能优化
An">
<meta name="keywords">
<meta property="og:type" content="website">
<meta property="og:title" content="Android群英传读书笔记">
<meta property="og:url" content="http://chenfuduo.cn/techrecord/Android群英传读书笔记.html">
<meta property="og:site_name" content="chenfuduo">
<meta property="og:description" content="本篇是Android群英传的读书笔记。涵盖了一下的内容：

Android体系与系统架构
Android开发工具新接触
Android控件架构与自定义控件详解
ListView使用技巧
Android Scroller分析
Android绘制机制与处理技巧
Android动画机制与使用技巧
Activity与Activity调用栈分析
Android系统信息与安全机制
Android性能优化
An">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/viewgroup.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/UIFramework_%E5%89%AF%E6%9C%AC.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/MotionEvent.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/listviewewxtension.gif">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/androidzuobiao.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/layoutzuobiaoxi.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/20150115155321445.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/02a266556d6bd20000016b62fbb2ec.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/024dc5556d6bbb0000016b62bbcfca.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/4379274283332372.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160309152958.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160309153018.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160309153027.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/119382253878632655.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/868361883326946341.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/82765487251827052.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/385029250006128362.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/651940980052885974.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/901854896512497535.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/716746336819656539.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/603693274204448598.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/494707027301025081.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/20160120092932372.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/297288634849395096.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/353223673934444001.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/153428206998797874.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/602647945883516863.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/368792901625564032.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/130363963826656789.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/422970989822569566.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/530942805244665603.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/S60129-161610.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/223678467572715827.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160311142903.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/svganim.gif">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/proanim.gif">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/proanim.gif">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/propanimview.gif">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/0_1314838777He6C.gif">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/basic-lifecycle.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/54b4b55d0001b4a705000281.jpg">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/androidheros_gpu.png">
<meta property="og:image" content="http://7xljei.com1.z0.glb.clouddn.com/androidheros_overdraw.png">
<meta property="og:updated_time" content="2016-03-15T13:01:17.546Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android群英传读书笔记">
<meta name="twitter:description" content="本篇是Android群英传的读书笔记。涵盖了一下的内容：

Android体系与系统架构
Android开发工具新接触
Android控件架构与自定义控件详解
ListView使用技巧
Android Scroller分析
Android绘制机制与处理技巧
Android动画机制与使用技巧
Activity与Activity调用栈分析
Android系统信息与安全机制
Android性能优化
An">
<meta name="twitter:image" content="http://7xljei.com1.z0.glb.clouddn.com/viewgroup.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://chenfuduo.cn/techrecord/Android群英传读书笔记.html"/>





  <title>
  

  
    Android群英传读书笔记 | chenfuduo
  
</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?63c029dba1e367df2c8ffa39a309056a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left  ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">chenfuduo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">纸上得来终觉浅,绝知此事要躬行。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestmessage" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-comment"></i> <br />
            
            留言
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-favorites">
          <a href="/favorites" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            收藏
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
  <header class="post-header">

	<h2 class="post-title" itemprop="name headline">Android群英传读书笔记</h2>



</header>

    
    
      <p>本篇是Android群英传的读书笔记。涵盖了一下的内容：</p>
<ul>
<li>Android体系与系统架构</li>
<li>Android开发工具新接触</li>
<li>Android控件架构与自定义控件详解</li>
<li>ListView使用技巧</li>
<li>Android Scroller分析</li>
<li>Android绘制机制与处理技巧</li>
<li>Android动画机制与使用技巧</li>
<li>Activity与Activity调用栈分析</li>
<li>Android系统信息与安全机制</li>
<li>Android性能优化</li>
<li>Android新特性</li>
</ul>
<p>此为第一遍,后续会再读一遍,结合github的实例去学习。</p>
<a id="more"></a>
<h1 id="Android体系与系统架构"><a href="#Android体系与系统架构" class="headerlink" title="Android体系与系统架构"></a>Android体系与系统架构</h1><h2 id="Dalvik与ART"><a href="#Dalvik与ART" class="headerlink" title="Dalvik与ART"></a>Dalvik与ART</h2><p>总体来说,Dalvik的特点是在运行时编译,而ART是在安装时编译。</p>
<p>ART的新特征体现在下面的三点：</p>
<ul>
<li>Ahead-of-time (AOT) compilation</li>
<li>Improved garbage collection (GC)</li>
<li>Improved debugging support</li>
</ul>
<p>可参考：</p>
<p><a href="https://source.android.com/devices/tech/dalvik/index.html" target="_blank" rel="external">ART and Dalvik</a><br><a href="http://developer.android.com/about/versions/android-5.0-changes.html" target="_blank" rel="external">Android 5.0 Behavior Changes</a></p>
<h2 id="应用运行上下文对象"><a href="#应用运行上下文对象" class="headerlink" title="应用运行上下文对象"></a>应用运行上下文对象</h2><p>此处指Context,Android中的Activity,Service,Application均继承自Context.<br>关于Context,可以参考这里:<br><a href="http://blog.csdn.net/guolin_blog/article/details/47028975" target="_blank" rel="external">Android Context完全解析,你所不知道的Context的各种细节 </a></p>
<h1 id="Android开发工具新接触"><a href="#Android开发工具新接触" class="headerlink" title="Android开发工具新接触"></a>Android开发工具新接触</h1><h2 id="导入Android-Studio项目"><a href="#导入Android-Studio项目" class="headerlink" title="导入Android Studio项目"></a>导入Android Studio项目</h2><p>有时候导入项目到Android Studio的时候,由于Gradle版本的不同,会带来一些问题,这样导入可以解决Gradle版本的不同带来的一些问题。</p>
<p>首先在本地用当前版本的Gradle创建一个正常的项目,保证可以正常编译通过即可,然后用本地项目的<code>gradle文件夹</code>和<code>build.gradle</code>文件去替换要导入项目中的这两个。即可。</p>
<p>2016-03-02更正：<br>最好别使用这个方法,否则可能会遇到很麻烦的问题。</p>
<h1 id="Android控件架构与自定义控件详解"><a href="#Android控件架构与自定义控件详解" class="headerlink" title="Android控件架构与自定义控件详解"></a>Android控件架构与自定义控件详解</h1><h2 id="Android控件架构"><a href="#Android控件架构" class="headerlink" title="Android控件架构"></a>Android控件架构</h2><p>Android系统中的所有UI类都是建立在View和ViewGroup这两个类的基础上的。所有View的子类成为”Widget”,所有ViewGroup的子类成为”Layout”。<br>View和ViewGroup之间采用了<code>组合设计模式</code>,可以使得”部分-整体”同等对待。ViewGroup作为布局容器类的最上层,<br>布局容器里面又可以有View和ViewGroup。如下图：</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/viewgroup.png" alt="View树结构"></p>
<p>其中,ViewParent是个接口,ViewGroup实现了该接口。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/UIFramework_%E5%89%AF%E6%9C%AC.png" alt="UI界面架构图"></p>
<p>当我们运行程序的时候,有一个setContentView()方法,Activity其实不是显示视图（直观上感觉是它）,实际上Activity调用了<br>PhoneWindow的setContentView()方法,然后加载视图,将视图放到这个Window上,而Activity其实构造的时候初始化的是Window（PhoneWindow）,<br>Activity其实是个控制单元,即可视的人机交互界面。打个比喻：</p>
<p>Activity是一个工人,它来控制Window;Window是一面显示屏,用来显示信息;View就是要显示在显示屏上的信息,<br>这些View都是层层重叠在一起（通过infalte()和addView()）放到Window显示屏上的。<br>而LayoutInfalter就是用来生成View的一个工具,XML布局文件就是用来生成View的原料。再来说说代码中具体的执行流程</p>
<p><code>setContentView(R.layout.main)</code>其实就是下面内容。（注释掉本行执行下面的代码可以更直观）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getWindow().setContentView(LayoutInflater.from(<span class="keyword">this</span>).inflate(R.layout.main, <span class="keyword">null</span>));</div></pre></td></tr></table></figure>
<p>即运行程序后,Activity会调用PhoneWindow的setContentView()来生成一个Window,<br>而此时的setContentView就是那个最底层的View。然后通过LayoutInflater.infalte()方法加载布局生成View对象并通过addView()方法<br>添加到Window上,(一层一层的叠加到Window上)。</p>
<p>所以,Activity其实不是显示视图,View才是真正的显示视图。</p>
<p>注：一个Activity构造的时候只能初始化一个Window(PhoneWindow),<br>另外这个PhoneWindow有一个”ViewRoot”,这个”ViewRoot”是一个View或ViewGroup,是最初始的根视图,然后通过addView方法将View一个个层叠到ViewRoot上,这些层叠的View最终放在Window这个载体上面。</p>
<p>当程序在onCreate方法中调用setContentView方法后,ams会回调onResume方法,此时系统才会把整个DecorView添加到PhoneWindow中,并让其显示,从而最终完成界面的绘制。</p>
<h2 id="View的测量"><a href="#View的测量" class="headerlink" title="View的测量"></a>View的测量</h2><p>下面的代码,可以说是通用的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewonmeasure;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/2/29.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        setMeasuredDimension(measureWidth(widthMeasureSpec), measureHeight(heightMeasureSpec));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">measureHeight</span><span class="params">(<span class="keyword">int</span> measureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> result;</div><div class="line">        <span class="keyword">int</span> mode = MeasureSpec.getMode(measureSpec);</div><div class="line">        <span class="keyword">int</span> size = MeasureSpec.getSize(measureSpec);</div><div class="line">        <span class="keyword">if</span> (mode == MeasureSpec.EXACTLY) &#123;</div><div class="line">            result = size;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            result = <span class="number">200</span>;</div><div class="line">            <span class="keyword">if</span> (mode == MeasureSpec.AT_MOST) &#123;</div><div class="line">                result = Math.min(result, size);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">measureWidth</span><span class="params">(<span class="keyword">int</span> measureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> result;</div><div class="line">        <span class="keyword">int</span> mode = MeasureSpec.getMode(measureSpec);</div><div class="line">        <span class="keyword">int</span> size = MeasureSpec.getSize(measureSpec);</div><div class="line">        <span class="keyword">if</span> (mode == MeasureSpec.EXACTLY) &#123;</div><div class="line">            result = size;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            result = <span class="number">200</span>;</div><div class="line">            <span class="keyword">if</span> (mode == MeasureSpec.AT_MOST) &#123;</div><div class="line">                result = Math.min(size, result);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="自定义控件"><a href="#自定义控件" class="headerlink" title="自定义控件"></a>自定义控件</h2><p>自定义控件的时候遇到一个问题,详见<a href="http://chenfuduo.me/2016/03/01/onMeasure%E6%89%A7%E8%A1%8C%E6%AC%A1%E6%95%B0%E7%9A%84%E9%97%AE%E9%A2%98/" target="_blank" rel="external">这里</a></p>
<p>这个问题所有的讨论在<a href="https://github.com/android-cn/android-discuss/issues/386" target="_blank" rel="external">这里</a>可以看到。</p>
<p>这个问题在性能优化上可以用的到。</p>
<h2 id="自定义ViewGroup"><a href="#自定义ViewGroup" class="headerlink" title="自定义ViewGroup"></a>自定义ViewGroup</h2><p>这里只提Scroller的用法。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.scrollerdemo;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="keyword">final</span> LinearLayout ll = (LinearLayout) findViewById(R.id.ll);</div><div class="line">        <span class="keyword">final</span> Button by = (Button) findViewById(R.id.by);</div><div class="line">        by.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="comment">//相对于上一次</span></div><div class="line">                ll.scrollBy(-<span class="number">60</span>, -<span class="number">100</span>);</div><div class="line">                <span class="keyword">int</span> scrollY = ll.getScrollY();</div><div class="line">                <span class="keyword">int</span> scrollX = ll.getScrollX();</div><div class="line">                <span class="comment">//向右,向下均为负,其他相反</span></div><div class="line">                Log.e(TAG, <span class="string">"scrollY: "</span> + scrollY);</div><div class="line">                Log.e(TAG, <span class="string">"scrollX: "</span> + scrollX);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        <span class="keyword">final</span> Button to = (Button) findViewById(R.id.to);</div><div class="line">        to.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                ll.scrollTo(-<span class="number">60</span>, -<span class="number">100</span>);</div><div class="line">                <span class="keyword">int</span> scrollY = ll.getScrollY();</div><div class="line">                Log.e(TAG, <span class="string">"onClick: "</span> + scrollY);</div><div class="line">                <span class="keyword">int</span> scrollX = ll.getScrollX();</div><div class="line">                Log.e(TAG, <span class="string">"scrollY: "</span> + scrollY);</div><div class="line">                Log.e(TAG, <span class="string">"scrollX: "</span> + scrollX);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>几个容易混淆的方法,参见代码的注释。参考：<br><a href="http://blog.csdn.net/xiaoguochang/article/details/8655210" target="_blank" rel="external">scrollTo、scrollBy、getScrollX、getScrollY这4个方法的含义</a><br><a href="http://www.xuebuyuan.com/2013505.html" target="_blank" rel="external">关于View的ScrollTo, getScrollX 和 getScrollY</a><br><a href="http://blog.csdn.net/bigconvience/article/details/26697645" target="_blank" rel="external">图解Android View的scrollTo(),scrollBy(),getScrollX(), getScrollY()</a></p>
<p>这里实现一个类似AndroidScrollView的自定义ViewGroup。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.customviewgroup_01;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.util.DisplayMetrics;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.view.WindowManager;</div><div class="line"><span class="keyword">import</span> android.widget.Scroller;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/3.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewGroup</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MyViewGroup"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mScreenHeight;</div><div class="line">    <span class="keyword">private</span> Scroller mScroller;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLastY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mStart;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewGroup</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        initView(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewGroup</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        initView(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewGroup</span><span class="params">(Context context, AttributeSet attrs,</span></span></div><div class="line">                        <span class="keyword">int</span> defStyleAttr) &#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        initView(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        WindowManager wm = (WindowManager) context.getSystemService(</div><div class="line">                Context.WINDOW_SERVICE);</div><div class="line">        DisplayMetrics dm = <span class="keyword">new</span> DisplayMetrics();</div><div class="line">        wm.getDefaultDisplay().getMetrics(dm);</div><div class="line">        mScreenHeight = dm.heightPixels;</div><div class="line">        mScroller = <span class="keyword">new</span> Scroller(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed,</span></span></div><div class="line">                            <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b) &#123;</div><div class="line">        <span class="keyword">int</span> childCount = getChildCount();</div><div class="line">        <span class="comment">// 设置ViewGroup的高度</span></div><div class="line">        MarginLayoutParams mlp = (MarginLayoutParams) getLayoutParams();</div><div class="line">        mlp.height = mScreenHeight * childCount;</div><div class="line">        setLayoutParams(mlp);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">            View child = getChildAt(i);</div><div class="line">            <span class="keyword">if</span> (child.getVisibility() != View.GONE) &#123;</div><div class="line">                child.layout(l, i * mScreenHeight,</div><div class="line">                        r, (i + <span class="number">1</span>) * mScreenHeight);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec,</span></span></div><div class="line">                             <span class="keyword">int</span> heightMeasureSpec) &#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> count = getChildCount();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; ++i) &#123;</div><div class="line">            View childView = getChildAt(i);</div><div class="line">            measureChild(childView,</div><div class="line">                    widthMeasureSpec, heightMeasureSpec);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                mLastY = y;</div><div class="line">                mStart = getScrollY();</div><div class="line"></div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">if</span> (!mScroller.isFinished()) &#123;</div><div class="line">                    mScroller.abortAnimation();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">int</span> dy = mLastY - y;</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: MotionEvent.ACTION_MOVE-getScrollY()="</span> + getScrollY());</div><div class="line">                <span class="keyword">if</span> (getScrollY() &lt; <span class="number">0</span>) &#123;</div><div class="line">                    dy = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (getScrollY() &gt; getHeight() - mScreenHeight) &#123;</div><div class="line">                    dy = <span class="number">0</span>;</div><div class="line">                &#125;</div><div class="line">                scrollBy(<span class="number">0</span>, dy);</div><div class="line">                mLastY = y;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="keyword">int</span> dScrollY = checkAlignment();</div><div class="line">                <span class="keyword">if</span> (dScrollY &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (dScrollY &lt; mScreenHeight / <span class="number">3</span>) &#123;</div><div class="line">                        mScroller.startScroll(</div><div class="line">                                <span class="number">0</span>, getScrollY(),</div><div class="line">                                <span class="number">0</span>, -dScrollY);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        mScroller.startScroll(</div><div class="line">                                <span class="number">0</span>, getScrollY(),</div><div class="line">                                <span class="number">0</span>, mScreenHeight - dScrollY);</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">if</span> (-dScrollY &lt; mScreenHeight / <span class="number">3</span>) &#123;</div><div class="line">                        mScroller.startScroll(</div><div class="line">                                <span class="number">0</span>, getScrollY(),</div><div class="line">                                <span class="number">0</span>, -dScrollY);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        mScroller.startScroll(</div><div class="line">                                <span class="number">0</span>, getScrollY(),</div><div class="line">                                <span class="number">0</span>, -mScreenHeight - dScrollY);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        postInvalidate();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">checkAlignment</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> mEnd = getScrollY();</div><div class="line">        <span class="keyword">boolean</span> isUp = ((mEnd - mStart) &gt; <span class="number">0</span>) ? <span class="keyword">true</span> : <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">int</span> lastPrev = mEnd % mScreenHeight;</div><div class="line">        <span class="keyword">int</span> lastNext = mScreenHeight - lastPrev;</div><div class="line">        <span class="keyword">if</span> (isUp) &#123;</div><div class="line">            <span class="comment">//向上的</span></div><div class="line">            <span class="keyword">return</span> lastPrev;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> -lastNext;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.computeScroll();</div><div class="line">        <span class="keyword">if</span> (mScroller.computeScrollOffset()) &#123;</div><div class="line">            scrollTo(<span class="number">0</span>, mScroller.getCurrY());</div><div class="line">            postInvalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">me.jarvischen.customviewgroup_01.MyViewGroup</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/test1"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/test2"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/test3"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/test4"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">me.jarvischen.customviewgroup_01.MyViewGroup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>关于Scroller的用法,参考这个文章。</p>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/48719871" target="_blank" rel="external">Android Scroller完全解析,关于Scroller你所需知道的一切 </a></p>
<h2 id="事件拦截机制分析"><a href="#事件拦截机制分析" class="headerlink" title="事件拦截机制分析"></a>事件拦截机制分析</h2><p>事件拦截机制,这里只是做了简单的分析。</p>
<p>为了方便了解整个事件传递的机制,我们设计一个场景：</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/MotionEvent.png" alt="事件拦截机制分析"></p>
<p>角色：</p>
<ul>
<li>一个经理：MotionEventViewGroupA,最外层的ViewGroupA;</li>
<li>一个组长：MotionEventViewGroupB,中间的ViewGroupB;</li>
<li>一个你：MotionEventViewC,最底层的码农</li>
</ul>
<p>模拟：<br>经理分派任务,下属处理这个任务的过程。</p>
<p>MotionEventViewGroupA</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MotionEventViewGroupA</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewGroupA</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewGroupA</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewGroupA</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewGroupA dispatchTouchEventA"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewGroupA onInterceptTouchEventA"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewGroupA onTouchEventA"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MotionEventViewGroupB</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MotionEventViewGroupB</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewGroupB</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewGroupB</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewGroupB</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewGroupB dispatchTouchEventB"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewGroupB onInterceptTouchEventB"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewGroupB onTouchEventB"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MotionEventViewC</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MotionEventViewC</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewC</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewC</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MotionEventViewC</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewC dispatchTouchEventC"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"cfd"</span>, <span class="string">"MotionEventViewC onTouchEventC"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(event);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">me.jarvischen.motionevent.MotionEventViewGroupA</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@android:color/holo_orange_dark"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">me.jarvischen.motionevent.MotionEventViewGroupB</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"300dp"</span></div><div class="line">            <span class="attr">android:background</span>=<span class="string">"@android:color/holo_purple"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"center"</span>&gt;</div><div class="line"></div><div class="line">            <span class="tag">&lt;<span class="name">me.jarvischen.motionevent.MotionEventViewC</span></span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"200dp"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">                <span class="attr">android:background</span>=<span class="string">"@android:color/holo_green_dark"</span></div><div class="line">                <span class="attr">android:gravity</span>=<span class="string">"center"</span> /&gt;</div><div class="line">        <span class="tag">&lt;/<span class="name">me.jarvischen.motionevent.MotionEventViewGroupB</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">me.jarvischen.motionevent.MotionEventViewGroupA</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ViewGroup级别比较高,比View多一个onInterceptTouchEvent（拦截）。</p>
<p>情景分析<br>不做任何修改,点击MotionEventViewC</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">MotionEventViewGroupA dispatchTouchEventA</div><div class="line">MotionEventViewGroupA onInterceptTouchEventA</div><div class="line">MotionEventViewGroupB dispatchTouchEventB</div><div class="line">MotionEventViewGroupB onInterceptTouchEventB</div><div class="line">MotionEventViewC dispatchTouchEventC</div><div class="line">MotionEventViewC onTouchEventC</div><div class="line">MotionEventViewGroupB onTouchEventB</div><div class="line">MotionEventViewGroupA onTouchEventA</div></pre></td></tr></table></figure>
<p>log信息看出,正常情况,事件传递顺序：<br>经理 –&gt; 组长 –&gt; 你,先执行dispatchTouchEvent（分发）,再执行onInterceptTouchEvent（拦截）</p>
<p>事件处理顺序：<br>你 –&gt; 组长 –&gt; 经理,事件处理都是执行onTouchEvent（处理）。</p>
<p>事件传递返回值：true,拦截,交给自己的onTouchEvent处理;false,不拦截,传给下属。</p>
<p>事件处理返回值：true,自己搞定,不用上报上司;false,上报上司处理。</p>
<p>初始返回都是false。</p>
<p>事件传递,dispatchTouchEvent一般不太会重写,只关心onInterceptTouchEvent。</p>
<p>经理觉得这个任务太简单,自己处理</p>
<p>即MotionEventViewGroupA里onInterceptTouchEvent返回true,我们看下log信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MotionEventViewGroupA dispatchTouchEventA</div><div class="line">MotionEventViewGroupA onInterceptTouchEventA</div><div class="line">MotionEventViewGroupA onTouchEventA</div></pre></td></tr></table></figure>
<p>经理一个人干完了,没下面的人什么事了。<br>组长觉得这个任务太简单,自己处理</p>
<p>即MotionEventViewGroupB里onInterceptTouchEvent返回true,我们看下log信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">MotionEventViewGroupA dispatchTouchEventA</div><div class="line">MotionEventViewGroupA onInterceptTouchEventA</div><div class="line">MotionEventViewGroupB dispatchTouchEventB</div><div class="line">MotionEventViewGroupB onInterceptTouchEventB</div><div class="line">MotionEventViewGroupB onTouchEventB</div><div class="line">MotionEventViewGroupA onTouchEventA</div></pre></td></tr></table></figure>
<p>组长干完了活,没你啥事了。以上对事件的分发、拦截的分析。<br>你迫于压力,辞职不干了,任务闲置</p>
<p>即MotionEventViewC里onTouchEvent返回true,我们看下log信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">MotionEventViewGroupA dispatchTouchEventA</div><div class="line">MotionEventViewGroupA onInterceptTouchEventA</div><div class="line">MotionEventViewGroupB dispatchTouchEventB</div><div class="line">MotionEventViewGroupB onInterceptTouchEventB</div><div class="line">MotionEventViewC dispatchTouchEventC</div><div class="line">MotionEventViewC onTouchEventC</div></pre></td></tr></table></figure>
<p>事件处理到你这里就结束了。<br>组长觉得你任务完成太烂,不敢上报</p>
<p>即MotionEventViewB里onTouchEvent返回true,我们看下log信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MotionEventViewGroupA dispatchTouchEventA</div><div class="line">MotionEventViewGroupA onInterceptTouchEventA</div><div class="line">MotionEventViewGroupB dispatchTouchEventB</div><div class="line">MotionEventViewGroupB onInterceptTouchEventB</div><div class="line">MotionEventViewC dispatchTouchEventC</div><div class="line">MotionEventViewC onTouchEventC</div><div class="line">MotionEventViewGroupB onTouchEventB</div></pre></td></tr></table></figure>
<p>事件处理经过你和组长,到组长那里就结束了。</p>
<p>具体的参考这里的博客。</p>
<ul>
<li><a href="http://blog.csdn.net/guolin_blog/article/details/9097463" target="_blank" rel="external">Android事件分发机制完全解析,带你从源码的角度彻底理解(上)</a></li>
<li><a href="http://blog.csdn.net/guolin_blog/article/details/9153747" target="_blank" rel="external">Android事件分发机制完全解析,带你从源码的角度彻底理解(下)</a></li>
</ul>
<h1 id="Android-ListView使用技巧"><a href="#Android-ListView使用技巧" class="headerlink" title="Android ListView使用技巧"></a>Android ListView使用技巧</h1><p>在Android应用中,ListView作为列表展示的控件,是一个很常用的控件。在大量场合下,我们都会用到这个控件,整理一下常用的技巧。</p>
<h2 id="ListView常用技巧"><a href="#ListView常用技巧" class="headerlink" title="ListView常用技巧"></a>ListView常用技巧</h2><h3 id="使用ViewHolder模式提高效率"><a href="#使用ViewHolder模式提高效率" class="headerlink" title="使用ViewHolder模式提高效率"></a>使用ViewHolder模式提高效率</h3><p>ViewHolder模式充分利用ListView的视图缓存机制,避免了每次调用getView()的时候都去通过findViewById()实例化控件。<br>效率与不使用相比,效率提高50%以上。只需要在自定义Adapter中定义内部ViewHolder类,代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</div><div class="line">    ViewHolder viewHolder = <span class="keyword">null</span>;</div><div class="line">    <span class="comment">//判断是否缓存</span></div><div class="line">    <span class="keyword">if</span>(convertView == <span class="keyword">null</span>)&#123;</div><div class="line">        convertView = inflater.inflate(R.layout.listitem, parent, <span class="keyword">false</span>);</div><div class="line">        viewHolder = <span class="keyword">new</span> ViewHolder();</div><div class="line">        viewHolder.tv = (TextView) convertView.findViewById(R.id.tv);</div><div class="line">        viewHolder.img = (ImageView) convertView.findViewById(R.id.img);</div><div class="line">        viewHolder.btn =(Button) convertView.findViewById(R.id.btn);</div><div class="line">        convertView.setTag(viewHolder);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="comment">//通过tag找到缓存的布局</span></div><div class="line">        viewHolder = (ViewHolder) convertView.getTag();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> convertView;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span></span>&#123;</div><div class="line">    <span class="keyword">public</span> TextView tv;</div><div class="line">    <span class="keyword">public</span> ImageView img;</div><div class="line">    <span class="keyword">public</span> Button btn;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="设置分割线"><a href="#设置分割线" class="headerlink" title="设置分割线"></a>设置分割线</h3><p>xml中<br>//设置分割线透明,一般在item用view设置自己的分割线<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:divider="@null"</div></pre></td></tr></table></figure></p>
<p>//代码中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">listView.setDivider(Drawable);</div></pre></td></tr></table></figure>
<h3 id="设置ListView的item点击效果"><a href="#设置ListView的item点击效果" class="headerlink" title="设置ListView的item点击效果"></a>设置ListView的item点击效果</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//xml中设置item点击效果为透明</div><div class="line">android:listSelector="@android:color/transparent"</div><div class="line">//设置item的BackGround为自己想要的点击效果</div></pre></td></tr></table></figure>
<h3 id="设置ListView显示在第几项"><a href="#设置ListView显示在第几项" class="headerlink" title="设置ListView显示在第几项"></a>设置ListView显示在第几项</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//类似scrollTo瞬间移动完成</span></div><div class="line">listView.setSelection(<span class="keyword">int</span> );</div><div class="line"><span class="comment">//平滑移动</span></div><div class="line">listView.smoothScrollByOffset(offset);</div><div class="line">listView.smoothScrollBy(distance, duration);</div><div class="line">listView.smoothScrollToPosition(position);</div></pre></td></tr></table></figure>
<h3 id="动态修改ListView"><a href="#动态修改ListView" class="headerlink" title="动态修改ListView"></a>动态修改ListView</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//当数据源改变时,只需要调用此方法即可改变ListView展示的内容</span></div><div class="line">adapter.notifyDataSetChanged();</div></pre></td></tr></table></figure>
<h3 id="遍历ListView中的所有Item"><a href="#遍历ListView中的所有Item" class="headerlink" title="遍历ListView中的所有Item"></a>遍历ListView中的所有Item</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;listView.getChildCount();i++)&#123;</div><div class="line">            View view = listView.getChildAt(i);</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<h3 id="处理空ListView"><a href="#处理空ListView" class="headerlink" title="处理空ListView"></a>处理空ListView</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- ListView 空视图必须跟ListView放在一起 --&gt;</span></div><div class="line"></div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span> &gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:divider</span>=<span class="string">"@null"</span></div><div class="line">        <span class="attr">android:listSelector</span>=<span class="string">"@android:color/transparent"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/empty"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/ic_launcher"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 代码中设置,有数据时不会显示,没有时才显示 --&gt;</div><div class="line"></div><div class="line">listView.setEmptyView(View);</div></pre></td></tr></table></figure>
<h2 id="ListView滑动监听"><a href="#ListView滑动监听" class="headerlink" title="ListView滑动监听"></a>ListView滑动监听</h2><h3 id="OnTouchListener"><a href="#OnTouchListener" class="headerlink" title="OnTouchListener"></a>OnTouchListener</h3><p>通过坐标判断用户滑动的方向,并进行相应的逻辑处理。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">listView.setOnTouchListener(<span class="keyword">new</span> OnTouchListener() &#123;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line">                <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                <span class="comment">//触摸时逻辑</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="comment">//移动时逻辑</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="comment">//离开时逻辑</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure></p>
<h3 id="OnScrollListener"><a href="#OnScrollListener" class="headerlink" title="OnScrollListener"></a>OnScrollListener</h3><p>既是对ListView滑动状态的监听,常用的方法代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">listView.setOnScrollListener(<span class="keyword">new</span> OnScrollListener() &#123;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(ZrcAbsListView view, <span class="keyword">int</span> scrollState)</span> </span>&#123;</div><div class="line">                <span class="keyword">switch</span>(scrollState)&#123;</div><div class="line">                <span class="keyword">case</span> SCROLL_STATE_IDLE:</div><div class="line">                    <span class="comment">//滑动停止时</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> SCROLL_STATE_TOUCH_SCROLL:</div><div class="line">                    <span class="comment">//正在滚动时</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> SCROLL_STATE_FLING:</div><div class="line">                    <span class="comment">//手指抛动,惯性滑动时</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">/**</span></div><div class="line">             *</div><div class="line">             *  int firstVisibleItem:当前能看见的第一个Item ID</div><div class="line">             *  int visibleItemCount:当前能看见的item总数</div><div class="line">             *  int totalItemCount:挣个istview的tem总数</div><div class="line">             *</div><div class="line">             * */</div><div class="line">            <span class="keyword">private</span> <span class="keyword">int</span> lastVisiableItem;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(ZrcAbsListView view, <span class="keyword">int</span> firstVisibleItem, <span class="keyword">int</span> visibleItemCount, <span class="keyword">int</span> totalItemCount)</span> </span>&#123;</div><div class="line">                <span class="comment">//滚动时一直调用</span></div><div class="line">                <span class="keyword">if</span>(firstVisibleItem+visibleItemCount==totalItemCount&amp;&amp;totalItemCount&gt;<span class="number">0</span>)&#123;</div><div class="line">                    <span class="comment">//滚动到最后一行</span></div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span>(firstVisibleItem&gt;lastVisiableItem)&#123;</div><div class="line">                    <span class="comment">//上滑</span></div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    <span class="comment">//下滑</span></div><div class="line">                &#125;</div><div class="line">                lastVisiableItem = firstVisibleItem;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        <span class="comment">//获取可视区域内第一个item id</span></div><div class="line">        listView.getFirstVisiblePosition();</div><div class="line">        <span class="comment">//获取可视区域内最后一个item id</span></div><div class="line">        listView.getLastVisiblePosition();</div></pre></td></tr></table></figure>
<p>上面的代码提供了判断了ListView滑动方向判断的方法。</p>
<h2 id="ListView的扩展"><a href="#ListView的扩展" class="headerlink" title="ListView的扩展"></a>ListView的扩展</h2><p><img src="http://7xljei.com1.z0.glb.clouddn.com/listviewewxtension.gif" alt="全部的效果图"></p>
<h3 id="具有弹性的ListView"><a href="#具有弹性的ListView" class="headerlink" title="具有弹性的ListView"></a>具有弹性的ListView</h3><p>介绍一种很简单的控制滑动到边缘的方法,如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">*</div><div class="line">* <span class="doctag">@param</span> maxOverScrollX Number of pixels to overscroll by *in *either direction along the X axis.</div><div class="line">* <span class="doctag">@param</span> maxOverScrollY Number of pixels to overscroll by</div><div class="line">*  in either direction along the Y axis.</div><div class="line">** /</div><div class="line"></div><div class="line"><span class="doctag">@Override</span></div><div class="line">    protected boolean overScrollBy(int deltaX, int deltaY, int scrollX, int scrollY, int scrollRangeX, int scrollRangeY,</div><div class="line">            int maxOverScrollX, int maxOverScrollY, boolean isTouchEvent) &#123;</div><div class="line">        return super.overScrollBy(deltaX, deltaY, scrollX, scrollY, scrollRangeX, scrollRangeY, maxOverScrollX,</div><div class="line">                 mMaxOverDistance, isTouchEvent);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>完整的弹性ListView如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListView</span> <span class="keyword">extends</span> <span class="title">ListView</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mMaxOverDistance = <span class="number">50</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyListView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        mContext = context;</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyListView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        mContext = context;</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyListView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">        mContext = context;</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"NewApi"</span>)</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">overScrollBy</span><span class="params">(<span class="keyword">int</span> deltaX, <span class="keyword">int</span> deltaY, <span class="keyword">int</span> scrollX, <span class="keyword">int</span> scrollY, <span class="keyword">int</span> scrollRangeX, <span class="keyword">int</span> scrollRangeY,</span></span></div><div class="line">            <span class="keyword">int</span> maxOverScrollX, <span class="keyword">int</span> maxOverScrollY, <span class="keyword">boolean</span> isTouchEvent) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.overScrollBy(deltaX, deltaY, scrollX, scrollY, scrollRangeX, scrollRangeY, maxOverScrollX,</div><div class="line">                 mMaxOverDistance, isTouchEvent);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        DisplayMetrics metrics = mContext.getResources().getDisplayMetrics();</div><div class="line">        <span class="keyword">float</span> density = metrics.density;</div><div class="line">        mMaxOverDistance = (<span class="keyword">int</span>) (density * mMaxOverDistance);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="自定显示、隐藏布局的ListView"><a href="#自定显示、隐藏布局的ListView" class="headerlink" title="自定显示、隐藏布局的ListView"></a>自定显示、隐藏布局的ListView</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Toolbar mToolbar;</div><div class="line">    <span class="keyword">private</span> ListView mListView;</div><div class="line">    <span class="keyword">private</span> String[] mStr = <span class="keyword">new</span> String[<span class="number">20</span>];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mTouchSlop;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mFirstY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mCurrentY;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> direction;</div><div class="line">    <span class="keyword">private</span> ObjectAnimator mAnimator;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mShow = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"></div><div class="line">    View.OnTouchListener myTouchListener = <span class="keyword">new</span> View.OnTouchListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</div><div class="line">            <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                    mFirstY = event.getY();</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                    mCurrentY = event.getY();</div><div class="line">                    Log.e(<span class="string">"mess"</span>, <span class="string">"-----currentY="</span> + mCurrentY + <span class="string">",firstY="</span> + mFirstY + <span class="string">",======"</span> + (mCurrentY - mFirstY));</div><div class="line">                    <span class="keyword">if</span> (mCurrentY - mFirstY &gt; mTouchSlop) &#123;</div><div class="line">                        direction = <span class="number">0</span>;<span class="comment">//down;</span></div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mFirstY - mCurrentY &gt; mTouchSlop) &#123;</div><div class="line">                        direction = <span class="number">1</span>;<span class="comment">//up</span></div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (direction == <span class="number">1</span>) &#123;</div><div class="line">                        <span class="keyword">if</span> (mShow) &#123;</div><div class="line">                            toolbarAnim(<span class="number">1</span>);<span class="comment">//hide</span></div><div class="line">                            mShow = !mShow;</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (direction == <span class="number">0</span>) &#123;</div><div class="line">                        <span class="keyword">if</span> (!mShow) &#123;</div><div class="line">                            toolbarAnim(<span class="number">0</span>);<span class="comment">//show</span></div><div class="line">                            mShow = !mShow;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.scroll_hide);</div><div class="line">        mListView = (ListView) findViewById(R.id.listview);</div><div class="line">        View header = <span class="keyword">new</span> View(<span class="keyword">this</span>);</div><div class="line">        header.setLayoutParams(<span class="keyword">new</span> AbsListView.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, (<span class="keyword">int</span>) getResources().getDimension(</div><div class="line">                R.dimen.abc_action_bar_default_height_material)));</div><div class="line">        mListView.addHeaderView(header);</div><div class="line">        mTouchSlop = ViewConfiguration.get(<span class="keyword">this</span>).getScaledTouchSlop();</div><div class="line">        mToolbar = (Toolbar) findViewById(R.id.toolbar);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mStr.length; i++) &#123;</div><div class="line">            mStr[i] = <span class="string">"item"</span> + i;</div><div class="line">        &#125;</div><div class="line">        mListView.setAdapter(<span class="keyword">new</span> ArrayAdapter&lt;String&gt;(MyActivity.<span class="keyword">this</span>, android.R.layout.simple_expandable_list_item_1, mStr));</div><div class="line">        mListView.setOnTouchListener(myTouchListener);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">toolbarAnim</span><span class="params">(<span class="keyword">int</span> flag)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mAnimator != <span class="keyword">null</span> &amp;&amp; mAnimator.isRunning()) &#123;</div><div class="line">            mAnimator.cancel();</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//mToolbar.getTranslationY()获取View的绝对位置,</span></div><div class="line">        Log.e(<span class="string">"MyActivity"</span>,<span class="string">"transtionY=============="</span>+mToolbar.getTranslationY()+<span class="string">",height========="</span>+mToolbar.getHeight());</div><div class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;<span class="comment">//show toolbar down,从mToolbar.getTranslationY()位置,移动到当前位置 y ,</span></div><div class="line">            mAnimator = ObjectAnimator.ofFloat(mToolbar, <span class="string">"translationY"</span>, mToolbar.getTranslationY(), <span class="number">0</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//hide toolbar up,从当前位置,移动到mToolbar.getTranslationY()位置 y</span></div><div class="line">            mAnimator = ObjectAnimator.ofFloat(mToolbar, <span class="string">"translationY"</span>, mToolbar.getTranslationY(), -mToolbar.getHeight());</div><div class="line">        &#125;</div><div class="line">        mAnimator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="动态改变ListView布局"><a href="#动态改变ListView布局" class="headerlink" title="动态改变ListView布局"></a>动态改变ListView布局</h3><p>一般有2种方式：</p>
<ul>
<li>两种布局写在一起,通过控制布局的隐藏、显示,控制切换布局;</li>
<li>通过判断来选择加载不同的布局</li>
</ul>
<p>以第二种方式来作为示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FocusListViewTest</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.focus);</div><div class="line">        ListView listView = (ListView) findViewById(R.id.focus_listView);</div><div class="line">        List&lt;String&gt; data = <span class="keyword">new</span> ArrayList&lt;String&gt;();</div><div class="line">        data.add(<span class="string">"I am item 1"</span>);</div><div class="line">        data.add(<span class="string">"I am item 2"</span>);</div><div class="line">        data.add(<span class="string">"I am item 3"</span>);</div><div class="line">        data.add(<span class="string">"I am item 4"</span>);</div><div class="line">        data.add(<span class="string">"I am item 5"</span>);</div><div class="line">        <span class="keyword">final</span> FocusListViewAdapter adapter = <span class="keyword">new</span> FocusListViewAdapter(<span class="keyword">this</span>, data);</div><div class="line">        listView.setAdapter(adapter);</div><div class="line">        listView.setOnItemClickListener(<span class="keyword">new</span> AdapterView.OnItemClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; parent, View view,</span></span></div><div class="line">                                    <span class="keyword">int</span> position, <span class="keyword">long</span> id) &#123;</div><div class="line">                adapter.setCurrentItem(position);</div><div class="line">                adapter.notifyDataSetChanged();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FocusListViewAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; mData;</div><div class="line">    <span class="keyword">private</span> Context mContext;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentItem = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FocusListViewAdapter</span><span class="params">(Context context, List&lt;String&gt; data)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mContext = context;</div><div class="line">        <span class="keyword">this</span>.mData = data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.get(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> position;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</div><div class="line">        LinearLayout layout = <span class="keyword">new</span> LinearLayout(mContext);</div><div class="line">        layout.setOrientation(LinearLayout.VERTICAL);</div><div class="line">        <span class="keyword">if</span> (mCurrentItem == position) &#123;</div><div class="line">            layout.addView(addFocusView(position));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            layout.addView(addNormalView(position));</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> layout;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentItem</span><span class="params">(<span class="keyword">int</span> currentItem)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mCurrentItem = currentItem;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> View <span class="title">addFocusView</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        ImageView iv = <span class="keyword">new</span> ImageView(mContext);</div><div class="line">        iv.setImageResource(R.drawable.ic_launcher);</div><div class="line">        <span class="keyword">return</span> iv;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> View <span class="title">addNormalView</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        LinearLayout layout = <span class="keyword">new</span> LinearLayout(mContext);</div><div class="line">        layout.setOrientation(LinearLayout.HORIZONTAL);</div><div class="line">        ImageView iv = <span class="keyword">new</span> ImageView(mContext);</div><div class="line">        iv.setImageResource(R.drawable.in_icon);</div><div class="line">        layout.addView(iv, <span class="keyword">new</span> LinearLayout.LayoutParams(</div><div class="line">                LinearLayout.LayoutParams.WRAP_CONTENT,</div><div class="line">                LinearLayout.LayoutParams.WRAP_CONTENT));</div><div class="line">        TextView tv = <span class="keyword">new</span> TextView(mContext);</div><div class="line">        tv.setText(mData.get(i));</div><div class="line">        layout.addView(tv, <span class="keyword">new</span> LinearLayout.LayoutParams(</div><div class="line">                LinearLayout.LayoutParams.WRAP_CONTENT,</div><div class="line">                LinearLayout.LayoutParams.WRAP_CONTENT));</div><div class="line">        layout.setGravity(Gravity.CENTER);</div><div class="line">        <span class="keyword">return</span> layout;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Android-Scroll分析"><a href="#Android-Scroll分析" class="headerlink" title="Android Scroll分析"></a>Android Scroll分析</h1><h2 id="Android坐标系"><a href="#Android坐标系" class="headerlink" title="Android坐标系"></a>Android坐标系</h2><p><a href="http://blog.csdn.net/zxc123e/article/details/41869833" target="_blank" rel="external">android之位置坐标</a></p>
<p>Android中,将屏幕最左上角的顶点作为Android坐标系的原点,从这个点向右是X轴正方向,从这个点向下是Y轴正方向。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/androidzuobiao.png" alt="Android坐标系"></p>
<p>系统提供了<code>getLocationOnScreen(int location[])</code>这样的方法来获取Android坐标系中点的位置。在触摸事件中使用<code>getRawX</code>和<code>getRawY</code>方法<br>所获取的坐标同样是Android坐标系中的坐标。</p>
<h2 id="视图坐标系"><a href="#视图坐标系" class="headerlink" title="视图坐标系"></a>视图坐标系</h2><p>视图坐标系描述了子视图在父视图中的位置关系,视图坐标系同样是以原点向右是X轴正方向,以原点向下是Y轴正方向,以父视图左上角为坐标原点。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/layoutzuobiaoxi.png" alt="视图坐标系"></p>
<p>在触摸事件中,通过<code>getX</code>和<code>getY</code>所获得的坐标就是视图坐标系中的坐标。</p>
<h2 id="触摸事件"><a href="#触摸事件" class="headerlink" title="触摸事件"></a>触摸事件</h2><p><img src="http://7xljei.com1.z0.glb.clouddn.com/20150115155321445.png" alt="触摸事件"></p>
<p>其中,View提供的获取坐标的方法有：</p>
<ul>
<li>getTop():获取到的是View自身的顶边到其父布局顶边的距离</li>
<li>getBottom():获取到的是View自身的底边到其父布局顶边的距离</li>
<li>getLeft():获取到的是View自身的左边到其父布局左边的距离</li>
<li>getRight():获取到的是View自身的右边到其父布局左边的距离</li>
</ul>
<p>其中MotionEvent提供的方法有:</p>
<ul>
<li>getX():获取点击事件距离控件左边的距离,即视图坐标</li>
<li>getY():获取点击事件距离控件右边的距离,即视图坐标</li>
<li>getRawX():获取点击事件距离整个屏幕左边的距离,即绝对坐标</li>
<li>getRawY():获取点击事件距离整个屏幕顶边的距离,即绝对坐标</li>
</ul>
<h2 id="实现滑动的七种方法"><a href="#实现滑动的七种方法" class="headerlink" title="实现滑动的七种方法"></a>实现滑动的七种方法</h2><h3 id="layout方法"><a href="#layout方法" class="headerlink" title="layout方法"></a>layout方法</h3><p>layout方法可以通过两种坐标系去完成这个,其一：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/6.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDragView01</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MyDragView01.class.getSimpleName();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x, y;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView01</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView01</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView01</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">        Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"MotionEvent.ACTION_DOWN   "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">                x = (<span class="keyword">int</span>) event.getX();</div><div class="line">                y = (<span class="keyword">int</span>) event.getY();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"MotionEvent.ACTION_MOVE  "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">                <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">                layout(getLeft() + offsetX, getTop() + offsetY, getRight() + offsetX, getBottom() + offsetY);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其二,使用绝对坐标系：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDragView02</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView02</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView02</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView02</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> rawX = (<span class="keyword">int</span>) event.getRawX();</div><div class="line">        <span class="keyword">int</span> rawY = (<span class="keyword">int</span>) event.getRawY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                x = rawX;</div><div class="line">                y = rawY;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> offsetX = rawX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = rawY - y;</div><div class="line">                layout(getLeft() + offsetX, getTop() + offsetY, getRight() + offsetX, getBottom() + offsetY);</div><div class="line">                x = rawX;</div><div class="line">                y = rawY;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用绝对坐标系需要注意是每次执行完ACTION_MOVE的逻辑后,一定要重新设置初始坐标,这样才能准确获得偏移量。</p>
<h3 id="offsetLeftAndRight-和offsetTopAndBottom-方法"><a href="#offsetLeftAndRight-和offsetTopAndBottom-方法" class="headerlink" title="offsetLeftAndRight()和offsetTopAndBottom()方法"></a>offsetLeftAndRight()和offsetTopAndBottom()方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDragView03</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MyDragView03.class.getSimpleName();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x, y;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView03</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context,<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView03</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView03</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">        Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"MotionEvent.ACTION_DOWN   "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">                x = (<span class="keyword">int</span>) event.getX();</div><div class="line">                y = (<span class="keyword">int</span>) event.getY();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"MotionEvent.ACTION_MOVE  "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">                <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">                <span class="comment">//layout(getLeft() + offsetX, getTop() + offsetY, getRight() + offsetX, getBottom() + offsetY);</span></div><div class="line">                offsetLeftAndRight(offsetX);</div><div class="line">                offsetTopAndBottom(offsetY);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于使用绝对坐标实现的,和此原理相同。</p>
<h3 id="LayoutParams"><a href="#LayoutParams" class="headerlink" title="LayoutParams"></a>LayoutParams</h3><p>LayoutParams保存了一个布局的位置参数信息。通过<code>getLayoutParams()</code>获取LayoutParams时,需要根据View所在父布局的类型来设置不同的类型。<br>比如的我的布局代码：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"me.jarvischen.dragview.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">me.jarvischen.dragview.MyDragView05</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"100dp"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/colorAccent"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>它的父布局是LinearLayout,所以我是用<code>LinearLayout.LayoutParams</code>,当然,也可以使用<code>ViewGroup.LayoutParams</code>。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDragView05</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = MyDragView05.class.getSimpleName();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x, y;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView05</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView05</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView05</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">        Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"MotionEvent.ACTION_DOWN   "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">                x = (<span class="keyword">int</span>) event.getX();</div><div class="line">                y = (<span class="keyword">int</span>) event.getY();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                Log.e(TAG, <span class="string">"onTouchEvent: "</span> + <span class="string">"MotionEvent.ACTION_MOVE  "</span> + <span class="string">"getLeft()="</span> + getLeft());</div><div class="line">                <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">                LinearLayout.LayoutParams layoutParams = (LinearLayout.LayoutParams) getLayoutParams();</div><div class="line">                layoutParams.leftMargin = getLeft() + offsetX;</div><div class="line">                layoutParams.topMargin = getTop() + offsetY;</div><div class="line">                <span class="comment">//layoutParams.rightMargin = getRight() + offsetX;</span></div><div class="line">                <span class="comment">//layoutParams.bottomMargin = getBottom() + offsetY;</span></div><div class="line">                setLayoutParams(layoutParams);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>绝对坐标的情况：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> rawX = (<span class="keyword">int</span>) event.getRawX();</div><div class="line">        <span class="keyword">int</span> rawY = (<span class="keyword">int</span>) event.getRawY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                x = rawX;</div><div class="line">                y = rawY;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> offsetX = rawX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = rawY - y;</div><div class="line">                LinearLayout.LayoutParams layoutParams = (LinearLayout.LayoutParams) getLayoutParams();</div><div class="line">                layoutParams.leftMargin = offsetX + getLeft();</div><div class="line">                layoutParams.topMargin = offsetY + getTop();</div><div class="line">                setLayoutParams(layoutParams);</div><div class="line">                x = rawX;</div><div class="line">                y = rawY;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="scrollTo与scrollBy"><a href="#scrollTo与scrollBy" class="headerlink" title="scrollTo与scrollBy"></a>scrollTo与scrollBy</h3><p>scrollTo()方法是让View相对于初始的位置滚动某段距离,由于View的初始位置是不变的,因此不管我们点击多少次scrollTo按钮滚动到的都将是<br>同一个位置。而scrollBy()方法则是让View相对于当前的位置滚动某段距离,那每当我们点击一次scrollBy按钮,View的当前位置都进行了变动,<br>因此不停点击会一直向右下方(传入的两个坐标值均为负数)移动。</p>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/48719871" target="_blank" rel="external">Android Scroller完全解析,关于Scroller你所需知道的一切 </a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                x = (<span class="keyword">int</span>) event.getX();</div><div class="line">                y = (<span class="keyword">int</span>) event.getY();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">                scrollBy(offsetX, offsetY);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>代码这样写,发现其并不能移动。原因是scrollTo和scrollBy移动的是View的content。改成这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">       <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">       <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">       <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">               x = (<span class="keyword">int</span>) event.getX();</div><div class="line">               y = (<span class="keyword">int</span>) event.getY();</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">               <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">               <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">               ((View)getParent()).scrollBy(offsetX, offsetY);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>但是发现它在乱动。<br>scrollBy中的参数是负数的时候,那么将向坐标轴正方向移动,反之相反。<br>所以正确的应该是这样的：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">       <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">       <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">       <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">               x = (<span class="keyword">int</span>) event.getX();</div><div class="line">               y = (<span class="keyword">int</span>) event.getY();</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">               <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">               <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">               ((View)getParent()).scrollBy(-offsetX, -offsetY);</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<h3 id="Scroller"><a href="#Scroller" class="headerlink" title="Scroller"></a>Scroller</h3><p>通过<code>Scroller</code>类可以实现平滑移动的效果,而不是瞬间完成的移动(比如通过scrollTo和scrollBy方法)。</p>
<p>Scroller原理：和scrollTo,scrollBy类似,只是,在ACTION_MOVE中不断获取手指移动的微小偏移量,将一段距离划分为N个非常小的偏移量。<br>在每个偏移量里面通过scrollBy方法进行瞬间移动,实现平滑移动。</p>
<p>(本demo中,同样让子View跟随手指的滑动而滑动,但是在手指离开屏幕时,让子View平滑的移动到初始位置,即屏幕左上角。)</p>
<ul>
<li>第一步,初始化Scroller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scroller = <span class="keyword">new</span> Scroller(context);</div></pre></td></tr></table></figure>
<ul>
<li>第二步,重写computeScroll()方法,实现模拟滚动</li>
</ul>
<p>computeScroll()是Scroller类的核心,系统在绘制View的时候会在draw()方法中调用该方法。这个方法实际上就是使用的scrollTo方法。再结合Scroller<br>对象,帮助获取到当前的滚动值。下面的代码是模板代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第二步,重写computeScroll()方法,实现模拟滑动</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.computeScroll();</div><div class="line">        <span class="comment">//判断Scroller是否执行完毕</span></div><div class="line">        <span class="keyword">if</span> (scroller.computeScrollOffset())&#123;</div><div class="line">            ((View)getParent()).scrollTo(scroller.getCurrX(),scroller.getCurrY());</div><div class="line">            <span class="comment">//通过重绘来不断调用computeScroll()</span></div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>Scroller类提供了computeScrollOffset()方法来判断是否完成了整个滑动,同时也提供了getCurrX()和getCurrY()<br>来获取当前的滑动坐标。</p>
<p>唯一需要注意的是invalidate()方法,因为只能在computeScroll()方法中获取模拟过程的scrollX和scrollY坐标,但computeScroll()不会自动调用,<br>只能通过invalidate()-&gt;draw()-&gt;computeScroll()来间接调用computeScroll(),所以需要在上述代码中调用invalidate(),<br>实现循环获取scrollX和scrollY的目的。模拟过程结束后,scroller.computeScrollOfset()方法会返回 false,从而中断循环,完成整个平滑移动的过程。</p>
<ul>
<li>第三步,startScroll开启模拟过程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Scroller;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDragView09</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x, y;</div><div class="line">    <span class="keyword">private</span> Scroller scroller;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView09</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView09</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView09</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="comment">//第一步,初始化Scroller</span></div><div class="line">        scroller = <span class="keyword">new</span> Scroller(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//第二步,重写computeScroll()方法,实现模拟滑动</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.computeScroll();</div><div class="line">        <span class="comment">//判断Scroller是否执行完毕</span></div><div class="line">        <span class="keyword">if</span> (scroller.computeScrollOffset()) &#123;</div><div class="line">            ((View) getParent()).scrollTo(scroller.getCurrX(), scroller.getCurrY());</div><div class="line">            <span class="comment">//通过重绘来不断调用computeScroll()</span></div><div class="line">            invalidate();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> getX = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> getY = (<span class="keyword">int</span>) event.getY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                x = (<span class="keyword">int</span>) event.getX();</div><div class="line">                y = (<span class="keyword">int</span>) event.getY();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                <span class="keyword">int</span> offsetX = getX - x;</div><div class="line">                <span class="keyword">int</span> offsetY = getY - y;</div><div class="line">                ((View) getParent()).scrollBy(-offsetX, -offsetY);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                View viewGroup = (View) getParent();</div><div class="line">                <span class="comment">/**</span></div><div class="line">                 * Start scrolling by providing a starting point and the distance to travel.</div><div class="line">                 * The scroll will use the default value of 250 milliseconds for the</div><div class="line">                 * duration.</div><div class="line">                 *</div><div class="line">                 * <span class="doctag">@param</span> startX Starting horizontal scroll offset in pixels. Positive</div><div class="line">                 *        numbers will scroll the content to the left.</div><div class="line">                 * <span class="doctag">@param</span> startY Starting vertical scroll offset in pixels. Positive numbers</div><div class="line">                 *        will scroll the content up.</div><div class="line">                 * <span class="doctag">@param</span> dx Horizontal distance to travel. Positive numbers will scroll the</div><div class="line">                 *        content to the left.</div><div class="line">                 * <span class="doctag">@param</span> dy Vertical distance to travel. Positive numbers will scroll the</div><div class="line">                 *        content up.</div><div class="line">                 */</div><div class="line">                scroller.startScroll(viewGroup.getScrollX(), viewGroup.getScrollY(), -viewGroup.getScrollX(),</div><div class="line">                        -viewGroup.getScrollY());</div><div class="line">                invalidate();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.ObjectAnimator;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        MyDragView10 myDragView = (MyDragView10) findViewById(R.id.myDragView);</div><div class="line">        <span class="keyword">final</span> ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(myDragView, <span class="string">"translationX"</span>,<span class="number">0</span>, <span class="number">500</span>,<span class="number">0</span>,<span class="number">500</span>);</div><div class="line">        objectAnimator.setDuration(<span class="number">5000</span>);</div><div class="line">        objectAnimator.start();</div><div class="line">        objectAnimator.setRepeatCount(<span class="number">200</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ViewDragHelper"><a href="#ViewDragHelper" class="headerlink" title="ViewDragHelper"></a>ViewDragHelper</h3><p>ViewDragHelper在之前已经写了相关的文章。<br><a href="http://chenfuduo.me/2015/07/16/ViewDragHelper%E7%9A%84%E7%94%A8%E6%B3%95/" target="_blank" rel="external">ViewDragHelper的用法</a><br><a href="http://chenfuduo.me/2015/07/16/ViewDragHelper%E7%9A%84%E7%94%A8%E6%B3%952/" target="_blank" rel="external">ViewDragHelper的用法2</a></p>
<p>这里也是简单的做的演示下QQ侧滑的效果,代码如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.dragview;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewCompat;</div><div class="line"><span class="keyword">import</span> android.support.v4.widget.ViewDragHelper;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.FrameLayout;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDragView11</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ViewDragHelper viewDragHelper;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> View mainView;</div><div class="line">    <span class="keyword">private</span> View menuView;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView11</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView11</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDragView11</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//第一步,通过静态工厂初始化ViewDragHelper</span></div><div class="line">        viewDragHelper = ViewDragHelper.create(<span class="keyword">this</span>, <span class="number">1.0f</span>, callback);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ViewDragHelper.Callback callback = <span class="keyword">new</span> ViewDragHelper.Callback() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryCaptureView</span><span class="params">(View child, <span class="keyword">int</span> pointerId)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> mainView == child;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionVertical</span><span class="params">(View child, <span class="keyword">int</span> top, <span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionHorizontal</span><span class="params">(View child, <span class="keyword">int</span> left, <span class="keyword">int</span> dx)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> left;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//拖动结束后调用</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewReleased</span><span class="params">(View releasedChild, <span class="keyword">float</span> xvel, <span class="keyword">float</span> yvel)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.onViewReleased(releasedChild, xvel, yvel);</div><div class="line">            <span class="comment">//手指抬起后缓慢移动到指定为作弊</span></div><div class="line">            <span class="keyword">if</span> (mainView.getLeft() &lt; <span class="number">500</span>)&#123;</div><div class="line">                viewDragHelper.smoothSlideViewTo(mainView,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">                ViewCompat.postInvalidateOnAnimation(MyDragView11.<span class="keyword">this</span>);</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                <span class="comment">//打开菜单</span></div><div class="line">                viewDragHelper.smoothSlideViewTo(mainView,<span class="number">300</span>,<span class="number">0</span>);</div><div class="line">                ViewCompat.postInvalidateOnAnimation(MyDragView11.<span class="keyword">this</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//第二步,拦截事件---重写onInterceptTouchEvent(MotionEvent)&amp;onTouchEvent(MotionEvent)</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> viewDragHelper.shouldInterceptTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        viewDragHelper.processTouchEvent(event);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//第三步,处理computeScroll()</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.computeScroll();</div><div class="line">        <span class="keyword">if</span> (viewDragHelper.continueSettling(<span class="keyword">true</span>))&#123;</div><div class="line">            ViewCompat.postInvalidateOnAnimation(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onFinishInflate();</div><div class="line">        menuView = getChildAt(<span class="number">0</span>);</div><div class="line">        mainView = getChildAt(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSizeChanged</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> oldw, <span class="keyword">int</span> oldh)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh);</div><div class="line">        width = menuView.getMeasuredWidth();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>布局：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">me.jarvischen.dragview.MyDragView11</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"me.jarvischen.dragview.ViewDragHelperTestActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/menu"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/colorAccent"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/main"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/colorPrimaryDark"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">me.jarvischen.dragview.MyDragView11</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h1 id="Android绘图机制与处理技巧"><a href="#Android绘图机制与处理技巧" class="headerlink" title="Android绘图机制与处理技巧"></a>Android绘图机制与处理技巧</h1><h2 id="屏幕的尺寸信息"><a href="#屏幕的尺寸信息" class="headerlink" title="屏幕的尺寸信息"></a>屏幕的尺寸信息</h2><h3 id="屏幕参数"><a href="#屏幕参数" class="headerlink" title="屏幕参数"></a>屏幕参数</h3><ul>
<li>分辨率</li>
</ul>
<p>分辨率就是手机屏幕的像素点数,一般描述成屏幕的”宽×高”,安卓手机屏幕常见的分辨率有480×800、720×1280、1080×1920等。<br>720×1280表示此屏幕在宽度方向有720个像素,在高度方向有1280个像素。</p>
<ul>
<li>屏幕大小</li>
</ul>
<p>屏幕大小是手机对角线的物理尺寸,以英寸(inch)为单位。比如某某手机为”5寸大屏手机”,就是指对角线的尺寸,5寸×2.54厘米/寸=12.7厘米。</p>
<ul>
<li>密度(dpi,dots per inch;或PPI,pixels per inch)</li>
</ul>
<p>从英文顾名思义,就是每英寸的像素点数,数值越高当然显示越细腻。假如我们知道一部手机的分辨率是1080×1920,屏幕大小是5英寸,<br>通过宽1080和高1920,根据勾股定理,我们得出对角线的像素数大约是2203,那么用2203除以5就是此屏幕的密度了,计算结果是440。<br>440dpi的屏幕已经相当细腻了。</p>
<h3 id="系统屏幕密度"><a href="#系统屏幕密度" class="headerlink" title="系统屏幕密度"></a>系统屏幕密度</h3><p><a href="http://7xljei.com1.z0.glb.clouddn.com/027f3555d594bd00000128a1d733f9.jpg" target="_blank" rel="external">系统屏幕密度</a></p>
<h3 id="独立像素密度dp"><a href="#独立像素密度dp" class="headerlink" title="独立像素密度dp"></a>独立像素密度dp</h3><p>dp也可写为dip,即density-independent pixel。你可以想象dp更类似一个物理尺寸,比如一张宽和高均为100dp的图片在320×480和480×800<br>的手机上”看起来”一样大。而实际上,它们的像素值并不一样。dp正是这样一个尺寸,不管这个屏幕的密度是多少,屏幕上相同dp大小的元素看起来<br>始终差不多大。<br>另外,字尺寸使用sp,即scale-independentpixel的缩写,这样,当你在系统设置里调节字号大小时,应用中的文字也会随之变大变小。<br><img src="http://7xljei.com1.z0.glb.clouddn.com/02a266556d6bd20000016b62fbb2ec.jpg" alt="sp&amp;dp"></p>
<p><code>ldpi:mdpi:hdpi:xhdpi:xxhdpi=3:4:6:8:12</code></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/024dc5556d6bbb0000016b62bbcfca.jpg" alt="转化关系"></p>
<h2 id="单位转换"><a href="#单位转换" class="headerlink" title="单位转换"></a>单位转换</h2><p>单位转换是个工具类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.TypedValue;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/8.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DisplayUtils</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dip2px</span><span class="params">(Context context, <span class="keyword">float</span> dipValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scale = context.getResources().getDisplayMetrics().density;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (dipValue * scale + <span class="number">0.5f</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">px2dip</span><span class="params">(Context context, <span class="keyword">float</span> pxValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scale = context.getResources().getDisplayMetrics().density;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (pxValue / scale + <span class="number">0.5f</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">px2sp</span><span class="params">(Context context, <span class="keyword">float</span> pxValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (pxValue / fontScale + <span class="number">0.5f</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sp2px</span><span class="params">(Context context, <span class="keyword">float</span> spValue)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">float</span> fontScale = context.getResources().getDisplayMetrics().scaledDensity;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (spValue * fontScale + <span class="number">0.5f</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dp2px</span><span class="params">(Context context, <span class="keyword">float</span> dpVal)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,</div><div class="line">                dpVal, context.getResources().getDisplayMetrics());</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">sp2px</span><span class="params">(Context context, <span class="keyword">float</span> spVal)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP,</div><div class="line">                spVal, context.getResources().getDisplayMetrics());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后两个是通过TypedValue类帮助转换的。</p>
<h2 id="2D绘图基础"><a href="#2D绘图基础" class="headerlink" title="2D绘图基础"></a>2D绘图基础</h2><p>系统通过提供的Canvas对象来提供绘图方法。它提供了各种绘制图像的API,如drawPoint(点)、drawLine(线)、drawRect(矩形)、<br>drawVertices(多边形)、drawArc(弧)、drawCircle(圆)、drawPath(路径)、drawText(文本)、drawOval(椭圆)、<br>drawBitmap(贴图)等等。</p>
<p>Paint画笔也是绘图中一个非常重要的元素。</p>
<ul>
<li>setAntiAlias() 　　　//设置画笔的锯齿效果</li>
<li>setColor() 　　　　//设置画笔的颜色</li>
<li>setARGB() 　　　　　//设置画笔的A、R、G、B值</li>
<li>setAlpha() 　　　　//设置画笔的Alpha值</li>
<li>setTextSize() 　　　//设置字体的尺寸</li>
<li>setStyle() 　　　　//设置画笔的风格(空心或者实心)</li>
<li>setStrokeWidth() 　//设置空心边框的宽度</li>
</ul>
<p>Canvas家族成员</p>
<ul>
<li>DrawPoint,绘制点</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">canvas.drawPoint(x,y,paint);</div><div class="line"><span class="comment">//绘制多个点</span></div><div class="line">canvas.drawPoints(pts,paint);</div></pre></td></tr></table></figure>
<ul>
<li><p>DrawLine,绘制直线</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawLine(startX,startY,endX,endY,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawLines,绘制多条直线</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">float</span>[] pts = &#123;startX1,startX2,endX1,endX2,...,startXn,startYn,endXn,endYn&#125;;</div><div class="line">canvas.drawLines(pts,point);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawRect,绘制矩形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawRect(left,top,right,bottom,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawRoundRect,绘制圆角矩形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawRoundRect(left,top,right,bottom,radiusX,radiusY,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawCircle,绘制圆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawCircle(circleX,circleY,radius,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawArc,绘制弧形、扇形</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">paint.setStyle(Paint.STROKE);</div><div class="line">canvas.drawArc(left,top,right,bottom,startAngle,sweepAngle,(<span class="keyword">boolean</span>类型)useCenter,paint);</div><div class="line"><span class="comment">//Panit.Style和useCenter属性的组合</span></div><div class="line"><span class="comment">//1.绘制扇形</span></div><div class="line">Panit.Style.STROKE + useCenter(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//2.绘制弧形</span></div><div class="line">Panit.Style.STROKE + useCenter(<span class="keyword">false</span>);</div><div class="line"></div><div class="line"><span class="comment">//3.绘制实心扇形</span></div><div class="line">Panit.Style.FILL + useCenter(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">//4.绘制实心弧形</span></div><div class="line">Panit.Style.FILL + useCenter(<span class="keyword">false</span>);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawOval,绘制椭圆</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过椭圆的外接矩形来绘制椭圆</span></div><div class="line">canvas.drawOval(left,top,right,bottom,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawText,绘制文本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawText(text,startX,startY,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawPosText,在指定位置绘制文本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">canvas.drawPosText(text,<span class="keyword">new</span> <span class="keyword">float</span>[]&#123;x1,x2,x2,y2,...xn,yn&#125;,paint);</div></pre></td></tr></table></figure>
</li>
<li><p>DrawPath,绘制路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Path path = <span class="keyword">new</span> Path();</div><div class="line">path.moveTo(<span class="number">50</span>,<span class="number">50</span>);</div><div class="line">path.lineTo(<span class="number">100</span>,<span class="number">100</span>);</div><div class="line">path.lineTo(<span class="number">100</span>,<span class="number">300</span>);</div><div class="line">path.lineTo(<span class="number">300</span>,<span class="number">50</span>);</div><div class="line">canvas.drawPath(path,paint);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Android-XML绘图"><a href="#Android-XML绘图" class="headerlink" title="Android XML绘图"></a>Android XML绘图</h2><h3 id="Bitmap"><a href="#Bitmap" class="headerlink" title="Bitmap"></a>Bitmap</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">bitmap</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schema.android.com/apk/res/android</span></span></div><div class="line">    android:src="@<span class="attr">drawable</span>/<span class="attr">ic_lancher</span>" /&gt;</div></pre></td></tr></table></figure>
<h3 id="Shape"><a href="#Shape" class="headerlink" title="Shape"></a>Shape</h3><p>Shape可以说是XML绘图的精华所在。Shape功能十分强大,无论是扁平化、拟物化还是渐变,它都能绘制。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line">&lt;shape xmlns:android="http://schema.android.com/apk/res/android</div><div class="line">    //默认为rectangle</div><div class="line">    android:shape=["rectangle"|"oval"|"line"|"ring"] &gt;</div><div class="line">    &lt;corners 　//当shape="rectangle"时使用</div><div class="line">        android:radius="1dp"</div><div class="line">        android:topLeftRadius="0.5dp"</div><div class="line">        android:topRightRadius="0.5dp"</div><div class="line">        android:bottomLeftRadius="0.5dp"</div><div class="line">        android:bottomRightRadius="0.5dp" /&gt;</div><div class="line"></div><div class="line">    &lt;gradient  //渐变</div><div class="line">        android:angle="0.5dp"</div><div class="line">        android:centerX="0.5dp"</div><div class="line">        android:centerY="0.5dp"</div><div class="line">        android:centerColor="#ffffff"</div><div class="line">        android:endColor="@color/"</div><div class="line">        android:gradientRadius="0.5dp"</div><div class="line">        android:startColor="@color/"</div><div class="line">        android:type=["linear"|"radial"|"sweep"]</div><div class="line">        android:useLevel=["true" | "false"] /&gt;</div><div class="line"></div><div class="line">    &lt;padding</div><div class="line">        android:left="20dp"</div><div class="line">        android:top="20dp"</div><div class="line">        android:right="20dp"</div><div class="line">        android:bottom="20dp" /&gt;</div><div class="line"></div><div class="line">    &lt;size  //指定大小,一般用imageview配合scaleType属性使用</div><div class="line">        android:width="20dp"</div><div class="line">        android:height="20dp" /&gt;</div><div class="line"></div><div class="line">    &lt;solid  //填充颜色</div><div class="line">        android:color="@color/" /&gt;</div><div class="line"></div><div class="line">    &lt;stroke //指定边框</div><div class="line">        android:width="20dp"</div><div class="line">        android:color="@color/"</div><div class="line">        //虚线宽度</div><div class="line">        android:dashWidth="5dp"</div><div class="line">        //虚线间隔宽度</div><div class="line">        android:dashGap="2dp"</div><div class="line"></div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure></p>
<h3 id="layer"><a href="#layer" class="headerlink" title="layer"></a>layer</h3><p>通过layer、layer-list实现图层效果,图片会依次叠加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">layer-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schema.android.com/apk/res/android &gt;</span></span></div><div class="line"></div><div class="line">&lt;!--图片1--&gt;</div><div class="line">&lt;item</div><div class="line">    android:drawable="@<span class="attr">drawable</span>/<span class="attr">ic_launcher</span>" /&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!--图片2--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:drawable</span>=<span class="string">"@drawable/ic_launcher"</span></div><div class="line">    <span class="attr">android:left</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:top</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:right</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:bottom</span>=<span class="string">"10dp"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h3><p>Selector的作用在于实现静态绘图中的事件反馈,通过给不同的事件设置不同的图像,从而在程序中根据用户输入,返回不同的效果。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schema.android.com/apk/res/android &gt;</span></span></div><div class="line"></div><div class="line">&lt;!--默认时的背景图片--&gt;</div><div class="line">&lt;item android:drawable="@<span class="attr">drawable</span>/<span class="attr">X1</span>" /&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!--没有焦点时的背景图片--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_window_focused</span>=<span class="string">"false"</span></span></div><div class="line">      <span class="attr">android:drawable</span>=<span class="string">"@drawable/X2 /&gt;</span></div><div class="line"></div><div class="line">&lt;!--非触摸模式下获得焦点并单击时的背景图片--&gt;</div><div class="line">&lt;item android:state_focused="<span class="attr">true</span>"</div><div class="line">      <span class="attr">android:state_pressed</span>=<span class="string">"true"</span></div><div class="line">      <span class="attr">android:drawable</span>=<span class="string">"@drawable/X3"</span> /&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!--触摸模式下获得焦点并单击时的背景图片--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_focused</span>=<span class="string">"false"</span></span></div><div class="line">      <span class="attr">android:state_pressed</span>=<span class="string">"true"</span></div><div class="line">      <span class="attr">android:drawable</span>=<span class="string">"@drawable/X4"</span> /&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!--选中时的背景图片--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_selected</span>=<span class="string">"true"</span></span></div><div class="line">      <span class="attr">android:drawable</span>=<span class="string">"@drawable/X5"</span> /&gt;</div><div class="line"></div><div class="line"><span class="comment">&lt;!--获得焦点时的图片背景--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_focused</span>=<span class="string">"true"</span></span></div><div class="line">      <span class="attr">android:drawable</span>=<span class="string">"@drawable/X6 /&gt;</span></div><div class="line"></div><div class="line">&lt;/selector&gt;</div></pre></td></tr></table></figure></p>
<p>Selector也可以使用Shape作为它的Item,实现具有点击反馈效果的Selector<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schema.android.com/apk/res/android &gt;</span></span></div><div class="line"></div><div class="line">&lt;item android:state_pressed="<span class="attr">true</span>" &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">"rectangle"</span> &gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--填充的颜色--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#00ff00"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--设置按钮的四个角为弧形--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"5dp"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">padding</span></span></div><div class="line">    <span class="attr">android:bottom</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:left</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:right</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:top</span>=<span class="string">"10dp"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">item</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">"rectangle"</span> &gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--填充的颜色--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#00ffff"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!--设置按钮的四个角为弧形--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">"5dp"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">padding</span></span></div><div class="line">    <span class="attr">android:bottom</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:left</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:right</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:top</span>=<span class="string">"10dp"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="Android绘图技巧"><a href="#Android绘图技巧" class="headerlink" title="Android绘图技巧"></a>Android绘图技巧</h2><h3 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h3><ul>
<li>Canvas.save()</li>
</ul>
<p>Canvas.save()这个方法,从字面上可以理解为保存画布。它的作用就是将之前的所有已绘制图像保存起来,让后续的操作就好像在一个新的图层<br>上操作一样。</p>
<ul>
<li>Canvas.restore()</li>
</ul>
<p>Canvas.restore()这个方法,可以理解为合并图层操作。它的作用是将我们在sava()之后绘制的所有图像与sava()之前的图像进行合并。</p>
<ul>
<li>Canvas.translate()</li>
</ul>
<p>Canvas.translate()这个方法,可以理解为坐标系的平移。默认绘制坐标零点位于屏幕左上角,那么在调用translate(x,y)方法之后,<br>则将原点(0,0)移动到了(x,y)。之后的所有绘图操作都将以(x,y)为原点执行。</p>
<ul>
<li>Canvas.rotate()</li>
</ul>
<p>Canvas.rotate()将坐标系旋转了一定的角度。</p>
<p>下面的例子绘制一个仪表盘。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//大圆</span></div><div class="line">    <span class="keyword">private</span> Paint circlePaint;</div><div class="line">    <span class="comment">//刻度线和刻度值</span></div><div class="line">    <span class="keyword">private</span> Paint degreePaint;</div><div class="line">    <span class="comment">//圆心的点</span></div><div class="line">    <span class="keyword">private</span> Paint pointPaint;</div><div class="line">    <span class="comment">//指针,小时的指针</span></div><div class="line">    <span class="keyword">private</span> Paint hourPaint;</div><div class="line">    <span class="comment">//指针,分钟的指针</span></div><div class="line">    <span class="keyword">private</span> Paint minutePaint;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width, height;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        pointPaint = <span class="keyword">new</span> Paint();</div><div class="line">        pointPaint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        pointPaint.setStrokeWidth(<span class="number">15</span>);</div><div class="line">        pointPaint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line"></div><div class="line">        circlePaint = <span class="keyword">new</span> Paint();</div><div class="line">        circlePaint.setStyle(Paint.Style.STROKE);</div><div class="line">        circlePaint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        circlePaint.setStrokeWidth(<span class="number">5</span>);</div><div class="line">        circlePaint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line"></div><div class="line">        degreePaint = <span class="keyword">new</span> Paint();</div><div class="line">        degreePaint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line">        degreePaint.setStrokeWidth(<span class="number">3</span>);</div><div class="line">        degreePaint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        hourPaint = <span class="keyword">new</span> Paint();</div><div class="line">        hourPaint.setStrokeWidth(<span class="number">20</span>);</div><div class="line">        hourPaint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        hourPaint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line"></div><div class="line">        minutePaint = <span class="keyword">new</span> Paint();</div><div class="line">        minutePaint.setStrokeWidth(<span class="number">10</span>);</div><div class="line">        minutePaint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        minutePaint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        width = getMeasuredWidth();</div><div class="line">        height = getMeasuredHeight();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawCircle(width / <span class="number">2</span>, height / <span class="number">2</span>, width / <span class="number">2</span>, circlePaint);</div><div class="line">        canvas.drawPoint(width / <span class="number">2</span>, height / <span class="number">2</span>, pointPaint);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">24</span>; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (i == <span class="number">0</span> || i == <span class="number">6</span> || i == <span class="number">12</span> || i == <span class="number">18</span>) &#123;</div><div class="line">                degreePaint.setStrokeWidth(<span class="number">5</span>);</div><div class="line">                degreePaint.setTextSize(<span class="number">30</span>);</div><div class="line">                canvas.drawLine(width / <span class="number">2</span>, height / <span class="number">2</span> - width / <span class="number">2</span>,</div><div class="line">                        width / <span class="number">2</span>, height / <span class="number">2</span> - width / <span class="number">2</span> + <span class="number">60</span>, degreePaint);</div><div class="line">                String degree = String.valueOf(i);</div><div class="line">                canvas.drawText(degree,</div><div class="line">                        width / <span class="number">2</span> - degreePaint.measureText(degree) / <span class="number">2</span>, height / <span class="number">2</span> - width / <span class="number">2</span> + <span class="number">90</span>, degreePaint);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                degreePaint.setStrokeWidth(<span class="number">3</span>);</div><div class="line">                degreePaint.setTextSize(<span class="number">15</span>);</div><div class="line">                canvas.drawLine(width / <span class="number">2</span>, height / <span class="number">2</span> - width / <span class="number">2</span>,</div><div class="line">                        width / <span class="number">2</span>, height / <span class="number">2</span> - width / <span class="number">2</span> + <span class="number">30</span>, degreePaint);</div><div class="line">                String degree = String.valueOf(i);</div><div class="line">                canvas.drawText(degree,</div><div class="line">                        width / <span class="number">2</span> - degreePaint.measureText(degree) / <span class="number">2</span>, height / <span class="number">2</span> - width / <span class="number">2</span> + <span class="number">60</span>, degreePaint);</div><div class="line">            &#125;</div><div class="line">            canvas.rotate(<span class="number">15</span>, width / <span class="number">2</span>, height / <span class="number">2</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        canvas.save();</div><div class="line">        canvas.translate(width / <span class="number">2</span>, height / <span class="number">2</span>);</div><div class="line">        canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>, hourPaint);</div><div class="line">        canvas.drawLine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">200</span>, minutePaint);</div><div class="line">        canvas.restore();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下图：<br><img src="http://7xljei.com1.z0.glb.clouddn.com/4379274283332372.jpg" alt="仪表盘"></p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2013/0304/957.html" target="_blank" rel="external">Android Canvas编程：对rotate()和translate()两个方法的研究</a></p>
<h3 id="Layer图层"><a href="#Layer图层" class="headerlink" title="Layer图层"></a>Layer图层</h3><p>Android通过调用saveLayer()、saveLayerAlpha()方法将一个图层入栈(图层基于栈管理结构),<br>使用restore()、restoreToCount()方法将一个图层出栈。入栈的时候,后面所有的操作都发生在这个图层上,<br>而出栈的时候,则会把图像绘制到上层Canvas上。</p>
<p>如下的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint paint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LAYER_FLAGS =</div><div class="line">            Canvas.MATRIX_SAVE_FLAG |</div><div class="line">                    Canvas.CLIP_SAVE_FLAG |</div><div class="line">                    Canvas.HAS_ALPHA_LAYER_SAVE_FLAG |</div><div class="line">                    Canvas.FULL_COLOR_LAYER_SAVE_FLAG |</div><div class="line">                    Canvas.CLIP_TO_LAYER_SAVE_FLAG;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BasicView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setStrokeWidth(<span class="number">2</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawColor(Color.WHITE);</div><div class="line">        paint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line">        canvas.drawCircle(<span class="number">150</span>, <span class="number">150</span>, <span class="number">100</span>, paint);</div><div class="line"></div><div class="line">        <span class="comment">//127,255,0</span></div><div class="line">        canvas.saveLayerAlpha(<span class="number">0</span>, <span class="number">0</span>, <span class="number">400</span>, <span class="number">400</span>, <span class="number">0</span>, LAYER_FLAGS);</div><div class="line">        paint.setColor(getResources().getColor(R.color.colorPrimary));</div><div class="line">        canvas.drawCircle(<span class="number">200</span>, <span class="number">200</span>, <span class="number">100</span>, paint);</div><div class="line">        canvas.restore();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>透明为127的时候,半透明:</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160309152958.png" alt="半透明"></p>
<p>透明为255的时候,完全不透明:</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160309153018.png" alt="完全不透明"></p>
<p>透明为0的时候,完全透明:</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160309153027.png" alt="完全透明"></p>
<h2 id="Android图像处理之色彩特效处理"><a href="#Android图像处理之色彩特效处理" class="headerlink" title="Android图像处理之色彩特效处理"></a>Android图像处理之色彩特效处理</h2><h3 id="色彩矩阵"><a href="#色彩矩阵" class="headerlink" title="色彩矩阵"></a>色彩矩阵</h3><p>图像的色调、饱和度、亮度这三个属性在图像处理中使用非常之多,Android封装了一个ColorMatrix类（颜色矩阵）,<br>通过改变矩阵值来处理这些属性。</p>
<ul>
<li>色调：//第一个参数分别为red、green、blue 第二个参数为要处理的值。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ColorMatrix hueMatrix=<span class="keyword">new</span> ColorMatrix();</div><div class="line">      hueMatrix.setRotate(<span class="number">0</span>, hue);</div><div class="line">      hueMatrix.setRotate(<span class="number">1</span>, hue);</div><div class="line">      hueMatrix.setRotate(<span class="number">2</span>, hue);</div></pre></td></tr></table></figure>
<ul>
<li>饱和度：//参数即为饱和度,当饱和度为0时图像就变成灰图像了。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ColorMatrix saturationMatrix=<span class="keyword">new</span> ColorMatrix();</div><div class="line">      saturationMatrix.setSaturation(saturation);</div></pre></td></tr></table></figure>
<ul>
<li>亮度：//当三原色以相同比例进行混合的时候,就会显示出白色,从而调节亮度。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ColorMatrix lumMatrix=<span class="keyword">new</span> ColorMatrix();</div><div class="line">      lumMatrix.setScale(lum, lum, lum, <span class="number">1</span>);</div></pre></td></tr></table></figure>
<ul>
<li>让三种效果叠加：ColorMatrix imageMatrix=new ColorMatrix();</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">imageMatrix.postConcat(hueMatrix);</div><div class="line">imageMatrix.postConcat(saturationMatrix);</div><div class="line">imageMatrix.postConcat(lumMatrix);</div></pre></td></tr></table></figure>
<p>下面是个具体的案例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"24dp"</span></div><div class="line">        <span class="attr">android:layout_marginTop</span>=<span class="string">"24dp"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">SeekBar</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/seekbarHue"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_below</span>=<span class="string">"@id/imageview"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">SeekBar</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/seekbarSaturation"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_below</span>=<span class="string">"@id/seekbarHue"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">SeekBar</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/seekbatLum"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_below</span>=<span class="string">"@id/seekbarSaturation"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Bitmap处理类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.ColorMatrix;</div><div class="line"><span class="keyword">import</span> android.graphics.ColorMatrixColorFilter;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageHelper</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">handleImageEffect</span><span class="params">(Bitmap bm, <span class="keyword">float</span> hue, <span class="keyword">float</span> saturation, <span class="keyword">float</span> lum)</span> </span>&#123;</div><div class="line">        Bitmap bmp = Bitmap.createBitmap(</div><div class="line">                bm.getWidth(), bm.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line"></div><div class="line">        ColorMatrix hueMatrix = <span class="keyword">new</span> ColorMatrix();</div><div class="line">        hueMatrix.setRotate(<span class="number">0</span>, hue);</div><div class="line">        hueMatrix.setRotate(<span class="number">1</span>, hue);</div><div class="line">        hueMatrix.setRotate(<span class="number">2</span>, hue);</div><div class="line"></div><div class="line">        ColorMatrix saturationMatrix = <span class="keyword">new</span> ColorMatrix();</div><div class="line">        saturationMatrix.setSaturation(saturation);</div><div class="line"></div><div class="line">        ColorMatrix lumMatrix = <span class="keyword">new</span> ColorMatrix();</div><div class="line">        lumMatrix.setScale(lum, lum, lum, <span class="number">1</span>);</div><div class="line"></div><div class="line">        ColorMatrix imageMatrix = <span class="keyword">new</span> ColorMatrix();</div><div class="line">        imageMatrix.postConcat(hueMatrix);</div><div class="line">        imageMatrix.postConcat(saturationMatrix);</div><div class="line">        imageMatrix.postConcat(lumMatrix);</div><div class="line"></div><div class="line">        paint.setColorFilter(<span class="keyword">new</span> ColorMatrixColorFilter(imageMatrix));</div><div class="line">        canvas.drawBitmap(bm, <span class="number">0</span>, <span class="number">0</span>, paint);</div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"><span class="keyword">import</span> android.widget.SeekBar;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrimaryColorActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">SeekBar</span>.<span class="title">OnSeekBarChangeListener</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_VALUE = <span class="number">255</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> MID_VALUE = <span class="number">127</span>;</div><div class="line">    <span class="keyword">private</span> ImageView mImageView;</div><div class="line">    <span class="comment">//分别为色调,饱和度,亮度</span></div><div class="line">    <span class="keyword">private</span> SeekBar mSeekbarhue, mSeekbarSaturation, mSeekbarLum;</div><div class="line">    <span class="comment">//分别为色调,饱和度,亮度</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mHue, mStauration, mLum;</div><div class="line">    <span class="keyword">private</span> Bitmap bitmap;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_primary_color);</div><div class="line">        bitmap = BitmapFactory.decodeResource(getResources(),</div><div class="line">                R.drawable.icon);</div><div class="line">        mImageView = (ImageView) findViewById(R.id.imageview);</div><div class="line">        mSeekbarhue = (SeekBar) findViewById(R.id.seekbarHue);</div><div class="line">        mSeekbarSaturation = (SeekBar) findViewById(R.id.seekbarSaturation);</div><div class="line">        mSeekbarLum = (SeekBar) findViewById(R.id.seekbatLum);</div><div class="line">        mSeekbarhue.setOnSeekBarChangeListener(<span class="keyword">this</span>);</div><div class="line">        mSeekbarSaturation.setOnSeekBarChangeListener(<span class="keyword">this</span>);</div><div class="line">        mSeekbarLum.setOnSeekBarChangeListener(<span class="keyword">this</span>);</div><div class="line">        mSeekbarhue.setMax(MAX_VALUE);</div><div class="line">        mSeekbarSaturation.setMax(MAX_VALUE);</div><div class="line">        mSeekbarLum.setMax(MAX_VALUE);</div><div class="line">        mSeekbarhue.setProgress(MID_VALUE);</div><div class="line">        mSeekbarSaturation.setProgress(MID_VALUE);</div><div class="line">        mSeekbarLum.setProgress(MID_VALUE);</div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar seekBar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromUser)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (seekBar.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.seekbarHue:</div><div class="line">                mHue = (progress - MID_VALUE) * <span class="number">1.0F</span> / MID_VALUE * <span class="number">180</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.seekbarSaturation:</div><div class="line">                mStauration = progress * <span class="number">1.0F</span> / MID_VALUE;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> R.id.seekbatLum:</div><div class="line">                mLum = progress * <span class="number">1.0F</span> / MID_VALUE;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        mImageView.setImageBitmap(ImageHelper.handleImageEffect(</div><div class="line">                bitmap, mHue, mStauration, mLum));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStopTrackingTouch</span><span class="params">(SeekBar seekBar)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/119382253878632655.jpg" alt="效果图"></p>
<h3 id="Android颜色矩阵-ColorMatrix"><a href="#Android颜色矩阵-ColorMatrix" class="headerlink" title="Android颜色矩阵-ColorMatrix"></a>Android颜色矩阵-ColorMatrix</h3><p>代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/icon"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"2"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">GridLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/group"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"3"</span></div><div class="line">        <span class="attr">android:columnCount</span>=<span class="string">"5"</span></div><div class="line">        <span class="attr">android:rowCount</span>=<span class="string">"4"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">GridLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">            <span class="attr">android:onClick</span>=<span class="string">"btnChange"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"Change"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">            <span class="attr">android:onClick</span>=<span class="string">"btnReset"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"Reset"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.ColorMatrix;</div><div class="line"><span class="keyword">import</span> android.graphics.ColorMatrixColorFilter;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.GridLayout;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorMatrixActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ImageView mImageView;</div><div class="line">    <span class="keyword">private</span> GridLayout mGroup;</div><div class="line">    <span class="keyword">private</span> Bitmap bitmap;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mEtWidth, mEtHeight;</div><div class="line">    <span class="comment">//4*5的矩阵</span></div><div class="line">    <span class="keyword">private</span> EditText[] mEts = <span class="keyword">new</span> EditText[<span class="number">20</span>];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span>[] mColorMatrix = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">20</span>];</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_color_matrix);</div><div class="line">        bitmap = BitmapFactory.decodeResource(getResources(),</div><div class="line">                R.drawable.icon);</div><div class="line">        mImageView = (ImageView) findViewById(R.id.imageview);</div><div class="line">        mGroup = (GridLayout) findViewById(R.id.group);</div><div class="line">        mImageView.setImageBitmap(bitmap);</div><div class="line"></div><div class="line">        mGroup.post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">// 获取宽高信息</span></div><div class="line">                mEtWidth = mGroup.getWidth() / <span class="number">5</span>;</div><div class="line">                mEtHeight = mGroup.getHeight() / <span class="number">4</span>;</div><div class="line">                addEts();</div><div class="line">                initMatrix();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获取矩阵值</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getMatrix</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">            mColorMatrix[i] = Float.valueOf(</div><div class="line">                    mEts[i].getText().toString());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 将矩阵值设置到图像</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setImageMatrix</span><span class="params">()</span> </span>&#123;</div><div class="line">        Bitmap bmp = Bitmap.createBitmap(</div><div class="line">                bitmap.getWidth(),</div><div class="line">                bitmap.getHeight(),</div><div class="line">                Bitmap.Config.ARGB_8888);</div><div class="line">        android.graphics.ColorMatrix colorMatrix =</div><div class="line">                <span class="keyword">new</span> android.graphics.ColorMatrix();</div><div class="line">        colorMatrix.set(mColorMatrix);</div><div class="line"></div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(bmp);</div><div class="line">        Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setColorFilter(<span class="keyword">new</span> ColorMatrixColorFilter(colorMatrix));</div><div class="line">        canvas.drawBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, paint);</div><div class="line">        mImageView.setImageBitmap(bmp);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 作用矩阵效果</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnChange</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        getMatrix();</div><div class="line">        setImageMatrix();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 重置矩阵效果</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnReset</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        initMatrix();</div><div class="line">        getMatrix();</div><div class="line">        setImageMatrix();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 添加EditText</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addEts</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">            EditText editText = <span class="keyword">new</span> EditText(ColorMatrixActivity.<span class="keyword">this</span>);</div><div class="line">            mEts[i] = editText;</div><div class="line">            mGroup.addView(editText, mEtWidth, mEtHeight);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 初始化颜色矩阵为初始状态</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initMatrix</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (i % <span class="number">6</span> == <span class="number">0</span>) &#123;</div><div class="line">                mEts[i].setText(String.valueOf(<span class="number">1</span>));</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                mEts[i].setText(String.valueOf(<span class="number">0</span>));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里需要注意的是在Activity的onCreate方法中,无法获取到GridLayout的宽高,所以通过View的post方法,在视图创建完毕后获得其宽高值。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/868361883326946341.jpg" alt="高饱和度"></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/82765487251827052.jpg" alt="去色效果"></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/385029250006128362.jpg" alt="怀旧效果"></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/651940980052885974.jpg" alt="图像反转"></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/901854896512497535.jpg" alt="灰度效果"></p>
<h3 id="像素点分析"><a href="#像素点分析" class="headerlink" title="像素点分析"></a>像素点分析</h3><p>布局：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/imageview1"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/imageview2"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/imageview3"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/imageview4"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PixelsEffectActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ImageView imageView1, imageView2, imageView3, imageView4;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_pixels_effect);</div><div class="line">        Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">        imageView1 = (ImageView) findViewById(R.id.imageview1);</div><div class="line">        imageView2 = (ImageView) findViewById(R.id.imageview2);</div><div class="line">        imageView3 = (ImageView) findViewById(R.id.imageview3);</div><div class="line">        imageView4 = (ImageView) findViewById(R.id.imageview4);</div><div class="line"></div><div class="line">        imageView1.setImageBitmap(bitmap);</div><div class="line">        imageView2.setImageBitmap(ImageHelper.handleImageNegative(bitmap));</div><div class="line">        imageView3.setImageBitmap(ImageHelper.handleImagePixelsOldPhoto(bitmap));</div><div class="line">        imageView4.setImageBitmap(ImageHelper.handleImagePixelsRelief(bitmap));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>核心算法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//底片效果</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">handleImageNegative</span><span class="params">(Bitmap bm)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> width = bm.getWidth();</div><div class="line">        <span class="keyword">int</span> height = bm.getHeight();</div><div class="line">        <span class="keyword">int</span> color;</div><div class="line">        <span class="keyword">int</span> r, g, b, a;</div><div class="line"></div><div class="line">        Bitmap bmp = Bitmap.createBitmap(width, height</div><div class="line">                , Bitmap.Config.ARGB_8888);</div><div class="line"></div><div class="line">        <span class="keyword">int</span>[] oldPx = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line">        <span class="keyword">int</span>[] newPx = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line">        bm.getPixels(oldPx, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; width * height; i++) &#123;</div><div class="line">            color = oldPx[i];</div><div class="line">            r = Color.red(color);</div><div class="line">            g = Color.green(color);</div><div class="line">            b = Color.blue(color);</div><div class="line">            a = Color.alpha(color);</div><div class="line"></div><div class="line">            r = <span class="number">255</span> - r;</div><div class="line">            g = <span class="number">255</span> - g;</div><div class="line">            b = <span class="number">255</span> - b;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (r &gt; <span class="number">255</span>) &#123;</div><div class="line">                r = <span class="number">255</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r &lt; <span class="number">0</span>) &#123;</div><div class="line">                r = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (g &gt; <span class="number">255</span>) &#123;</div><div class="line">                g = <span class="number">255</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (g &lt; <span class="number">0</span>) &#123;</div><div class="line">                g = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (b &gt; <span class="number">255</span>) &#123;</div><div class="line">                b = <span class="number">255</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (b &lt; <span class="number">0</span>) &#123;</div><div class="line">                b = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            newPx[i] = Color.argb(a, r, g, b);</div><div class="line">        &#125;</div><div class="line">        bmp.setPixels(newPx, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//老照片效果</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">handleImagePixelsOldPhoto</span><span class="params">(Bitmap bm)</span> </span>&#123;</div><div class="line">        Bitmap bmp = Bitmap.createBitmap(bm.getWidth(), bm.getHeight(),</div><div class="line">                Bitmap.Config.ARGB_8888);</div><div class="line">        <span class="keyword">int</span> width = bm.getWidth();</div><div class="line">        <span class="keyword">int</span> height = bm.getHeight();</div><div class="line">        <span class="keyword">int</span> color = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> r, g, b, a, r1, g1, b1;</div><div class="line"></div><div class="line">        <span class="keyword">int</span>[] oldPx = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line">        <span class="keyword">int</span>[] newPx = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line"></div><div class="line">        bm.getPixels(oldPx, <span class="number">0</span>, bm.getWidth(), <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; width * height; i++) &#123;</div><div class="line">            color = oldPx[i];</div><div class="line">            a = Color.alpha(color);</div><div class="line">            r = Color.red(color);</div><div class="line">            g = Color.green(color);</div><div class="line">            b = Color.blue(color);</div><div class="line"></div><div class="line">            r1 = (<span class="keyword">int</span>) (<span class="number">0.393</span> * r + <span class="number">0.769</span> * g + <span class="number">0.189</span> * b);</div><div class="line">            g1 = (<span class="keyword">int</span>) (<span class="number">0.349</span> * r + <span class="number">0.686</span> * g + <span class="number">0.168</span> * b);</div><div class="line">            b1 = (<span class="keyword">int</span>) (<span class="number">0.272</span> * r + <span class="number">0.534</span> * g + <span class="number">0.131</span> * b);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (r1 &gt; <span class="number">255</span>) &#123;</div><div class="line">                r1 = <span class="number">255</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (g1 &gt; <span class="number">255</span>) &#123;</div><div class="line">                g1 = <span class="number">255</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (b1 &gt; <span class="number">255</span>) &#123;</div><div class="line">                b1 = <span class="number">255</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            newPx[i] = Color.argb(a, r1, g1, b1);</div><div class="line">        &#125;</div><div class="line">        bmp.setPixels(newPx, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//浮雕效果</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Bitmap <span class="title">handleImagePixelsRelief</span><span class="params">(Bitmap bm)</span> </span>&#123;</div><div class="line">        Bitmap bmp = Bitmap.createBitmap(bm.getWidth(), bm.getHeight(),</div><div class="line">                Bitmap.Config.ARGB_8888);</div><div class="line">        <span class="keyword">int</span> width = bm.getWidth();</div><div class="line">        <span class="keyword">int</span> height = bm.getHeight();</div><div class="line">        <span class="keyword">int</span> color = <span class="number">0</span>, colorBefore = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> a, r, g, b;</div><div class="line">        <span class="keyword">int</span> r1, g1, b1;</div><div class="line"></div><div class="line">        <span class="keyword">int</span>[] oldPx = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line">        <span class="keyword">int</span>[] newPx = <span class="keyword">new</span> <span class="keyword">int</span>[width * height];</div><div class="line"></div><div class="line">        bm.getPixels(oldPx, <span class="number">0</span>, bm.getWidth(), <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; width * height; i++) &#123;</div><div class="line">            colorBefore = oldPx[i - <span class="number">1</span>];</div><div class="line">            a = Color.alpha(colorBefore);</div><div class="line">            r = Color.red(colorBefore);</div><div class="line">            g = Color.green(colorBefore);</div><div class="line">            b = Color.blue(colorBefore);</div><div class="line"></div><div class="line">            color = oldPx[i];</div><div class="line">            r1 = Color.red(color);</div><div class="line">            g1 = Color.green(color);</div><div class="line">            b1 = Color.blue(color);</div><div class="line"></div><div class="line">            r = (r - r1 + <span class="number">127</span>);</div><div class="line">            g = (g - g1 + <span class="number">127</span>);</div><div class="line">            b = (b - b1 + <span class="number">127</span>);</div><div class="line">            <span class="keyword">if</span> (r &gt; <span class="number">255</span>) &#123;</div><div class="line">                r = <span class="number">255</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (g &gt; <span class="number">255</span>) &#123;</div><div class="line">                g = <span class="number">255</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (b &gt; <span class="number">255</span>) &#123;</div><div class="line">                b = <span class="number">255</span>;</div><div class="line">            &#125;</div><div class="line">            newPx[i] = Color.argb(a, r, g, b);</div><div class="line">        &#125;</div><div class="line">        bmp.setPixels(newPx, <span class="number">0</span>, width, <span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        <span class="keyword">return</span> bmp;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/716746336819656539.jpg" alt="效果图"></p>
<h2 id="Android图像处理之图形特效处理"><a href="#Android图像处理之图形特效处理" class="headerlink" title="Android图像处理之图形特效处理"></a>Android图像处理之图形特效处理</h2><h3 id="Android变形矩阵-Matrix"><a href="#Android变形矩阵-Matrix" class="headerlink" title="Android变形矩阵-Matrix"></a>Android变形矩阵-Matrix</h3><p>通过Matrix类来操作图形矩阵的变换<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">float</span>[] mImageMatrix=<span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">9</span>];</div><div class="line">Matrix matrix=<span class="keyword">new</span> Matrix();</div><div class="line">matrix.setValues(mImageMatrix);</div><div class="line"><span class="comment">//当获得一个变换矩阵以后通过以下代码将一个图像以这个变换矩阵的形式绘制出来</span></div><div class="line">canvas.drawBitmap(mBitmap,matrix,<span class="keyword">null</span>);</div></pre></td></tr></table></figure></p>
<p>以下是一些变换的方法：</p>
<ul>
<li><p>setScale(); 缩放变换</p>
</li>
<li><p>setSkew(); 错切变换</p>
</li>
<li><p>setRotate(); 旋转变换</p>
</li>
<li><p>setTranslate(); 平移变换</p>
</li>
<li><p>pre()和post() 提供矩阵的前乘和后乘运算</p>
</li>
</ul>
<p>具体案例：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">me.jarvischen.viewmechanism.ImageMatrixView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/view"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"2"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">GridLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/grid_group"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">android:layout_gravity</span>=<span class="string">"center_horizontal"</span></div><div class="line">        <span class="attr">android:layout_weight</span>=<span class="string">"3"</span></div><div class="line">        <span class="attr">android:columnCount</span>=<span class="string">"3"</span></div><div class="line">        <span class="attr">android:rowCount</span>=<span class="string">"3"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">GridLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">            <span class="attr">android:onClick</span>=<span class="string">"change"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"Change"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">            <span class="attr">android:onClick</span>=<span class="string">"reset"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"Reset"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ImageMatrixView.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Matrix;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageMatrixView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Matrix mMatrix;</div><div class="line">    <span class="keyword">private</span> Bitmap mBitmap;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageMatrixView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        initMyView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageMatrixView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        initMyView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageMatrixView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        initMyView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImageAndMatrix</span><span class="params">(Bitmap bm, Matrix matrix)</span> </span>&#123;</div><div class="line">        mMatrix = matrix;</div><div class="line">        mBitmap = bm;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMyView</span><span class="params">()</span> </span>&#123;</div><div class="line">        Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">        setImageAndMatrix(bitmap, <span class="keyword">new</span> Matrix());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawBitmap(mBitmap, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">        canvas.drawBitmap(mBitmap, mMatrix, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ImageMatrixActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Matrix;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.Gravity;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.GridLayout;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageMatrixActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> GridLayout mGridGroup;</div><div class="line">    <span class="keyword">private</span> ImageMatrixView mMyView;</div><div class="line">    <span class="keyword">private</span> Bitmap mBitmap;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mEtWidth = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mEtHeight = <span class="number">0</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span>[] mImageMatrix = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">9</span>];</div><div class="line">    <span class="keyword">private</span> EditText[] mETs = <span class="keyword">new</span> EditText[<span class="number">9</span>];</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_image_matrix);</div><div class="line">        mGridGroup = (GridLayout) findViewById(R.id.grid_group);</div><div class="line">        mMyView = (ImageMatrixView) findViewById(R.id.view);</div><div class="line">        mBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line"></div><div class="line">        mGridGroup.post(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                mEtWidth = mGridGroup.getWidth() / <span class="number">3</span>;</div><div class="line">                mEtHeight = mGridGroup.getHeight() / <span class="number">3</span>;</div><div class="line">                addEts();</div><div class="line">                initImageMatrix();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addEts</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</div><div class="line">            EditText et = <span class="keyword">new</span> EditText(ImageMatrixActivity.<span class="keyword">this</span>);</div><div class="line">            et.setGravity(Gravity.CENTER);</div><div class="line">            mETs[i] = et;</div><div class="line">            mGridGroup.addView(et, mEtWidth, mEtHeight);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getImageMatrix</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</div><div class="line">            EditText et = mETs[i];</div><div class="line">            mImageMatrix[i] = Float.valueOf(et.getText().toString());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initImageMatrix</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (i % <span class="number">4</span> == <span class="number">0</span>) &#123;</div><div class="line">                mETs[i].setText(String.valueOf(<span class="number">1</span>));</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                mETs[i].setText(String.valueOf(<span class="number">0</span>));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        getImageMatrix();</div><div class="line">        Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">        matrix.setValues(mImageMatrix);</div><div class="line"></div><div class="line"><span class="comment">//        matrix.setRotate(45);</span></div><div class="line"><span class="comment">//        matrix.postTranslate(200, 200);</span></div><div class="line"></div><div class="line"><span class="comment">//        matrix.setTranslate(200, 200);</span></div><div class="line"><span class="comment">//        matrix.preRotate(45);</span></div><div class="line"></div><div class="line"><span class="comment">//        matrix.setScale(1, -1);</span></div><div class="line"><span class="comment">//        matrix.postRotate(45);</span></div><div class="line"><span class="comment">//        matrix.postTranslate(0, 200);</span></div><div class="line"></div><div class="line"></div><div class="line">        mMyView.setImageAndMatrix(mBitmap, matrix);</div><div class="line">        mMyView.invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        initImageMatrix();</div><div class="line">        getImageMatrix();</div><div class="line">        Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">        matrix.setValues(mImageMatrix);</div><div class="line">        mMyView.setImageAndMatrix(mBitmap, matrix);</div><div class="line">        mMyView.invalidate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/603693274204448598.jpg" alt="效果图"></p>
<h3 id="像素块分析"><a href="#像素块分析" class="headerlink" title="像素块分析"></a>像素块分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">drawBitmapMesh(Bitmap bitmap,<span class="keyword">int</span> meshWidth,<span class="keyword">int</span> meshHeight,<span class="keyword">float</span>[] verts,</div><div class="line"><span class="keyword">float</span> vertOffset,<span class="keyword">int</span>[] colors,<span class="keyword">int</span> colorOffset,Paint paint);</div></pre></td></tr></table></figure>
<p>方法可以把图像分成一个一个的小块进行处理,其中各个参数的含义如下：</p>
<ul>
<li>bitmap——将要操作的图像</li>
<li>meshWidth——需要的横向网格数</li>
<li>meshHeight——需要的纵向网格数</li>
<li>verts——网格交叉点坐标数组</li>
<li>verftOffset——数组中开始跳过的（x,y）坐标数目</li>
<li>其中meshWidth和meshHeight以及verts的对应关系为：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">float</span>[] verts = <span class="keyword">new</span> <span class="keyword">float</span>[(meshWidth + <span class="number">1</span>) * (meshHeight + <span class="number">1</span>)]</div></pre></td></tr></table></figure>
<p>下面的代码实现了飘扬的旗帜的效果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlagBitmapMeshView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> WIDTH = <span class="number">200</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> HEIGHT = <span class="number">200</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> COUNT = (WIDTH + <span class="number">1</span>) * (HEIGHT + <span class="number">1</span>);</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span>[] verts = <span class="keyword">new</span> <span class="keyword">float</span>[COUNT * <span class="number">2</span>];</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span>[] orig = <span class="keyword">new</span> <span class="keyword">float</span>[COUNT * <span class="number">2</span>];</div><div class="line">    <span class="keyword">private</span> Bitmap bitmap;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> A;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> k = <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FlagBitmapMeshView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        initView(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FlagBitmapMeshView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        initView(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FlagBitmapMeshView</span><span class="params">(Context context, AttributeSet attrs,</span></span></div><div class="line">                              <span class="keyword">int</span> defStyleAttr) &#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        initView(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        setFocusable(<span class="keyword">true</span>);</div><div class="line">        bitmap = BitmapFactory.decodeResource(context.getResources(),</div><div class="line">                R.drawable.icon);</div><div class="line">        <span class="keyword">float</span> bitmapWidth = bitmap.getWidth();</div><div class="line">        <span class="keyword">float</span> bitmapHeight = bitmap.getHeight();</div><div class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="number">0</span>; y &lt;= HEIGHT; y++) &#123;</div><div class="line">            <span class="keyword">float</span> fy = bitmapHeight * y / HEIGHT;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="number">0</span>; x &lt;= WIDTH; x++) &#123;</div><div class="line">                <span class="keyword">float</span> fx = bitmapWidth * x / WIDTH;</div><div class="line">                orig[index * <span class="number">2</span> + <span class="number">0</span>] = verts[index * <span class="number">2</span> + <span class="number">0</span>] = fx;</div><div class="line">                orig[index * <span class="number">2</span> + <span class="number">1</span>] = verts[index * <span class="number">2</span> + <span class="number">1</span>] = fy + <span class="number">100</span>;</div><div class="line">                index += <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        A = <span class="number">50</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        flagWave();</div><div class="line">        k += <span class="number">0.1F</span>;</div><div class="line">        canvas.drawBitmapMesh(bitmap, WIDTH, HEIGHT,</div><div class="line">                verts, <span class="number">0</span>, <span class="keyword">null</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">flagWave</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= HEIGHT; j++) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= WIDTH; i++) &#123;</div><div class="line">                verts[(j * (WIDTH + <span class="number">1</span>) + i) * <span class="number">2</span> + <span class="number">0</span>] += <span class="number">0</span>;</div><div class="line">                <span class="keyword">float</span> offsetY =</div><div class="line">                        (<span class="keyword">float</span>) Math.sin((<span class="keyword">float</span>) i / WIDTH * <span class="number">2</span> * Math.PI +</div><div class="line">                                Math.PI * k);</div><div class="line">                verts[(j * (WIDTH + <span class="number">1</span>) + i) * <span class="number">2</span> + <span class="number">1</span>] =</div><div class="line">                        orig[(j * WIDTH + i) * <span class="number">2</span> + <span class="number">1</span>] + offsetY * A;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在布局中使用该View即可。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/494707027301025081.jpg" alt="效果图"></p>
<h2 id="Android图像处理之画笔特效处理"><a href="#Android图像处理之画笔特效处理" class="headerlink" title="Android图像处理之画笔特效处理"></a>Android图像处理之画笔特效处理</h2><h3 id="PorterDuffXfermode"><a href="#PorterDuffXfermode" class="headerlink" title="PorterDuffXfermode"></a>PorterDuffXfermode</h3><p><img src="http://7xljei.com1.z0.glb.clouddn.com/20160120092932372.png" alt="PorterDuffXfermode"></p>
<p>ProterDuffXfermode设置的是两个图层交集区域的显示方式,dst是先画的图形,而src是后画的图形。<br>经常用到DST_IN、SRC_IN模式来实现将一个矩形图片变成圆角或者圆形图片的效果。<br>如下：先用一个普通画笔画画一个遮罩层,再用带ProterDuffXfermode的画笔将图形画在罩层上,这样就可以通过上面所说的效果来混合两个图像了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.graphics.PorterDuff;</div><div class="line"><span class="keyword">import</span> android.graphics.PorterDuffXfermode;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XformodeView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Bitmap bitmap;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Bitmap out;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint paint;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XformodeView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XformodeView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XformodeView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">        out = Bitmap.createBitmap(bitmap.getWidth(), bitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(out);</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        canvas.drawRoundRect(<span class="number">0</span>, <span class="number">0</span>, bitmap.getWidth(), bitmap.getHeight(), <span class="number">160</span>, <span class="number">160</span>, paint);</div><div class="line">        paint.setXfermode(<span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.SRC_IN));</div><div class="line">        canvas.drawBitmap(bitmap, <span class="number">0</span>, <span class="number">0</span>, paint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawBitmap(out, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在相应的布局中:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">me.jarvischen.viewmechanism.XformodeView</span></span></div><div class="line">       <span class="attr">android:id</span>=<span class="string">"@+id/test"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"200dp"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">       <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></div><div class="line">       <span class="attr">android:layout_margin</span>=<span class="string">"20dp"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/297288634849395096.jpg" alt="效果图"></p>
<p>下面实现刮刮乐效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.graphics.Path;</div><div class="line"><span class="keyword">import</span> android.graphics.PorterDuff;</div><div class="line"><span class="keyword">import</span> android.graphics.PorterDuffXfermode;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> * 刮刮乐</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XformodeView2</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint paint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Path path;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Bitmap bgBitmap;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Bitmap fgBitmap;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Canvas canvas;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XformodeView2</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XformodeView2</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XformodeView2</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setAlpha(<span class="number">0</span>);</div><div class="line">        paint.setXfermode(<span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.SRC_IN));</div><div class="line">        paint.setStyle(Paint.Style.STROKE);</div><div class="line">        paint.setStrokeWidth(<span class="number">50</span>);</div><div class="line">        paint.setStrokeJoin(Paint.Join.ROUND);</div><div class="line">        paint.setStrokeCap(Paint.Cap.ROUND);</div><div class="line"></div><div class="line">        path = <span class="keyword">new</span> Path();</div><div class="line"></div><div class="line">        bgBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">        fgBitmap = Bitmap.createBitmap(bgBitmap.getWidth(), bgBitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line"></div><div class="line"></div><div class="line">        canvas = <span class="keyword">new</span> Canvas(fgBitmap);</div><div class="line">        canvas.drawColor(Color.GRAY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawBitmap(bgBitmap, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">        canvas.drawBitmap(fgBitmap, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                path.reset();</div><div class="line">                path.moveTo(event.getX(), event.getY());</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                path.lineTo(event.getX(), event.getY());</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        canvas.drawPath(path, paint);</div><div class="line">        invalidate();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>需要注意的是：</p>
<p>第一,初始化一些东西：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setAlpha(<span class="number">0</span>);</div><div class="line">        paint.setXfermode(<span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.SRC_IN));</div><div class="line">        paint.setStyle(Paint.Style.STROKE);</div><div class="line">        paint.setStrokeWidth(<span class="number">50</span>);</div><div class="line">        paint.setStrokeJoin(Paint.Join.ROUND);</div><div class="line">        paint.setStrokeCap(Paint.Cap.ROUND);</div><div class="line"></div><div class="line">        path = <span class="keyword">new</span> Path();</div><div class="line"></div><div class="line">        bgBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">        fgBitmap = Bitmap.createBitmap(bgBitmap.getWidth(), bgBitmap.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line"></div><div class="line"></div><div class="line">        canvas = <span class="keyword">new</span> Canvas(fgBitmap);</div><div class="line">        canvas.drawColor(Color.GRAY);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>其中,<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">paint.setStrokeJoin(Paint.Join.ROUND);</div><div class="line">paint.setStrokeCap(Paint.Cap.ROUND);</div></pre></td></tr></table></figure></p>
<p>是让笔触和连接处更加圆滑一些。</p>
<p>第二,获取用户手指滑动所产生的路径,使用Path保存用户手指划过的路径。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                path.reset();</div><div class="line">                path.moveTo(event.getX(), event.getY());</div><div class="line">                <span class="keyword">break</span>;</div><div class="line"></div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                path.lineTo(event.getX(), event.getY());</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        canvas.drawPath(path, paint);</div><div class="line">        invalidate();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>第三,需要将画笔的透明度设置为0,这样才能显示出擦除的效果。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/353223673934444001.jpg" alt="刮刮乐"></p>
<p>在使用PorterDuffXfermode时,最好在绘图时关闭硬件加速,因为有些模式不支持硬件加速。</p>
<h3 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h3><p>Shader称为着色器、渲染器,它用来实现一系列的渐变、渲染效果,Android中的Shader包括以下几种</p>
<ul>
<li>BitmapShader——位图Shader</li>
<li>LinearGradient——线性Shader</li>
<li>RadialGradient——光束Shader</li>
<li>SweepGradient——梯度Shader</li>
<li>ComposeShader——混合Shader</li>
</ul>
<p>与其他几个不同,BitmapShader产生的是一个图像,它的作用是通过Paint对画布进行指定Bitmap填充,填充时有以下几种模式选择：</p>
<ul>
<li>CLAMP拉伸——拉伸的是图片的最后那一个像素</li>
<li>REPEAT重复——横向、纵向不断重复</li>
<li>MIRROR镜像——横向、纵向不断反转重复</li>
</ul>
<p>关于这个Shader,下面这个<a href="http://blog.csdn.net/aigestudio/article/details/41799811" target="_blank" rel="external">博客</a>阐述的很清楚。</p>
<p>下面是BitmapShader的使用示例(讲一个矩形的图片变成一张圆形的图片)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">       bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">       bitmapShader = <span class="keyword">new</span> BitmapShader(bitmap, Shader.TileMode.CLAMP, Shader.TileMode.CLAMP);</div><div class="line">       paint = <span class="keyword">new</span> Paint();</div><div class="line">       paint.setShader(bitmapShader);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">       canvas.drawCircle(getWidth()/<span class="number">2</span> ,bitmap.getHeight()/<span class="number">2</span> + <span class="number">100</span>,<span class="number">200</span>,paint);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/153428206998797874.jpg" alt="效果图"></p>
<p>再看看改变更改模式的效果如何：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.icon);</div><div class="line">        bitmapShader = <span class="keyword">new</span> BitmapShader(bitmap, Shader.TileMode.REPEAT, Shader.TileMode.REPEAT);</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setShader(bitmapShader);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawCircle(getWidth()/<span class="number">2</span> ,bitmap.getHeight()/<span class="number">2</span> + <span class="number">100</span>,<span class="number">200</span>,paint);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/602647945883516863.jpg" alt="效果图"></p>
<p>再看看最常用的Shader—LinearGradient的用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">       paint = <span class="keyword">new</span> Paint();</div><div class="line">       paint.setShader(<span class="keyword">new</span> LinearGradient(<span class="number">0</span>,<span class="number">0</span>,<span class="number">400</span>,<span class="number">400</span>, Color.BLUE,Color.YELLOW,</div><div class="line">               Shader.TileMode.REPEAT));</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="meta">@Override</span></div><div class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">       <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">       canvas.drawRect(<span class="number">0</span>,<span class="number">0</span>,<span class="number">400</span>,<span class="number">400</span>,paint);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/368792901625564032.jpg" alt="效果图"></p>
<p>通常这些渐变效果不会单独直接的使用,而是会与前面的PorterDuffXformode结合一起使用,<br>下面的实例是两个东西一起使用实现倒影效果的案例。</p>
<ul>
<li>先把原图复制一份并进行翻转</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">srcBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.test);</div><div class="line">       Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">       matrix.setScale(<span class="number">1F</span>, -<span class="number">1F</span>);</div><div class="line">       refBitmap = Bitmap.createBitmap(srcBitmap, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">               srcBitmap.getWidth(), srcBitmap.getHeight(), matrix, <span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p><code>matrix.setScale(1F, -1F);</code>这个方法用来实现图片的垂直翻转。</p>
<ul>
<li>在onDraw方法中,首先绘制两张图：原图和倒影图,接下来,在倒影图上绘制一个图样大小的渐变矩形,<br>并通过Mode.DST_IN模式绘制到倒影图中,从而形成一个具有过渡效果的渐变层。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.graphics.LinearGradient;</div><div class="line"><span class="keyword">import</span> android.graphics.Matrix;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.graphics.PorterDuff;</div><div class="line"><span class="keyword">import</span> android.graphics.PorterDuffXfermode;</div><div class="line"><span class="keyword">import</span> android.graphics.Shader;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Bitmap srcBitmap;</div><div class="line">    <span class="keyword">private</span> Bitmap refBitmap;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint paint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> PorterDuffXfermode xfermode;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReflectView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReflectView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReflectView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        srcBitmap = BitmapFactory.decodeResource(getResources(), R.drawable.test);</div><div class="line">        Matrix matrix = <span class="keyword">new</span> Matrix();</div><div class="line">        matrix.setScale(<span class="number">1F</span>, -<span class="number">1F</span>);</div><div class="line">        refBitmap = Bitmap.createBitmap(srcBitmap, <span class="number">0</span>, <span class="number">0</span>,</div><div class="line">                srcBitmap.getWidth(), srcBitmap.getHeight(), matrix, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setShader(<span class="keyword">new</span> LinearGradient(<span class="number">0</span>, srcBitmap.getHeight(), <span class="number">0</span>,</div><div class="line">                srcBitmap.getHeight() + srcBitmap.getHeight() / <span class="number">4</span>,</div><div class="line">                <span class="number">0XDD000000</span>, <span class="number">0X10000000</span>, Shader.TileMode.CLAMP));</div><div class="line">        xfermode = <span class="keyword">new</span> PorterDuffXfermode(PorterDuff.Mode.DST_IN);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        canvas.drawColor(Color.BLACK);</div><div class="line">        canvas.drawBitmap(srcBitmap, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>);</div><div class="line">        canvas.drawBitmap(refBitmap, <span class="number">0</span>, srcBitmap.getHeight(), <span class="keyword">null</span>);</div><div class="line">        paint.setXfermode(xfermode);</div><div class="line">        canvas.drawRect(<span class="number">0</span>, srcBitmap.getHeight(), refBitmap.getWidth(), srcBitmap.getHeight()*<span class="number">2</span>, paint);</div><div class="line">        paint.setXfermode(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/130363963826656789.jpg" alt="图片倒影"></p>
<h3 id="PathEffect"><a href="#PathEffect" class="headerlink" title="PathEffect"></a>PathEffect</h3><p>这个类本身并没有做什么特殊的处理,只是继承了Object,通常我们使用的是它的几个子类。在使用的时候,通常是<br>PathEffect pe = new 一个具体的子类;<br>然后使用Paint的setPathEffect(PathEffect pe)方法即可。</p>
<p>具体的如图所示：</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/422970989822569566.jpg" alt="效果图"></p>
<ul>
<li><p>没加处理的效果</p>
</li>
<li><p>CornerPathEffect：</p>
</li>
</ul>
<p>这个类的作用就是将Path的各个连接线段之间的夹角用一种更平滑的方式连接,类似于圆弧与切线的效果。<br>一般的,通过CornerPathEffect(float radius)指定一个具体的圆弧半径来实例化一个CornerPathEffect。</p>
<ul>
<li>DiscretePathEffect：</li>
</ul>
<p>这个类的作用是打散Path的线段,使得在原来路径的基础上发生打散效果。<br>一般的,通过构造DiscretePathEffect(float segmentLength,float deviation)来构造一个实例,其中,segmentLength指定最大的段长,<br>deviation指定偏离量。</p>
<ul>
<li>DashPathEffect：</li>
</ul>
<p>这个类的作用就是将Path的线段虚线化。<br>构造函数为DashPathEffect(float[] intervals, float offset),其中intervals为虚线的ON和OFF数组,该数组的length必须大于等于2,<br>phase为绘制时的偏移量。</p>
<ul>
<li>PathDashPathEffect：</li>
</ul>
<p>这个类的作用是使用Path图形来填充当前的路径,其构造函数为PathDashPathEffect (Path shape, float advance, float phase,<br>PathDashPathEffect.Stylestyle)。<br>shape则是指填充图,advance指每个图形间的间距,phase为绘制时的偏移量,style为该类自由的枚举值,<br>有三种情况：Style.ROTATE、Style.MORPH和<br>Style.TRANSLATE。其中ROTATE的情况下,线段连接处的图形转换以旋转到与下一段移动方向相一致的角度进行转转,<br>MORPH时图形会以发生拉伸或压缩等变形的情况与下一段相连接,TRANSLATE时,图形会以位置平移的方式与下一段相连接。</p>
<ul>
<li>ComposePathEffect：</li>
</ul>
<p>组合效果,这个类需要两个PathEffect参数来构造一个实例,ComposePathEffect (PathEffect outerpe,PathEffect innerpe),表现时,<br>会首先将innerpe表现出来,然后再在innerpe的基础上去增加outerpe的效果。</p>
<h2 id="SurfaceView"><a href="#SurfaceView" class="headerlink" title="SurfaceView"></a>SurfaceView</h2><h3 id="SurfaceView和View的区别"><a href="#SurfaceView和View的区别" class="headerlink" title="SurfaceView和View的区别"></a>SurfaceView和View的区别</h3><p>一般的View通过刷新来重绘视图,Android系统通过发出VSYNC信号来进行屏幕的重绘,刷新的时间间隔是16ms。<br>如果在16ms内View完成了所需要执行的操作,那么用户在视觉上就不会产生卡顿的感觉;<br>而如果执行的逻辑太多,特别是需要频繁刷新的界面,如游戏界面,那么就会不断的阻塞主线程,从而导致界面卡顿。<br>为了避免这种问题,Android提供了SurfaceView来解决这个问题。<br>SurfaceView和View的区别主要是下面几点：</p>
<ul>
<li>View主要适用于主动更新的情况,而SurfaceView适用于被动更新,例如频繁的刷新。</li>
<li>View在主线程中对画面进行刷新,而SurfaceView通常会在一个子线程中进行页面的刷新。</li>
<li>View在绘图时没有使用双缓冲机制,而SurfaceView在底层实现了双缓冲机制。</li>
</ul>
<h3 id="SurfaceView的使用"><a href="#SurfaceView的使用" class="headerlink" title="SurfaceView的使用"></a>SurfaceView的使用</h3><ul>
<li>创建SurfaceView,一般继承自SurfaceView,并实现接口SurfaceHolderCallback。</li>
</ul>
<p>SurfaceHolderCallback接口的三个回调方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">  <span class="comment">//做一些初始化操作,例如开启子线程通过循环来实现不停地绘制</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>初始化SurfaceView</li>
</ul>
<p>初始化SurfaceHolder对象,并设置Callback<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">    mHolder = getHolder();</div><div class="line">    mHolder.addCallback(<span class="keyword">this</span>);</div><div class="line">    ......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>使用SurfaceView</li>
</ul>
<p>通过lockCanvas方法获取Canvas对象进行绘制,并通过unlockCanvasAndPost方法对画布内容进行提交<br>需要注意的是每次调用lockCanvas拿到的Canvas都是同一个Canvas对象,所以之前的操作都会保留,如果需要擦出,<br>可以在绘制之前调用<code>drawColor</code>方法来进行清屏。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        mCanvas = mHolder.lockCanvas();</div><div class="line">        <span class="comment">//mCanvas draw something</span></div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">        <span class="keyword">if</span> (mCanvas != <span class="keyword">null</span>)</div><div class="line">            mHolder.unlockCanvasAndPost(mCanvas);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>下面是模板代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySurfaceView</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">SurfaceHolder</span>.<span class="title">Callback</span>, <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> SurfaceHolder mHolder;</div><div class="line">    <span class="keyword">private</span> Canvas mCanvas;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsDrawing;</div><div class="line">    <span class="keyword">private</span> Path mPath;</div><div class="line">    <span class="keyword">private</span> Paint mPaint;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context, AttributeSet attrs,</span></span></div><div class="line">                      <span class="keyword">int</span> defStyle) &#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        mHolder = getHolder();</div><div class="line">        mHolder.addCallback(<span class="keyword">this</span>);</div><div class="line">        setFocusable(<span class="keyword">true</span>);</div><div class="line">        setFocusableInTouchMode(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">this</span>.setKeepScreenOn(<span class="keyword">true</span>);</div><div class="line">        mPath = <span class="keyword">new</span> Path();</div><div class="line">        mPaint = <span class="keyword">new</span> Paint();</div><div class="line">        mPaint.setColor(Color.RED);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(<span class="number">40</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">        mIsDrawing = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">this</span>).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">        mIsDrawing = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</div><div class="line">        <span class="keyword">while</span> (mIsDrawing) &#123;</div><div class="line">            draw();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</div><div class="line">        <span class="comment">// 50 - 100ms,经验值</span></div><div class="line">        <span class="keyword">if</span> (end - start &lt; <span class="number">100</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Thread.sleep(<span class="number">100</span> - (end - start));</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mCanvas = mHolder.lockCanvas();</div><div class="line">            mCanvas.drawColor(Color.WHITE);</div><div class="line">            mCanvas.drawPath(mPath, mPaint);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (mCanvas != <span class="keyword">null</span>)</div><div class="line">                mHolder.unlockCanvasAndPost(mCanvas);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                mPath.moveTo(x, y);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                mPath.lineTo(x, y);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="案例：正弦曲线"><a href="#案例：正弦曲线" class="headerlink" title="案例：正弦曲线"></a>案例：正弦曲线</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.graphics.Path;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceHolder;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySurfaceView</span>  <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">SurfaceHolder</span>.<span class="title">Callback</span>,<span class="title">Runnable</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> SurfaceHolder holder;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Canvas canvas;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isDrawing;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Path path;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint paint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x,y;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MySurfaceView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        holder = getHolder();</div><div class="line">        holder.addCallback(<span class="keyword">this</span>);</div><div class="line">        setFocusable(<span class="keyword">true</span>);</div><div class="line">        setFocusableInTouchMode(<span class="keyword">true</span>);</div><div class="line">        path = <span class="keyword">new</span> Path();</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">        paint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line">        paint.setStyle(Paint.Style.STROKE);</div><div class="line">        paint.setStrokeWidth(<span class="number">10</span>);</div><div class="line">        paint.setStrokeCap(Paint.Cap.ROUND);</div><div class="line">        paint.setStrokeJoin(Paint.Join.ROUND);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">        isDrawing = <span class="keyword">true</span>;</div><div class="line">        path.moveTo(<span class="number">0</span>,<span class="number">400</span>);</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">this</span>).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">        isDrawing = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (isDrawing)&#123;</div><div class="line">            draw();</div><div class="line">            x+=<span class="number">1</span>;</div><div class="line">            y = (<span class="keyword">int</span>) (<span class="number">100</span>*Math.sin(x*<span class="number">2</span>*Math.PI/<span class="number">180</span>) + <span class="number">400</span>);</div><div class="line">            path.lineTo(x,y);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            canvas = holder.lockCanvas();</div><div class="line">            canvas.drawColor(Color.WHITE);</div><div class="line">            canvas.drawPath(path,paint);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (canvas != <span class="keyword">null</span>)&#123;</div><div class="line">                holder.unlockCanvasAndPost(canvas);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下：</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/530942805244665603.jpg" alt="效果图"></p>
<h3 id="案例：复杂数学曲线的绘制"><a href="#案例：复杂数学曲线的绘制" class="headerlink" title="案例：复杂数学曲线的绘制"></a>案例：复杂数学曲线的绘制</h3><p>来自<a href="http://chenfuduo.me/2016/01/29/fun-math-curves/" target="_blank" rel="external">我的博客</a></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/S60129-161610.jpg" alt="效果图"></p>
<h3 id="绘图板"><a href="#绘图板" class="headerlink" title="绘图板"></a>绘图板</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.viewmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.graphics.Path;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.MotionEvent;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceHolder;</div><div class="line"><span class="keyword">import</span> android.view.SurfaceView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleDrawWithSurfaceView</span>  <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">SurfaceHolder</span>.<span class="title">Callback</span>, <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> SurfaceHolder mHolder;</div><div class="line">    <span class="keyword">private</span> Canvas mCanvas;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsDrawing;</div><div class="line">    <span class="keyword">private</span> Path mPath;</div><div class="line">    <span class="keyword">private</span> Paint mPaint;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleDrawWithSurfaceView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleDrawWithSurfaceView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleDrawWithSurfaceView</span><span class="params">(Context context, AttributeSet attrs,</span></span></div><div class="line">                         <span class="keyword">int</span> defStyle) &#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">        initView();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        mHolder = getHolder();</div><div class="line">        mHolder.addCallback(<span class="keyword">this</span>);</div><div class="line">        setFocusable(<span class="keyword">true</span>);</div><div class="line">        setFocusableInTouchMode(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">this</span>.setKeepScreenOn(<span class="keyword">true</span>);</div><div class="line">        mPath = <span class="keyword">new</span> Path();</div><div class="line">        mPaint = <span class="keyword">new</span> Paint();</div><div class="line">        mPaint.setColor(Color.RED);</div><div class="line">        mPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mPaint.setStrokeWidth(<span class="number">40</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">        mIsDrawing = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">new</span> Thread(<span class="keyword">this</span>).start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</div><div class="line">        mIsDrawing = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</div><div class="line">        <span class="keyword">while</span> (mIsDrawing) &#123;</div><div class="line">            draw();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</div><div class="line">        <span class="comment">// 50 - 100ms,经验值</span></div><div class="line">        <span class="keyword">if</span> (end - start &lt; <span class="number">100</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Thread.sleep(<span class="number">100</span> - (end - start));</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            mCanvas = mHolder.lockCanvas();</div><div class="line">            mCanvas.drawColor(Color.WHITE);</div><div class="line">            mCanvas.drawPath(mPath, mPaint);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (mCanvas != <span class="keyword">null</span>)</div><div class="line">                mHolder.unlockCanvasAndPost(mCanvas);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</div><div class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</div><div class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                mPath.moveTo(x, y);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                mPath.lineTo(x, y);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里时间的判断是因为我们不需要他那么频繁的刷新。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/223678467572715827.jpg" alt="效果图"></p>
<h1 id="Android动画机制与使用技巧"><a href="#Android动画机制与使用技巧" class="headerlink" title="Android动画机制与使用技巧"></a>Android动画机制与使用技巧</h1><h2 id="View动画"><a href="#View动画" class="headerlink" title="View动画"></a>View动画</h2><p>包括帧动画和补间动画。</p>
<p>View动画的缺陷在于他的不可交互性。当某个元素发生View动画后,其响应事件的位置还依然在动画前的地方。其次View动画只能作用在View动画中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.animation.AlphaAnimation;</div><div class="line"><span class="keyword">import</span> android.view.animation.Animation;</div><div class="line"><span class="keyword">import</span> android.view.animation.AnimationSet;</div><div class="line"><span class="keyword">import</span> android.view.animation.RotateAnimation;</div><div class="line"><span class="keyword">import</span> android.view.animation.ScaleAnimation;</div><div class="line"><span class="keyword">import</span> android.view.animation.TranslateAnimation;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewAnimationActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ImageView iv;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_view_animation);</div><div class="line">        iv = (ImageView) findViewById(R.id.iv);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnAlpha</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        AlphaAnimation aa = <span class="keyword">new</span> AlphaAnimation(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        aa.setDuration(<span class="number">3000</span>);</div><div class="line">        iv.startAnimation(aa);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnRotate</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="comment">//方案1</span></div><div class="line">       <span class="comment">/* RotateAnimation ra = new RotateAnimation(0,360,100,100);</span></div><div class="line">        ra.setDuration(3000);</div><div class="line">        iv.startAnimation(ra);*/</div><div class="line"></div><div class="line">        <span class="comment">//方案2</span></div><div class="line">        RotateAnimation ra = <span class="keyword">new</span> RotateAnimation(<span class="number">0</span>, <span class="number">360</span>,</div><div class="line">                RotateAnimation.RELATIVE_TO_SELF, <span class="number">0.5f</span>,</div><div class="line">                RotateAnimation.RELATIVE_TO_SELF, <span class="number">0.5f</span>);</div><div class="line">        ra.setDuration(<span class="number">3000</span>);</div><div class="line">        iv.startAnimation(ra);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnTranslate</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        TranslateAnimation ta = <span class="keyword">new</span> TranslateAnimation(<span class="number">0</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="number">300</span>);</div><div class="line">        ta.setDuration(<span class="number">3000</span>);</div><div class="line">        iv.startAnimation(ta);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnScale</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="comment">//方案1</span></div><div class="line">        <span class="comment">/*ScaleAnimation sa = new ScaleAnimation(0,2,0,2);</span></div><div class="line">        sa.setDuration(3000);</div><div class="line">        iv.startAnimation(sa);*/</div><div class="line">        <span class="comment">//方案2</span></div><div class="line">        ScaleAnimation sa = <span class="keyword">new</span> ScaleAnimation(<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>,</div><div class="line">                Animation.RELATIVE_TO_SELF, <span class="number">0.5f</span>);</div><div class="line">        sa.setDuration(<span class="number">3000</span>);</div><div class="line">        iv.startAnimation(sa);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">btnSet</span><span class="params">(View view)</span></span>&#123;</div><div class="line">        AnimationSet as = <span class="keyword">new</span> AnimationSet(<span class="keyword">true</span>);</div><div class="line">        as.setDuration(<span class="number">1500</span>);</div><div class="line"></div><div class="line">        AlphaAnimation aa = <span class="keyword">new</span> AlphaAnimation(<span class="number">0</span>, <span class="number">1</span>);</div><div class="line">        aa.setDuration(<span class="number">1500</span>);</div><div class="line">        as.addAnimation(aa);</div><div class="line"></div><div class="line">        TranslateAnimation ta = <span class="keyword">new</span> TranslateAnimation(<span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">200</span>);</div><div class="line">        ta.setDuration(<span class="number">1500</span>);</div><div class="line">        as.addAnimation(ta);</div><div class="line"></div><div class="line">        iv.startAnimation(as);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="属性动画-1"><a href="#属性动画-1" class="headerlink" title="属性动画"></a>属性动画</h2><p>属性动画参考这几篇文章。<br><a href="http://blog.csdn.net/guolin_blog/article/details/43536355" target="_blank" rel="external">Android属性动画完全解析(上),初识属性动画的基本用法</a></p>
<p>其中实现的代码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.Animator;</div><div class="line"><span class="keyword">import</span> android.animation.AnimatorInflater;</div><div class="line"><span class="keyword">import</span> android.animation.AnimatorListenerAdapter;</div><div class="line"><span class="keyword">import</span> android.animation.AnimatorSet;</div><div class="line"><span class="keyword">import</span> android.animation.ObjectAnimator;</div><div class="line"><span class="keyword">import</span> android.animation.ValueAnimator;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicPropertyAnimationActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"BasicProperty"</span>;</div><div class="line">    <span class="keyword">private</span> ImageView iv;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_property_animation);</div><div class="line">        iv = (ImageView) findViewById(R.id.iv);</div><div class="line">        <span class="comment">//从xml加载动画</span></div><div class="line">        <span class="keyword">final</span> Animator animator = AnimatorInflater.loadAnimator(<span class="keyword">this</span>, R.animator.animatorset_set);</div><div class="line">        animator.setTarget(iv);</div><div class="line">        animator.setDuration(<span class="number">3000</span>);</div><div class="line">        animator.start();</div><div class="line">        animator.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                <span class="keyword">super</span>.onAnimationEnd(animation);</div><div class="line">                animator.start();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">valueAnimator1</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> ValueAnimator valueAnimator = ValueAnimator.ofFloat(<span class="number">55</span>, <span class="number">233</span>);</div><div class="line">        valueAnimator.setDuration(<span class="number">3000</span>);</div><div class="line">        valueAnimator.start();</div><div class="line">        valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">                <span class="keyword">float</span> animatedValue = (<span class="keyword">float</span>) valueAnimator.getAnimatedValue();</div><div class="line">                Log.e(TAG, <span class="string">"onAnimationUpdate="</span> + animatedValue);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">objectAnimator1Alpha</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="comment">//透明度</span></div><div class="line">        ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(iv, <span class="string">"alpha"</span>, <span class="number">1f</span>, <span class="number">0f</span>, <span class="number">1f</span>);</div><div class="line">        objectAnimator.setDuration(<span class="number">1500</span>);</div><div class="line">        objectAnimator.setRepeatCount(<span class="number">100</span>);</div><div class="line">        objectAnimator.setRepeatMode(ObjectAnimator.REVERSE);</div><div class="line">        objectAnimator.start();</div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//添加Animator监听器(接口的四个方法全部实现了)</span></div><div class="line">        objectAnimator.addListener(<span class="keyword">new</span> Animator.AnimatorListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationStart</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationCancel</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationRepeat</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">objectAnimator1Rotation</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="comment">//旋转</span></div><div class="line">        ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(iv, <span class="string">"rotation"</span>, <span class="number">0f</span>, <span class="number">360f</span>);</div><div class="line">        objectAnimator.setDuration(<span class="number">1500</span>);</div><div class="line">        objectAnimator.setRepeatCount(<span class="number">100</span>);</div><div class="line">        objectAnimator.setRepeatMode(ObjectAnimator.REVERSE);</div><div class="line">        objectAnimator.start();</div><div class="line"></div><div class="line">        <span class="comment">//添加Animator监听器(AnimatorListenerAdapter这种方式只需要选择自己需要的方法即可,不需要四个全部实现)</span></div><div class="line">        objectAnimator.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                <span class="keyword">super</span>.onAnimationEnd(animation);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">objectAnimator1translationX</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="comment">//平移</span></div><div class="line">        <span class="keyword">float</span> translationX = iv.getTranslationX();</div><div class="line">        ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(iv, <span class="string">"translationX"</span>, translationX, -<span class="number">500f</span>, translationX);</div><div class="line">        objectAnimator.setDuration(<span class="number">1500</span>);</div><div class="line">        objectAnimator.setRepeatCount(<span class="number">100</span>);</div><div class="line">        objectAnimator.setRepeatMode(ObjectAnimator.REVERSE);</div><div class="line">        objectAnimator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">objectAnimator1scaleY</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="comment">//缩放</span></div><div class="line">        ObjectAnimator objectAnimator = ObjectAnimator.ofFloat(iv, <span class="string">"scaleY"</span>, <span class="number">1f</span>, <span class="number">1</span> / <span class="number">2f</span>, <span class="number">1f</span>);</div><div class="line">        objectAnimator.setDuration(<span class="number">1500</span>);</div><div class="line">        objectAnimator.setRepeatCount(<span class="number">100</span>);</div><div class="line">        objectAnimator.setRepeatMode(ObjectAnimator.REVERSE);</div><div class="line">        objectAnimator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">objectAnimator1set</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        ObjectAnimator moveIn = ObjectAnimator.ofFloat(iv, <span class="string">"translationX"</span>, -<span class="number">500f</span>, <span class="number">0f</span>);</div><div class="line">        ObjectAnimator rotate = ObjectAnimator.ofFloat(iv, <span class="string">"rotation"</span>, <span class="number">0f</span>, <span class="number">360f</span>);</div><div class="line">        ObjectAnimator fadeInOut = ObjectAnimator.ofFloat(iv, <span class="string">"alpha"</span>, <span class="number">1f</span>, <span class="number">0f</span>, <span class="number">1f</span>);</div><div class="line">        AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        animatorSet.play(rotate).with(fadeInOut).after(moveIn);</div><div class="line">        animatorSet.setDuration(<span class="number">2000</span>);</div><div class="line">        animatorSet.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用AnimatorInflater的loadAnimator方法加载xml动画的文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:ordering</span>=<span class="string">"sequentially"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"2000"</span></div><div class="line">        <span class="attr">android:propertyName</span>=<span class="string">"translationX"</span></div><div class="line">        <span class="attr">android:valueFrom</span>=<span class="string">"-500"</span></div><div class="line">        <span class="attr">android:valueTo</span>=<span class="string">"0"</span></div><div class="line">        <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>&gt;<span class="tag">&lt;/<span class="name">objectAnimator</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">set</span> <span class="attr">android:ordering</span>=<span class="string">"together"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">            <span class="attr">android:duration</span>=<span class="string">"3000"</span></div><div class="line">            <span class="attr">android:propertyName</span>=<span class="string">"rotation"</span></div><div class="line">            <span class="attr">android:valueFrom</span>=<span class="string">"0"</span></div><div class="line">            <span class="attr">android:valueTo</span>=<span class="string">"360"</span></div><div class="line">            <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>&gt;<span class="tag">&lt;/<span class="name">objectAnimator</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">android:ordering</span>=<span class="string">"sequentially"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">                <span class="attr">android:duration</span>=<span class="string">"1500"</span></div><div class="line">                <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></div><div class="line">                <span class="attr">android:valueFrom</span>=<span class="string">"1"</span></div><div class="line">                <span class="attr">android:valueTo</span>=<span class="string">"0"</span></div><div class="line">                <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>&gt;<span class="tag">&lt;/<span class="name">objectAnimator</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line">                <span class="attr">android:duration</span>=<span class="string">"1500"</span></div><div class="line">                <span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></div><div class="line">                <span class="attr">android:valueFrom</span>=<span class="string">"0"</span></div><div class="line">                <span class="attr">android:valueTo</span>=<span class="string">"1"</span></div><div class="line">                <span class="attr">android:valueType</span>=<span class="string">"floatType"</span>&gt;<span class="tag">&lt;/<span class="name">objectAnimator</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/43816093" target="_blank" rel="external">Android属性动画完全解析(中),ValueAnimator和ObjectAnimator的高级用法</a></p>
<p>这部分是核心,其中代码如下：<br>实体类Point.java：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism.advancepropertyanimation;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> x;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> y;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Point</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.x = x;</div><div class="line">        <span class="keyword">this</span>.y = y;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getX</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> x;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getY</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> y;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>两个实现TypeEvaluator接口的Evaluator,PointEvaluator.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism.advancepropertyanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.TypeEvaluator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PointEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>&#123;</div><div class="line">        Point startPoint = (Point) startValue;</div><div class="line">        Point endPoint = (Point) endValue;</div><div class="line">        <span class="keyword">float</span> x = startPoint.getX() + fraction * (endPoint.getX() - startPoint.getX());</div><div class="line">        <span class="keyword">float</span> y = startPoint.getY() + fraction * (endPoint.getY() - startPoint.getY());</div><div class="line">        Point point = <span class="keyword">new</span> Point(x,y);</div><div class="line">        <span class="keyword">return</span> point;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个比较好理解。</p>
<p>ColorEvaluator.java,这个里面的evaluate方法不是很好理解,参考ArgbEvaluator这个类中的evaluate方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism.advancepropertyanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.TypeEvaluator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ColorEvaluator</span> <span class="keyword">implements</span> <span class="title">TypeEvaluator</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentRed = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentGreen = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCurrentBlue = -<span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">evaluate</span><span class="params">(<span class="keyword">float</span> fraction, Object startValue, Object endValue)</span> </span>&#123;</div><div class="line">        String startColor = (String) startValue;</div><div class="line">        String endColor = (String) endValue;</div><div class="line">        <span class="keyword">int</span> startRed = Integer.parseInt(startColor.substring(<span class="number">1</span>, <span class="number">3</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> startGreen = Integer.parseInt(startColor.substring(<span class="number">3</span>, <span class="number">5</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> startBlue = Integer.parseInt(startColor.substring(<span class="number">5</span>, <span class="number">7</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> endRed = Integer.parseInt(endColor.substring(<span class="number">1</span>, <span class="number">3</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> endGreen = Integer.parseInt(endColor.substring(<span class="number">3</span>, <span class="number">5</span>), <span class="number">16</span>);</div><div class="line">        <span class="keyword">int</span> endBlue = Integer.parseInt(endColor.substring(<span class="number">5</span>, <span class="number">7</span>), <span class="number">16</span>);</div><div class="line">        <span class="comment">// 初始化颜色的值</span></div><div class="line">        <span class="keyword">if</span> (mCurrentRed == -<span class="number">1</span>) &#123;</div><div class="line">            mCurrentRed = startRed;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mCurrentGreen == -<span class="number">1</span>) &#123;</div><div class="line">            mCurrentGreen = startGreen;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (mCurrentBlue == -<span class="number">1</span>) &#123;</div><div class="line">            mCurrentBlue = startBlue;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 计算初始颜色和结束颜色之间的差值</span></div><div class="line">        <span class="keyword">int</span> redDiff = Math.abs(startRed - endRed);</div><div class="line">        <span class="keyword">int</span> greenDiff = Math.abs(startGreen - endGreen);</div><div class="line">        <span class="keyword">int</span> blueDiff = Math.abs(startBlue - endBlue);</div><div class="line">        <span class="keyword">int</span> colorDiff = redDiff + greenDiff + blueDiff;</div><div class="line">        <span class="keyword">if</span> (mCurrentRed != endRed) &#123;</div><div class="line">            mCurrentRed = getCurrentColor(startRed, endRed, colorDiff, <span class="number">0</span>,</div><div class="line">                    fraction);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mCurrentGreen != endGreen) &#123;</div><div class="line">            mCurrentGreen = getCurrentColor(startGreen, endGreen, colorDiff,</div><div class="line">                    redDiff, fraction);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mCurrentBlue != endBlue) &#123;</div><div class="line">            mCurrentBlue = getCurrentColor(startBlue, endBlue, colorDiff,</div><div class="line">                    redDiff + greenDiff, fraction);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 将计算出的当前颜色的值组装返回</span></div><div class="line">        String currentColor = <span class="string">"#"</span> + getHexString(mCurrentRed)</div><div class="line">                + getHexString(mCurrentGreen) + getHexString(mCurrentBlue);</div><div class="line">        <span class="keyword">return</span> currentColor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 根据fraction值来计算当前的颜色。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getCurrentColor</span><span class="params">(<span class="keyword">int</span> startColor, <span class="keyword">int</span> endColor, <span class="keyword">int</span> colorDiff,</span></span></div><div class="line">                                <span class="keyword">int</span> offset, <span class="keyword">float</span> fraction) &#123;</div><div class="line">        <span class="keyword">int</span> currentColor;</div><div class="line">        <span class="keyword">if</span> (startColor &gt; endColor) &#123;</div><div class="line">            currentColor = (<span class="keyword">int</span>) (startColor - (fraction * colorDiff - offset));</div><div class="line">            <span class="keyword">if</span> (currentColor &lt; endColor) &#123;</div><div class="line">                currentColor = endColor;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            currentColor = (<span class="keyword">int</span>) (startColor + (fraction * colorDiff - offset));</div><div class="line">            <span class="keyword">if</span> (currentColor &gt; endColor) &#123;</div><div class="line">                currentColor = endColor;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> currentColor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 将10进制颜色值转换成16进制。</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getHexString</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">        String hexString = Integer.toHexString(value);</div><div class="line">        <span class="keyword">if</span> (hexString.length() == <span class="number">1</span>) &#123;</div><div class="line">            hexString = <span class="string">"0"</span> + hexString;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> hexString;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后是自定义的View。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism.advancepropertyanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.Animator;</div><div class="line"><span class="keyword">import</span> android.animation.AnimatorListenerAdapter;</div><div class="line"><span class="keyword">import</span> android.animation.AnimatorSet;</div><div class="line"><span class="keyword">import</span> android.animation.ObjectAnimator;</div><div class="line"><span class="keyword">import</span> android.animation.ValueAnimator;</div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="keyword">import</span> me.jarvischen.animationmechanism.R;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by chenfuduo on 2016/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnimView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> RADIUS = <span class="number">50.0f</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Point currentPoint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Paint paint;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String color;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAnimView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAnimView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAnimView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        paint = <span class="keyword">new</span> Paint();</div><div class="line">        paint.setColor(getResources().getColor(R.color.colorAccent));</div><div class="line">        paint.setAntiAlias(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getColor</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> color;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setColor</span><span class="params">(String color)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.color = color;</div><div class="line">        paint.setColor(Color.parseColor(color));</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        <span class="keyword">if</span> (currentPoint == <span class="keyword">null</span>) &#123;</div><div class="line">            currentPoint = <span class="keyword">new</span> Point(RADIUS, RADIUS);</div><div class="line">            drawCircle(canvas);</div><div class="line">            startAnimation();</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            drawCircle(canvas);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAnimation</span><span class="params">()</span> </span>&#123;</div><div class="line">        Point startPoint = <span class="keyword">new</span> Point(RADIUS, RADIUS);</div><div class="line">        Point endPoint = <span class="keyword">new</span> Point(getWidth() - RADIUS, getHeight() - RADIUS);</div><div class="line">        <span class="keyword">final</span> ValueAnimator valueAnimator = ValueAnimator.ofObject(<span class="keyword">new</span> PointEvaluator(), startPoint, endPoint);</div><div class="line">        valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">                currentPoint = (Point) valueAnimator.getAnimatedValue();</div><div class="line">                invalidate();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">       <span class="comment">/* valueAnimator.setDuration(2500);</span></div><div class="line">        valueAnimator.start();</div><div class="line">        valueAnimator.setRepeatCount(100);</div><div class="line">        valueAnimator.setRepeatMode(ValueAnimator.REVERSE);*/</div><div class="line"></div><div class="line">        ObjectAnimator anim2 = ObjectAnimator.ofObject(<span class="keyword">this</span>, <span class="string">"color"</span>, <span class="keyword">new</span> ColorEvaluator(),</div><div class="line">                <span class="string">"#0000FF"</span>, <span class="string">"#FF0000"</span>);</div><div class="line">        <span class="keyword">final</span> AnimatorSet animSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        animSet.play(valueAnimator).with(anim2);</div><div class="line">        animSet.setDuration(<span class="number">2500</span>);</div><div class="line">        animSet.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> x = currentPoint.getX();</div><div class="line">        <span class="keyword">float</span> y = currentPoint.getY();</div><div class="line">        canvas.drawCircle(x, y, RADIUS, paint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/44171115" target="_blank" rel="external">Android属性动画完全解析(下),nterpolator和ViewPropertyAnimator的用法</a></p>
<p>自定义Interpolator时,实现TimeInterpolator接口并实现他的方法即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DecelerateAccelerateInterpolator</span> <span class="keyword">implements</span> <span class="title">TimeInterpolator</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> result;</div><div class="line">        <span class="keyword">if</span> (input &lt;= <span class="number">0.5</span>) &#123;</div><div class="line">            result = (<span class="keyword">float</span>) (Math.sin(Math.PI * input)) / <span class="number">2</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            result = (<span class="keyword">float</span>) (<span class="number">2</span> - Math.sin(Math.PI * input)) / <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ViewPropertyAnimator的用法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">myAnimView.animate().alpha(<span class="number">0f</span>);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">textview.animate().x(<span class="number">500</span>).y(<span class="number">500</span>);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">textview.animate().x(<span class="number">500</span>).y(<span class="number">500</span>).setDuration(<span class="number">5000</span>)</div><div class="line">    .setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div></pre></td></tr></table></figure>
<h2 id="布局动画"><a href="#布局动画" class="headerlink" title="布局动画"></a>布局动画</h2><p>布局动画是作用在ViewGroup上的,给ViewGroup添加view时添加动画过渡效果。</p>
<ul>
<li>简易方式（但是没有什么效果）：在xml中添加如下属性 android:animateLayoutChanges=”true</li>
<li>通过LayoutAnimationController来自定义子view的过渡效果,下面是一个常见的使用例子：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">LinearLayout linearLayout = (LinearLayout) findViewById(R.id.ll);</div><div class="line">ScaleAnimation scaleAnimation = <span class="keyword">new</span> ScaleAnimation(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</div><div class="line">scaleAnimation.setDuration(<span class="number">2000</span>);</div><div class="line">LayoutAnimationController controller = <span class="keyword">new</span> LayoutAnimationController(scaleAnimation, <span class="number">0.5f</span>);</div><div class="line">controller.setOrder(LayoutAnimationController.ORDER_NORMAL);<span class="comment">//NORMAL 顺序 RANDOM 随机 REVERSE 反序</span></div><div class="line">linearLayout.setLayoutAnimation(controller);</div></pre></td></tr></table></figure>
<h1 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h1><p>创建自定义动画就是要实现它的<code>applyTransformation</code>的逻辑,不过通常还需要覆盖父类的initialize方法来实现初始化工作。<br>下面是一个模拟电视机关闭的动画,<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomTV</span> <span class="keyword">extends</span> <span class="title">Animation</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCenterWidth;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCenterHeight;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> parentWidth, <span class="keyword">int</span> parentHeight)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.initialize(width, height, parentWidth, parentHeight);</div><div class="line">        setDuration(<span class="number">1000</span>);<span class="comment">// 设置默认时长</span></div><div class="line">        setFillAfter(<span class="keyword">true</span>);<span class="comment">// 动画结束后保留状态</span></div><div class="line">        setInterpolator(<span class="keyword">new</span> AccelerateInterpolator());<span class="comment">// 设置默认插值器</span></div><div class="line">        mCenterWidth = width / <span class="number">2</span>;</div><div class="line">        mCenterHeight = height / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">(<span class="keyword">float</span> interpolatedTime, Transformation t)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Matrix matrix = t.getMatrix();</div><div class="line">        matrix.preScale(<span class="number">1</span>, <span class="number">1</span> - interpolatedTime, mCenterWidth, mCenterHeight);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>applyTransformation方法的第一个参数interpolatedTime是插值器的时间因子,取值在0到1之间;<br>第二个参数Transformation是矩阵的封装类,一般使用它来获得当前的矩阵Matrix对,然后对矩阵进行操作,就可以实现动画效果了。</p>
<p>如何实现3D动画效果呢？<br>使用android.graphics.Camera中的Camera类,它封装了OpenGL的3D动画。可以把Camera想象成一个真实的摄像机,<br>当物体固定在某处时,只要移动摄像机就能拍摄到具有立体感的图像,因此通过它可以实现各种3D效果。<br>下面是一个3D动画效果的例子<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAnim</span> <span class="keyword">extends</span> <span class="title">Animation</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCenterWidth;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mCenterHeight;</div><div class="line">    <span class="keyword">private</span> Camera mCamera = <span class="keyword">new</span> Camera();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mRotateY = <span class="number">0.0f</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> parentWidth, <span class="keyword">int</span> parentHeight)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.initialize(width, height, parentWidth, parentHeight);</div><div class="line">        setDuration(<span class="number">2000</span>);<span class="comment">// 设置默认时长</span></div><div class="line">        setFillAfter(<span class="keyword">true</span>);<span class="comment">// 动画结束后保留状态</span></div><div class="line">        setInterpolator(<span class="keyword">new</span> BounceInterpolator());<span class="comment">// 设置默认插值器</span></div><div class="line">        mCenterWidth = width / <span class="number">2</span>;</div><div class="line">        mCenterHeight = height / <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 暴露接口-设置旋转角度</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRotateY</span><span class="params">(<span class="keyword">float</span> rotateY)</span> </span>&#123;</div><div class="line">        mRotateY = rotateY;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyTransformation</span><span class="params">( <span class="keyword">float</span> interpolatedTime, Transformation t)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Matrix matrix = t.getMatrix();</div><div class="line">        mCamera.save();</div><div class="line">        mCamera.rotateY(mRotateY * interpolatedTime);<span class="comment">// 使用Camera设置旋转的角度</span></div><div class="line">        mCamera.getMatrix(matrix);<span class="comment">// 将旋转变换作用到matrix上</span></div><div class="line">        mCamera.restore();</div><div class="line">        <span class="comment">// 通过pre方法设置矩阵作用前的偏移量来改变旋转中心</span></div><div class="line">        matrix.preTranslate(mCenterWidth, mCenterHeight);</div><div class="line">        matrix.postTranslate(-mCenterWidth, -mCenterHeight);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Android-5-X-SVG矢量动画机制"><a href="#Android-5-X-SVG矢量动画机制" class="headerlink" title="Android 5.X SVG矢量动画机制"></a>Android 5.X SVG矢量动画机制</h2><p>SVG是什么：</p>
<ul>
<li>可伸缩矢量图形(Scalable Vector Graphics)</li>
<li>定义用于网络的基于矢量的图形</li>
<li>使用xml格式定义图形</li>
<li>图像在放大或者改变尺寸的情况下其图形质量不会有损失</li>
<li>万维网联盟的标准</li>
<li>与诸如DOM和XSL之类的W3C标准是一个整体</li>
</ul>
<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a><path></path>标签</h3><p>使用<path></path>标签创建SVG,就像用指令的方式来控制一只画笔。标签所支持的指令有以下几种：</p>
<ul>
<li>M=moveto(M X,Y)：将画笔移动到指定的坐标位置,但未发生绘制。</li>
<li>L=lineto(L X,Y)：画直线到指定的坐标位置。</li>
<li>H=horizontal lineto(H X)：画水平线到指定的X坐标位置。</li>
<li>V=vertical lineto(V Y)：画水平线到指定的Y坐标位置。</li>
<li>C=curveto(C X1,Y1,X2,Y2,ENDX,ENDY)：三次贝塞尔曲线。</li>
<li>S=smooth curveto(S X2,Y2,ENDX,ENDY)：三次贝塞尔曲线。</li>
<li>Q=quadratic Belzier curve(Q X,Y,ENDX,ENDY)：二次贝塞尔曲线。</li>
<li>T=smooth quadratic Belzier curveto(T ENDX,ENDY)：映射前面路径后的终点。</li>
<li>A=elliptical Arc(A RX,RY,XROTATION,FLAG1,FLAG2,X,Y)：弧形。<br>RX、RY为半轴大小,XROTATION指椭圆的X轴水平方向顺时针方向夹角,FLAG1为1时表示大角度弧形,为0表小角度,<br>FLAG2为1时表顺时针,0位逆时针,X、Y为终点坐标。</li>
<li>Z=closepath()：关闭路径。</li>
</ul>
<p>注意：<br>坐标轴以(0,0)为中心,X轴水平向右,Y轴水平向下。<br>所有指令大小写均可。大写绝对定位,参照全局坐标系;小写相对定位,参照父容器坐标系。<br>指令和数据间的空格可以省略。<br>同一指令出现多次可以只用一个。</p>
<h3 id="SVG编辑器"><a href="#SVG编辑器" class="headerlink" title="SVG编辑器"></a>SVG编辑器</h3><p>书中介绍了个Inkscape,有兴趣的可以尝试下。<br>还有个<a href="http://editor.method.ac/" target="_blank" rel="external">在线的</a>。</p>
<h3 id="Android中使用SVG"><a href="#Android中使用SVG" class="headerlink" title="Android中使用SVG"></a>Android中使用SVG</h3><p>谷歌在Android 5.X中提供了VectorDrawable、AnimatedVectorDrawable来帮助支出SVG。</p>
<h4 id="VectorDrawable"><a href="#VectorDrawable" class="headerlink" title="VectorDrawable"></a>VectorDrawable</h4><p>直接在res/drawable下新建文件即可。在XML中创建静态的SVG图形,通常会形成SVG树形结构。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">vector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="attr">android:width</span>=<span class="string">"200dp"</span></div><div class="line"><span class="attr">android:height</span>=<span class="string">"200dp"</span>//控制<span class="attr">SVG</span>图形的具体大小,<span class="attr">height</span>与<span class="attr">width</span>的比例需和<span class="attr">viewportHeight</span>与<span class="attr">viewportWidth</span>的相同,不然会变形</div><div class="line"><span class="attr">android:viewportHeight</span>=<span class="string">"100"</span></div><div class="line"><span class="attr">android:viewportWidth</span>=<span class="string">"100"</span>&gt;//图形划分的比例,这里指划分100*100,绘制图形使用坐标（50,50）即为中心点</div><div class="line"> <span class="tag">&lt;<span class="name">group</span></span></div><div class="line">        <span class="attr">android:name</span>=<span class="string">"test"</span></div><div class="line">        <span class="attr">android:rotation</span>=<span class="string">"0"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">path</span></span></div><div class="line">            <span class="attr">android:fillColor</span>=<span class="string">"@color/colorAccent"</span></div><div class="line">            <span class="attr">android:pathData</span>=<span class="string">"M 25 50</span></div><div class="line">            a 25,25 0 1,0 50,0" /&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">path</span></span></div><div class="line">            <span class="attr">android:strokeColor</span>=<span class="string">"@color/colorAccent"</span></div><div class="line">            <span class="attr">android:strokeWidth</span>=<span class="string">"2"</span></div><div class="line">            <span class="attr">android:pathData</span>=<span class="string">"M 25 0</span></div><div class="line">            a 25,25 0 1,0 50,0" /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">group</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">vector</span>&gt;</span></div></pre></td></tr></table></figure>
<p>效果图如下:</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20160311142903.png" alt="效果图"></p>
<h4 id="AnimatedVectorDrawable"><a href="#AnimatedVectorDrawable" class="headerlink" title="AnimatedVectorDrawable"></a>AnimatedVectorDrawable</h4><p>AnimatedVectorDrawable就是给VectorDrawable提供动画效果,通过它来连接静态的VectorDrawable和动态的objectAnimator。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">animated-vector</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/vector_demo"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">target</span></span></div><div class="line">   <span class="attr">android:animation</span>=<span class="string">"@anim/anim"</span></div><div class="line">   <span class="attr">android:name</span>=<span class="string">"test"</span>/&gt;//这里的name需要和vectordrawable里的name一样</div><div class="line"><span class="tag">&lt;/<span class="name">animated-vector</span>&gt;</span></div></pre></td></tr></table></figure>
<p>动画代码如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">   <span class="attr">android:duration</span>=<span class="string">"3000"</span></div><div class="line">   <span class="attr">android:propertyName</span>=<span class="string">"rotation"</span>//<span class="attr">path</span>中的属性</div><div class="line">   <span class="attr">android:valueFrom</span>=<span class="string">"0"</span></div><div class="line">   <span class="attr">android:valueTo</span>=<span class="string">"360"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">objectAnimator</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>具体使用如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">((Animatable)imageView.getDrawable()).start();</div></pre></td></tr></table></figure></p>
<p>下面是几个综合实例的效果图：<br><img src="http://7xljei.com1.z0.glb.clouddn.com/svganim.gif" alt="效果图"></p>
<p>整个代码在SVGActivity.java中,这里不贴代码了。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/proanim.gif" alt="灵动菜单"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism.advancepropertyanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.AnimatorSet;</div><div class="line"><span class="keyword">import</span> android.animation.ObjectAnimator;</div><div class="line"><span class="keyword">import</span> android.animation.ValueAnimator;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.animation.BounceInterpolator;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> me.jarvischen.animationmechanism.MainActivity;</div><div class="line"><span class="keyword">import</span> me.jarvischen.animationmechanism.R;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdvancePropertyAnimActivity_demo</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] mRes = &#123;R.id.imageView_a, R.id.imageView_b, R.id.imageView_c,</div><div class="line">            R.id.imageView_d, R.id.imageView_e&#125;;</div><div class="line">    <span class="keyword">private</span> List&lt;ImageView&gt; mImageViews = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mFlag = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_advance_property_anim_activity_demo);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mRes.length; i++) &#123;</div><div class="line">            ImageView imageView = (ImageView) findViewById(mRes[i]);</div><div class="line">            imageView.setOnClickListener(<span class="keyword">this</span>);</div><div class="line">            mImageViews.add(imageView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tvTimer</span><span class="params">(<span class="keyword">final</span> View view)</span></span>&#123;</div><div class="line">        ValueAnimator valueAnimator = ValueAnimator.ofInt(<span class="number">0</span>, <span class="number">100</span>);</div><div class="line">        valueAnimator.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">                ((TextView)view).setText(animation.getAnimatedValue() + <span class="string">""</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        valueAnimator.setDuration(<span class="number">10000</span>);</div><div class="line">        valueAnimator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</div><div class="line">            <span class="keyword">case</span> R.id.imageView_a:</div><div class="line">                <span class="keyword">if</span> (mFlag) &#123;</div><div class="line">                    startAnim();</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    closeAnim();</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                Toast.makeText(AdvancePropertyAnimActivity_demo.<span class="keyword">this</span>, <span class="string">""</span> + v.getId(),</div><div class="line">                        Toast.LENGTH_SHORT).show();</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">closeAnim</span><span class="params">()</span> </span>&#123;</div><div class="line">        ObjectAnimator animator0 = ObjectAnimator.ofFloat(mImageViews.get(<span class="number">0</span>),</div><div class="line">                <span class="string">"alpha"</span>, <span class="number">0.5F</span>, <span class="number">1F</span>);</div><div class="line">        ObjectAnimator animator1 = ObjectAnimator.ofFloat(mImageViews.get(<span class="number">1</span>),</div><div class="line">                <span class="string">"translationY"</span>, <span class="number">200F</span>, <span class="number">0</span>);</div><div class="line">        ObjectAnimator animator2 = ObjectAnimator.ofFloat(mImageViews.get(<span class="number">2</span>),</div><div class="line">                <span class="string">"translationX"</span>, <span class="number">200F</span>, <span class="number">0</span>);</div><div class="line">        ObjectAnimator animator3 = ObjectAnimator.ofFloat(mImageViews.get(<span class="number">3</span>),</div><div class="line">                <span class="string">"translationY"</span>, -<span class="number">200F</span>, <span class="number">0</span>);</div><div class="line">        ObjectAnimator animator4 = ObjectAnimator.ofFloat(mImageViews.get(<span class="number">4</span>),</div><div class="line">                <span class="string">"translationX"</span>, -<span class="number">200F</span>, <span class="number">0</span>);</div><div class="line">        AnimatorSet set = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        set.setDuration(<span class="number">500</span>);</div><div class="line">        set.setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div><div class="line">        set.playTogether(animator0, animator1, animator2, animator3, animator4);</div><div class="line">        set.start();</div><div class="line">        mFlag = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startAnim</span><span class="params">()</span> </span>&#123;</div><div class="line">        ObjectAnimator animator0 = ObjectAnimator.ofFloat(</div><div class="line">                mImageViews.get(<span class="number">0</span>),</div><div class="line">                <span class="string">"alpha"</span>,</div><div class="line">                <span class="number">1F</span>,</div><div class="line">                <span class="number">0.5F</span>);</div><div class="line">        ObjectAnimator animator1 = ObjectAnimator.ofFloat(</div><div class="line">                mImageViews.get(<span class="number">1</span>),</div><div class="line">                <span class="string">"translationY"</span>,</div><div class="line">                <span class="number">200F</span>);</div><div class="line">        ObjectAnimator animator2 = ObjectAnimator.ofFloat(</div><div class="line">                mImageViews.get(<span class="number">2</span>),</div><div class="line">                <span class="string">"translationX"</span>,</div><div class="line">                <span class="number">200F</span>);</div><div class="line">        ObjectAnimator animator3 = ObjectAnimator.ofFloat(</div><div class="line">                mImageViews.get(<span class="number">3</span>),</div><div class="line">                <span class="string">"translationY"</span>,</div><div class="line">                -<span class="number">200F</span>);</div><div class="line">        ObjectAnimator animator4 = ObjectAnimator.ofFloat(</div><div class="line">                mImageViews.get(<span class="number">4</span>),</div><div class="line">                <span class="string">"translationX"</span>,</div><div class="line">                -<span class="number">200F</span>);</div><div class="line">        AnimatorSet set = <span class="keyword">new</span> AnimatorSet();</div><div class="line">        set.setDuration(<span class="number">500</span>);</div><div class="line">        set.setInterpolator(<span class="keyword">new</span> BounceInterpolator());</div><div class="line">        set.playTogether(</div><div class="line">                animator0,</div><div class="line">                animator1,</div><div class="line">                animator2,</div><div class="line">                animator3,</div><div class="line">                animator4);</div><div class="line">        set.start();</div><div class="line">        mFlag = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>布局：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView_b"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/b"</span></div><div class="line">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView_c"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/c"</span></div><div class="line">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView_d"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/d"</span></div><div class="line">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView_e"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/e"</span></div><div class="line">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/imageView_a"</span></div><div class="line">        <span class="attr">android:src</span>=<span class="string">"@drawable/a"</span></div><div class="line">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:textSize</span>=<span class="string">"60sp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"Click me."</span></div><div class="line">        <span class="attr">android:onClick</span>=<span class="string">"tvTimer"</span></div><div class="line">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/proanim.gif" alt="灵动菜单"></p>
<p>下拉菜单动画的实现。</p>
<p>思路是利用ValueAnimator去实现。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/propanimview.gif" alt="下拉菜单动画"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.jarvischen.animationmechanism.advancepropertyanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.animation.Animator;</div><div class="line"><span class="keyword">import</span> android.animation.AnimatorListenerAdapter;</div><div class="line"><span class="keyword">import</span> android.animation.ValueAnimator;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"></div><div class="line"><span class="keyword">import</span> me.jarvischen.animationmechanism.R;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyAnimDropViewActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> LinearLayout mHiddenView;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDensity;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mHiddenViewMeasuredHeight;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_property_anim_drop_view);</div><div class="line">        mHiddenView = (LinearLayout) findViewById(R.id.hidden_view);</div><div class="line">        <span class="comment">// 获取像素密度</span></div><div class="line">        mDensity = getResources().getDisplayMetrics().density;</div><div class="line">        <span class="comment">// 获取布局的高度</span></div><div class="line">        mHiddenViewMeasuredHeight = (<span class="keyword">int</span>) (mDensity * <span class="number">40</span> + <span class="number">0.5</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">llClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mHiddenView.getVisibility() == View.GONE) &#123;</div><div class="line">            <span class="comment">// 打开动画</span></div><div class="line">            animateOpen(mHiddenView);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 关闭动画</span></div><div class="line">            animateClose(mHiddenView);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">animateOpen</span><span class="params">(<span class="keyword">final</span> View view)</span> </span>&#123;</div><div class="line">        view.setVisibility(View.VISIBLE);</div><div class="line">        ValueAnimator animator = createDropAnimator(</div><div class="line">                view,</div><div class="line">                <span class="number">0</span>,</div><div class="line">                mHiddenViewMeasuredHeight);</div><div class="line">        animator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">animateClose</span><span class="params">(<span class="keyword">final</span> View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> origHeight = view.getHeight();</div><div class="line">        ValueAnimator animator = createDropAnimator(view, origHeight, <span class="number">0</span>);</div><div class="line">        animator.addListener(<span class="keyword">new</span> AnimatorListenerAdapter() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationEnd</span><span class="params">(Animator animation)</span> </span>&#123;</div><div class="line">                view.setVisibility(View.GONE);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        animator.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> ValueAnimator <span class="title">createDropAnimator</span><span class="params">(</span></span></div><div class="line">            <span class="keyword">final</span> View view, <span class="keyword">int</span> start, <span class="keyword">int</span> end) &#123;</div><div class="line">        ValueAnimator animator = ValueAnimator.ofInt(start, end);</div><div class="line">        animator.addUpdateListener(</div><div class="line">                <span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</div><div class="line"></div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator valueAnimator)</span> </span>&#123;</div><div class="line">                        <span class="keyword">int</span> value = (Integer) valueAnimator.getAnimatedValue();</div><div class="line">                        ViewGroup.LayoutParams layoutParams =</div><div class="line">                                view.getLayoutParams();</div><div class="line">                        layoutParams.height = value;</div><div class="line">                        view.setLayoutParams(layoutParams);</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">        <span class="keyword">return</span> animator;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></div><div class="line">        <span class="attr">android:onClick</span>=<span class="string">"llClick"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@android:color/holo_blue_bright"</span></div><div class="line">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/app_icon"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/icon"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"5dp"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"left"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"Click Me"</span></div><div class="line">            <span class="attr">android:textSize</span>=<span class="string">"30sp"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/hidden_view"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"40dp"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@android:color/holo_orange_light"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center_vertical"</span></div><div class="line">        <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span>&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/icon"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span> /&gt;</div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/tv_hidden"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">            <span class="attr">android:textSize</span>=<span class="string">"20sp"</span></div><div class="line">            <span class="attr">android:text</span>=<span class="string">"I am hidden"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="Activity与Activity调用栈分析"><a href="#Activity与Activity调用栈分析" class="headerlink" title="Activity与Activity调用栈分析"></a>Activity与Activity调用栈分析</h1><h2 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h2><p>Activity作为四大组件中出现频率最高的组件,我们在Android的各个地方都能看见它的影子。了解Activity,<br>对于开发高质量的应用是非常有益的。</p>
<h3 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h3><p>Activity是与用户交互的第一接口,它提供了一个用户完成指令的窗口。当开发者创建Activity之后,<br>通过调用setContentView(view)方法来给该Activity指定一个显示的界面,并以此为基础提供给用户交互的接口。<br>系统采用Activity栈的方式来管理Activity。</p>
<h3 id="Activity形态"><a href="#Activity形态" class="headerlink" title="Activity形态"></a>Activity形态</h3><p>Activity一个最大的特点就是拥有多种形态,它可以在多种形态间进行切换,以此来控制自己的生命周期。</p>
<ul>
<li><p>Active/Running<br>这时候,Activity出于Activity栈的最顶层,可见,并与用户进行交互。</p>
</li>
<li><p>Pause<br>当Activity失去焦点,被一个新的非全屏的Activity或者一个透明的Activity放置在栈顶时,Activity就转化为Paused形态。<br>但它只是失去了与用户交互的能力,所有状态信息、成员变量都还保持着,只有在系统内存极低的情况下,才会被系统回收掉。</p>
</li>
<li><p>Stopped<br>如果一个Activity被另一个Activity完全覆盖,那么Activity就会进入Stopped形态。此时,它不再可见,<br>但却依然保持了所有状态信息和成员变量。</p>
</li>
<li><p>Killed<br>当Activity被系统回收掉或者Activity从来没有创建过,Activity就出于Killed形态。</p>
</li>
</ul>
<p>由此可见,用户的不同动作,会让Activity在这四种状态间切换。而开发者,虽然可以控制Activity如何”生”,<br>却无法空着Activity何时”死”。</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>谷歌给了我们一张图来揭示Activity的生命周期,他希望Activity能被开发者所控制,而不是变成一匹脱缰的野马。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/0_1314838777He6C.gif" alt="生命周期"><br><img src="http://7xljei.com1.z0.glb.clouddn.com/basic-lifecycle.png" alt="生命周期"></p>
<p>开发者当然不必实现所有的生命周期方法,但知道每一个生命周期状态的含义,可以让我们更好的掌控Activity,<br>让它能更好地完成你所期望的效果。</p>
<p>上图中列举了Activity生命周期的全部状态,但其中只有三个状态是稳定的,而其他状态都是过渡状态,很快就会结束。</p>
<ul>
<li><p>Resume<br>这个状态,也就是上节中的Active/Running状态,此时,Activity出于Activity栈顶,处理用户的交互。</p>
</li>
<li><p>Paused<br>当Activity的一部分被挡住的时候进入这个状态,这个状态下的Activity不会接收用户输入。</p>
</li>
<li><p>Stopped<br>当Activity完全被覆盖时进入这个状态,此时Activity不可见,仅在后台运行。</p>
</li>
</ul>
<h3 id="Acticity的启动和销毁过程"><a href="#Acticity的启动和销毁过程" class="headerlink" title="Acticity的启动和销毁过程"></a>Acticity的启动和销毁过程</h3><p>Activity的启动和销毁过程： 在系统调用onCreate()之后,就会马上调用onStart(),然后继续调用onResume()<br>以进入Resumed状态,最后就会停在Resumed状态,完成启动。系统会调用onDestroy()来结束一个Activity的声明周期让它回到<br>Killed形态。</p>
<ul>
<li>onCreate()中：创建基本的UI元素。</li>
<li>onPause()与onStop()：清除Activity的资源、避免浪费。</li>
<li><p>onDestroy()中：因为引用会在Activity销毁的时候销毁,而线程不会,所以清除开启的线程。</p>
</li>
<li><p>启动: onCreate() -&gt; onStart() -&gt; onResume()</p>
</li>
<li>销毁: onPause() -&gt; onStop() -&gt; onDestroy()</li>
</ul>
<h3 id="Acticity的暂停与恢复过程"><a href="#Acticity的暂停与恢复过程" class="headerlink" title="Acticity的暂停与恢复过程"></a>Acticity的暂停与恢复过程</h3><p>Acticity的暂停与恢复过程: 当栈顶的Activity部分不可见后,就会导致Activity进入Pause状态,此时就会调用onPause()方法,<br>当结束阻塞后,就会调用onResume()方法来恢复到Resume状态。</p>
<ul>
<li>onPause()： 释放系统资源,如Camera、sensor、receivers。</li>
<li><p>onResume()： 需要重新初始化onPause()中释放的资源。</p>
</li>
<li><p>暂停：onResume() -&gt; onPause()</p>
</li>
<li>恢复：onPause() -&gt; onResume()</li>
</ul>
<h3 id="Activity的停止过程"><a href="#Activity的停止过程" class="headerlink" title="Activity的停止过程"></a>Activity的停止过程</h3><p>栈顶的Activity部分不可见时,实际上后续会有两可能,从部分不可见到部分可见,也就是恢复过程;从部分不可见到完全不可见,<br>也就是停止过程。</p>
<p>系统在当前Activity不可见的时候,总会调用onPause()方法。<br>系统在当前Activity由不可见到可见时,都会调用onStart()方法。</p>
<h3 id="Activity的重新创建过程"><a href="#Activity的重新创建过程" class="headerlink" title="Activity的重新创建过程"></a>Activity的重新创建过程</h3><p>如果你的系统长时间处于stopped状态而且此时系统需要更多内存或者系统内存极为紧张时,系统就会回收你的Activity,<br>而此时系统为了补偿你,会将Activity状态通过onSaveInstanceState()方法保存到Bundle对象中,当然你也可以增加额外的键值对<br>存入Bundle对象以保存这些状态。当你需要重新创建这些Activity的时候,保存的Bundle对象就会传递到Activity的onRestoreInstanceState()方法与onCreate()方法中,这也就是onCreate()方法中参数—Bundle savaedInstanceState的来源。</p>
<p>Activity重新创建过程:</p>
<ul>
<li>Resumed(visible) -&gt;onSavaInstanceState() -&gt; Destroyed</li>
<li>Created -&gt;onRestoreInstanceState() -&gt; Resumed(visible)</li>
</ul>
<p>不过这里需要注意的是onSaveInstanceState()方法并不是每次当Activity离开前台时都会调用的,如果用户使用finish()方法<br>结束了Acticity,则不会调用。而且Android系统已经默认实现类控件的状态缓存,以此来减少开发者需要实现的缓存逻辑。</p>
<h2 id="Android任务栈简介"><a href="#Android任务栈简介" class="headerlink" title="Android任务栈简介"></a>Android任务栈简介</h2><p>一个Android应用程序功能通常会被拆分为多个Activity,而各个Activity之间通过Intent进行连接,而Android系统,<br>通过栈结构来保存整个App的Activity,栈底的元素是整个任务栈的发起者。一个合理的任务调度栈不仅是性能的保证,<br>更是提供性能的基础。</p>
<p>当一个App启动时,如果当前环境中部存在该App的任务栈,那么系统就会创建一个任务栈。此后,这个App所启动的Acticity都将在<br>这个任务栈中被管理,这个栈也被称为一个Task,即表示若干个Activity的集合,他们组合在一起形成一个Task。<br>另外,需要特别注意的是,一个Task中的Activity可以来自不同的App,同一个App的Activity也肯能不在一个Task中。</p>
<p>根据Activity在当前栈结构的位置,来决定该Activity的状态。正常情况下的Android任务栈,当一个Activity启动了另一个<br>Activity的时候,新启动的Activity就会置于任务栈的顶端,并处于活动状态,而启动它的Activity虽然功成身退,但依然保留在<br>任务栈中,处于停止恢复活动状态,当用户按下返回键或者调用finish()方法时,系统会移除顶部Activity,<br>让后面的Activity恢复活动状态。</p>
<h2 id="Activity启动模式"><a href="#Activity启动模式" class="headerlink" title="Activity启动模式"></a>Activity启动模式</h2><p>当然,世界不可能一直这么”和谐”,可以给Activity设置一些”特权”,来打破这种”和谐”的模式。这种特权,<br>就是通过在AndroidManifest文件中的属性android:launchMode来设置或者是通过Intent的flag来设置的。</p>
<p>Android设计者在AndroidManifest文件中设计了四周启动模式</p>
<ul>
<li>standard</li>
<li>singleTop</li>
<li>singleTask</li>
<li>singleInstance</li>
</ul>
<h3 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h3><p>默认的启动模式,如果不指定Activity的启动模式,则使用这种方式启动Activity。这种启动模式每次都会创建新的实例,<br>每次点击standard模式创建Activity后,都会创建新的MainActivity覆盖在原Activity上。</p>
<h3 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h3><p>如果指定启动Activity为singleTop模式,那么在启动时,系统会判断当前栈顶Activity是不是要启动的Activity,<br>如果是则不创建新的Activity而直接引用这个Activity;如果不是则创建新的Activity。<br>这种启动模式通常适应于接收到消息后显示的界面,例如QQ接收到消息后弹出Acticity,如果一次来10条消息,<br>总不能一次弹出10个Activity。</p>
<p>这种启动模式虽然不会创建新的实例,但是系统仍然会在Activity启动时调用onNewIntent()方法。<br>例如：如果当前任务栈中有A、B、C三个Activity,而且C的启动模式是singleTop的,那么这时候如果再次启动C,<br>那么系统的就不会创建新的实例,而是会调用C的onNewIntent()方法,当前任务栈中依然是A、B、C三个Activity;<br>如果B的启动模式是singleTop的,那么这时候如果C启动的是B,则会创建一个全新的B,当前任务栈为A、B、C、B。</p>
<h3 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h3><p>采用该加载模式时,Activity在同一个Task内只有一个实例。</p>
<p>singleTask与singleTop模式类似,只不过singleTop是检测栈顶元素是否是需要启动的Activity,<br>而sigleTask是检测整个Activity栈中是否存在当前需要启动的Activity。如果存在,则将该Activity置于栈顶,<br>并将该Activity以上的Activity都销毁。</p>
<p>如果要启动的Activity不存在,那么系统将会创建该实例,并将其加入Task栈顶<br>如果将要启动的Activity已存在,且存在栈顶,那么此时与singleTop模式的行为相同<br>如果将要启动的Activity存在但是没有位于栈顶,那么此时系统会把位于该Activity上面的所有其他Activity全部移除Task,<br>从而使得该目标Activity位于栈顶。<br>上述是指在同一个App中启动这个singleTask的Activity,如果是其他程序以singleTask模式来启动Activity,<br>那么它将创建一个新的任务栈。需要注意的是,如果启动模式为singleTask的Activity已经在后台一个任务栈中了,<br>那么启动后,后台的这个任务栈将会一起被切换到前台,如下图所示。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/54b4b55d0001b4a705000281.jpg" alt="singleTask"></p>
<p>当Activity2启动ActivityY(启动模式为singleTask)时,它所在的Task都被切换到前台,且按返回键返回时,<br>也会先返回ActivityY所在Task的Activity。</p>
<p>可以发现,使用这个模式创建的Activity不是在新的任务栈中被打开,就是将已打开的Activity切换到前台,<br>所以这种启动模式通常可以用来退出整个应用：将主Activity设为singleTask模式,然后在要退出的Activity中转到主Activity,<br>从而将主Activity之上的Activity都清除,然后重写主Activity的onNewIntent()方法,在方法中加入一句finish(),<br>将最后一个Activity结束掉。</p>
<h3 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h3><p>在该加载模式下,无论哪个Task中启动目标Activity,只会创建一个目标Acticity实例且会用一个全新的Task栈来装载该<br>Activity实例。</p>
<p>当系统采用singleInstance模式加载Activity时,分为以下两种情况：</p>
<ul>
<li><p>如果将要启动的Activity不存在,那么系统将会先创建一个全新的Task,再创建目标Activity实例并将该Activity实例放入此<br>全新的Task中。</p>
</li>
<li><p>如果将要启动的Activity已经存在,那么无论它位于哪个应用程序、哪个Task中,系统都会把该Acticity所在的Task转到前台,<br>从而使该Activity显示出来。<br>这种启动模式常用于需要与程序分离的界面,如在SetupWizard中调用紧急呼叫,就是使用这种启动模式。<br>例如闹铃提醒,将闹铃提醒与闹铃设置分离</p>
</li>
</ul>
<h2 id="Intent-Flag启动模式"><a href="#Intent-Flag启动模式" class="headerlink" title="Intent Flag启动模式"></a>Intent Flag启动模式</h2><p>系统提供两种方式来设置一个Activity的启动模式,下面要介绍的就是通过设置Intent的Flag来设置一个Activity的启动模式。</p>
<ul>
<li><p>Intent.FLAG_ACTIVITY_NEW_TASK<br>使用一个新的Task来启动一个Activity,但启动的每个Activity都将在一个新的Task中。该Flag通常使用在从Service中启动Activity的场景,由于在Service中并不存在Activity栈,所有使用该Flag来创建一个新的Activity栈,并创建新的Activity实例。</p>
</li>
<li><p>Intent.FLAG_ACTIVITY_SINGLE_TOP<br>使用singleTop模式来启动一个Activity,与制定android:lanchMode=”singleTop”效果相同。</p>
</li>
<li><p>Intent.FLAG_ACTIVITY_CLEAR_TOP<br>使用singleTask模式来启动一个Activity,与制定android:lanchMode=”singleTask”效果相同。</p>
</li>
<li><p>Intent.FLAG_ACTIVITY_NO_HISTORY<br>使用这种模式启动Activity,当该Acticity启动其他Activi后,该Activity就消失了,不会保留在Activity栈中,例如A-B,B中以这种模式启动C,C再启动D,则当前Activity栈为ABD。</p>
</li>
</ul>
<h2 id="清空任务栈"><a href="#清空任务栈" class="headerlink" title="清空任务栈"></a>清空任务栈</h2><p>系统提供了清楚任务栈的方法将一个Task全部清楚。通常情况下,可以在AndroidManifest文件中标签中使用以下几种属性来清理任务栈。</p>
<ul>
<li>clearTaskOnTouch</li>
</ul>
<p>clearTaskOnTouch,就是在每次返回该Activity时,都将该Activity之上的所有Activity清除。通过这个属性,可以让这个Task每次在初始化的时候,都只有这一个Activity。</p>
<ul>
<li>finishOnTaskLaunch</li>
</ul>
<p>finishOnTaskLaunch与clearTaskOnTouch属性类似,只不过clearTaskOnTouch作用在别人身上,而finishOnTaskLaunch作用在自己身上。通过这个属性,当离开这个Activity所处的Task,那么用户再返回时,该Activity就会被finish掉。</p>
<ul>
<li>alwaysRetainTaskState</li>
</ul>
<p>alwaysRetainTaskState属性给Task一道”免试金牌”,如果将Activity的这个属性设置为True,那么该Activity所在的Task将不接受任何清理命令,一直爆出当前Task状态。</p>
<h1 id="Android系统信息与安全机制"><a href="#Android系统信息与安全机制" class="headerlink" title="Android系统信息与安全机制"></a>Android系统信息与安全机制</h1><h2 id="获取系统信息"><a href="#获取系统信息" class="headerlink" title="获取系统信息"></a>获取系统信息</h2><ul>
<li><p>android.os.Build</p>
</li>
<li><p>SystemProperty</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemInfoActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> TextView tvBuild;</div><div class="line">    <span class="keyword">private</span> TextView sysTv;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_system_info);</div><div class="line">        tvBuild = (TextView) findViewById(R.id.tvBuild);</div><div class="line">        sysTv = (TextView) findViewById(R.id.sysTv);</div><div class="line">        initBuild();</div><div class="line">        initSysPro();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initSysPro</span><span class="params">()</span> </span>&#123;</div><div class="line">        String version = System.getProperty(<span class="string">"os.version"</span>);</div><div class="line">        String name = System.getProperty(<span class="string">"os.name"</span>);</div><div class="line">        String arch = System.getProperty(<span class="string">"os.arch"</span>);</div><div class="line">        String userHome = System.getProperty(<span class="string">"user.home"</span>);</div><div class="line">        String userName = System.getProperty(<span class="string">"user.name"</span>);</div><div class="line">        String userDir = System.getProperty(<span class="string">"user.dir"</span>);</div><div class="line">        String userTimezone = System.getProperty(<span class="string">"user.timezone"</span>);</div><div class="line">        String pathSeparator = System.getProperty(<span class="string">"path.separator"</span>);</div><div class="line">        String lineSeparator = System.getProperty(<span class="string">"line.separator"</span>);</div><div class="line">        String fileSeparator = System.getProperty(<span class="string">"file.separator"</span>);</div><div class="line">        String javaVendorUrl = System.getProperty(<span class="string">"java.vendor.url"</span>);</div><div class="line">        String javaClassPath = System.getProperty(<span class="string">"java.class.path"</span>);</div><div class="line">        String javaClassVersion = System.getProperty(<span class="string">"java.class.version"</span>);</div><div class="line">        String javaVendor = System.getProperty(<span class="string">"java.vendor"</span>);</div><div class="line">        String javaVersion = System.getProperty(<span class="string">"java.version"</span>);</div><div class="line">        String javaHome = System.getProperty(<span class="string">"java.home"</span>);</div><div class="line">        sysTv.setText(<span class="string">"-----------------------"</span> + <span class="string">"\n"</span> +</div><div class="line"></div><div class="line">        <span class="string">"OS版本:"</span> + version + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"OS名称:"</span> + name + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"OS架构:"</span> + arch + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"Home属性:"</span> + userHome + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"Name属性:"</span> + userName + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"Dir属性:"</span> + userDir + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"时区:"</span> + userTimezone + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"路径分隔符:"</span> + pathSeparator + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"行分隔符:"</span> + lineSeparator + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"文件分隔符:"</span> + fileSeparator + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"javaVendorUrl属性:"</span> + javaVendorUrl + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"javaClassPath路径:"</span> + javaClassPath + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"javaClass版本:"</span> + javaClassVersion + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"javaVendor属性:"</span> + javaVendor + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"Java版本:"</span> + javaVersion + <span class="string">"\n"</span> +</div><div class="line">        <span class="string">"JavaHome属性:"</span> + javaHome</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initBuild</span><span class="params">()</span> </span>&#123;</div><div class="line">        String board = Build.BOARD;</div><div class="line">        String brand = Build.BRAND;</div><div class="line">        String[] abis = Build.SUPPORTED_ABIS;</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; abis.length; i++) &#123;</div><div class="line">            sb.append(abis[i] + <span class="string">"\n"</span>);</div><div class="line">        &#125;</div><div class="line">        String device = Build.DEVICE;</div><div class="line">        String display = Build.DISPLAY;</div><div class="line">        String fingerprint = Build.FINGERPRINT;</div><div class="line">        String serial = Build.SERIAL;</div><div class="line">        String id = Build.ID;</div><div class="line">        String manufacturer = Build.MANUFACTURER;</div><div class="line">        String model = Build.MODEL;</div><div class="line">        String hardware = Build.HARDWARE;</div><div class="line">        String product = Build.PRODUCT;</div><div class="line">        String tags = Build.TAGS;</div><div class="line">        String type = Build.TYPE;</div><div class="line">        String codename = Build.VERSION.CODENAME;</div><div class="line">        String incremental = Build.VERSION.INCREMENTAL;</div><div class="line">        String release = Build.VERSION.RELEASE;</div><div class="line">        <span class="keyword">int</span> sdkInt = Build.VERSION.SDK_INT;</div><div class="line">        String host = Build.HOST;</div><div class="line">        String user = Build.USER;</div><div class="line">        <span class="keyword">long</span> time = Build.TIME;</div><div class="line">        tvBuild.setText(<span class="string">"android.os.Build获取的信息如下:\n"</span></div><div class="line">        +<span class="string">"主板:"</span> + board + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"系统定制商:"</span> + brand + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"CPU指令集:"</span> + sb.toString() + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"设备参数:"</span> + device + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"显示屏参数:"</span> + display + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"唯一编号:"</span> + fingerprint + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"硬件序列号:"</span> + serial + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"修订版本列表:"</span> + id + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"硬件制造商:"</span> + manufacturer + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"版本:"</span> + model + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"硬件名:"</span> + hardware + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"手机产品名:"</span> + product + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"描述Build的标签:"</span> + tags + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"Build的类型:"</span> + type + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"当前开发代号:"</span> + codename + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"源码控制版本号:"</span> + incremental + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"版本字符串:"</span> + release + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"版本号:"</span> + sdkInt + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"Host值:"</span> + host + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"User名:"</span> + user + <span class="string">"\n"</span></div><div class="line">        +<span class="string">"编译时间:"</span> + time + <span class="string">"\n"</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Apk应用信息"><a href="#Apk应用信息" class="headerlink" title="Apk应用信息"></a>Apk应用信息</h2><ul>
<li>PackageManager</li>
<li>ActivityManager</li>
</ul>
<p>在AndroidManifest文件中,Activity的信息是通过ActivityInfo类来封装的;整个Manifest文件中节点的信息是通过PackageInfo类来进行封装的;此外还有ServiceInfo、ApplicationInfo、ResolveInfo等。<br>其中ResolveInfo封装的是包含信息的上一级信息,所以它可以返回ActivityInfo、ServiceInfo等包含的信息,它经常用来帮助我们找到那些包含特定Intent条件的信息,如带分享功能、播放功能的应用。</p>
<p>PackageManager侧重于获取应用的包信息,而ActivityManager侧重于获取运行的应用程序的信息。<br>PackageManager常用的方法：<br>getPackageManger、getApplicationInfo、getApplicationIcon、getInstalledApplications、getInstalledPackages、queryIntentActivities、queryIntentServices、resolveActivity、resolveService等</p>
<p>ActivityManager封装了不少对象,每个对象都保存着一些重要信息。</p>
<ul>
<li>ActivityManager.MemoryInfo：关于系统内存的信息,例如availMem(系统可用内存)、totalMem(总内存)等;</li>
<li>Debug.MemoryInfo：该MemoryInfo主要用于统计进程下的内存信息;</li>
<li>RunningAppProceeInfo：运行进程的信息,存储的是与进程相关的信息,例如processName、pid、uid等;</li>
<li>RunningServiceInfo：运行服务的信息,存储的是服务进程的信息,例如activeSince(第一次被激活时间)等。</li>
</ul>
<h2 id="packages-xml文件-位于-data-system目录下"><a href="#packages-xml文件-位于-data-system目录下" class="headerlink" title="packages.xml文件(位于/data/system目录下)"></a>packages.xml文件(位于/data/system目录下)</h2><p>在系统初始化的时候,PackageManager的底层实现类PackageManagerService会去扫描系统中的一些特定的目录,并解析其中的apk文件,最后把它获得的应用信息保存到packages.xml文件中,当系统中的应用安装、删除或者升级时,它也会被更新。</p>
<h2 id="Android安全机制"><a href="#Android安全机制" class="headerlink" title="Android安全机制"></a>Android安全机制</h2><p>五道防线：</p>
<ul>
<li>代码安全机制——代码混淆proguard</li>
<li>应用接入权限机制——AndroidManifest文件权限声明、权限检查机制<br>系统检查操作者权限的顺序：首先,判断permission名称,如果为空则直接返回PERMISSION_DENIED;其次,判断Uid,如果uid为0或者为System Service的uid,不做权限控制,如果uid与参数中的请求uid不同,那么返回PERMISSION_DENIED;最后,通过调用PackageManagerService.checkUidPermission方法判断该uid是否具有相应的权限,该方法会去xml的权限列表和系统级的platform.xml中进行查找。</li>
<li>应用签名机制——数字证书：系统不会安装没有签名的app,只有拥有相同数字签名的app才会在升级时被认为是同一个app</li>
<li>Linux内核层安全机制——Uid、访问权限控制</li>
<li>Android虚拟机沙箱机制——沙箱隔离：每个app运行在单独的虚拟机中,与其他应用完全隔离</li>
</ul>
<h2 id="apk反编译"><a href="#apk反编译" class="headerlink" title="apk反编译"></a>apk反编译</h2><p>使用apktool、dex2jar、jd-gui三个工具反编译查看应用源码</p>
<h2 id="apk加密"><a href="#apk加密" class="headerlink" title="apk加密"></a>apk加密</h2><p>proguard不仅可以用来混淆代码（用无意义的字母来重命名类、方法和属性等）,还可以删除无用的类、字段、方法和属性,以及删除无用的注释,最大限度地优化字节码文件。<br>下面是常见的proguard配置,其中minifyEnabled属性控制是否启动proguard;proguardFiles属性用于配置混淆文件,它分为两部分,一个是系统默认的混淆文件,它位于<sdk>/tools/proguard/proguard-android.txt;另一个是自定义的混淆文件,可以在项目的app文件夹下找到该文件,在该文件中定义引入的第三方依赖包的混淆规则。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">buildTypes &#123;</div><div class="line">    release &#123;</div><div class="line">        minifyEnabled false</div><div class="line">        proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></sdk></p>
<h1 id="Android性能优化"><a href="#Android性能优化" class="headerlink" title="Android性能优化"></a>Android性能优化</h1><h2 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h2><p>人眼感觉的流畅需要画面的帧数达到每秒40帧到60帧,那么差不多每16ms系统就要对UI进行渲染和重绘。<br>(1)android系统提供了检测UI渲染时间的工具,”开发者选项”-“Profile GPU rendering”-“On screen as bars”,这个时候屏幕上将显示一些条形图,如下左图所示,每条柱状线都包含三部分,蓝色代表测量绘制Display List的时间,红色代表OpenGL渲染Display List所需要的时间,黄色代表CPU等待GPU处理的时间。中间的绿色横线代表VSYNC时间16ms,需要尽量将所有条形图都控制在这条绿线之下。<br>(2)过度绘制（Overdraw）也是很浪费CPU/GPU资源的,系统也提供了检测工具Debug GPU Overdraw来查看界面overdraw的情况。该工具会使用不同的颜色绘制屏幕,来指示overdraw发生在哪里以及程度如何,其中：<br>没有颜色： 意味着没有overdraw。像素只画了一次。</p>
<p>蓝色： 意味着overdraw 1倍。像素绘制了两次。大片的蓝色还是可以接受的（若整个窗口是蓝色的,可以摆脱一层）。<br>绿色： 意味着overdraw 2倍。像素绘制了三次。中等大小的绿色区域是可以接受的但你应该尝试优化、减少它们。<br>浅红： 意味着overdraw 3倍。像素绘制了四次,小范围可以接受。<br>暗红： 意味着overdraw 4倍。像素绘制了五次或者更多。这是错误的,要修复它们。</p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/androidheros_gpu.png" alt="androidheros_gpu"></p>
<p><img src="http://7xljei.com1.z0.glb.clouddn.com/androidheros_overdraw.png" alt="androidheros_overdraw"></p>
<p>(3)优化布局层级,Google在文档中建议View树的高度不宜超过10层<br>避免嵌套过多无用布局：</p>
<ul>
<li>使用标签重用layout<br>如果需要在标签中覆盖类似原布局中的android:layout_xxx的属性,就必须在标签中同时指定android:layout_width和android:layout_height属性。</li>
<li>使用实现view的延迟加载<br>ViewStub是一个非常轻量级的组件,它不仅不可见,而且大小为0。<br>ViewStub和View.GONE有啥区别?<br>它们的共同点是初始时都不会显示,但是前者只会在显示时才去渲染整个布局,而后者在初始化布局树的时候就已经添加到布局树上了,相比之下前者的布局具有更高的效率。</li>
</ul>
<p>(4)Hierarchy Viewer：查看视图树的工具</p>
<h2 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h2><p>通常情况下我们所说的内存是指手机的RAM,它包括以下几部分：</p>
<ul>
<li>寄存器：寄存器处于CPU内部,在程序中无法控制;</li>
<li>栈：存放基本数据类型和对象的引用;</li>
<li>堆：存放对象和数组,有虚拟机GC来管理;</li>
<li>静态存储区域(static field)：在固定的位置存放应用程序运行时一直存在的数据,Java在内存中专门划分了一个静态存储区域来管理一些特殊的数据变量,如静态的数据变量;</li>
<li>常量池(constant pool)：虚拟机必须为每个被装在的类维护一个常量池,常量池就是这个类所用的常量的一个有序集合,包括直接常量（基本类型、string）和对其他类型、字段和方法的符号引用。</li>
</ul>
<p>内存优化实例</p>
<ul>
<li>Bitmap优化</li>
</ul>
<blockquote>
<ul>
<li>使用适当分辨率和大小的图片;</li>
<li>及时回收内存：从Android 3.0开始,Bitmap被放置到了堆中,其内存由GC管理,所以不用手动调用bitmap.recycle()方法进行释放了;</li>
<li>使用图片缓存：设计内存缓存和磁盘缓存可以更好地利用Bitmap。</li>
</ul>
</blockquote>
<ul>
<li>代码优化</li>
</ul>
<blockquote>
<ul>
<li>使用静态方法,它比普通方法会提高15%左右的访问速度;</li>
<li>尽量不要使用枚举,少用迭代器;[我还不知道为什么]</li>
<li>对Cursor、Receiver、Sensor、File等对象,要非常注意对它们的创建、回收与注册、解注册;</li>
<li>使用SurfaceView来替代view进行大量的、频繁的绘图操作;</li>
<li>尽量使用视图缓存,而不是每次都执行inflate方法解析视图。</li>
</ul>
</blockquote>
<h2 id="其他的辅助工具"><a href="#其他的辅助工具" class="headerlink" title="其他的辅助工具"></a>其他的辅助工具</h2><blockquote>
<ul>
<li>Lint工具：代码提示工具,可以用来发现代码中隐藏的一些问题</li>
<li>Memory Monitor工具：内存监视工具</li>
<li>TraceView工具：可视化性能调查工具,它用来分析TraceView日志</li>
<li>MAT工具：内存分析工具</li>
<li>dumpsys命令：该命令可以列出android系统相关的信息和服务状态,可使用的配置参数很多,常见的有：</li>
</ul>
</blockquote>
<ul>
<li>activity：显示所有Activity栈的信息;</li>
<li>meminfo：显示内存信息;</li>
<li>battery：显示电池信息;</li>
<li>package：显示包信息;</li>
<li>wifi：显示wifi信息;</li>
<li>alarm：显示alarm信息;</li>
<li>procstats：显示内存状态。</li>
</ul>

    
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="techrecord/Android群英传读书笔记.html"
           data-title="Android群英传读书笔记" data-url="http://chenfuduo.cn/techrecord/Android群英传读书笔记.html">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xljei.com1.z0.glb.clouddn.com/wow.png"
               alt="chenfuduo" />
          <p class="site-author-name" itemprop="name">chenfuduo</p>
          <p class="site-description motion-element" itemprop="description">梦里花落知多少。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">3</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/leerduo" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/duoduoustc" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.vogella.com/tutorials/android.html" title="Vogella" target="_blank">Vogella</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenfuduo</span>
   <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
</div>





        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"chenfuduo"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("VSqPcBEsvXA3geFARgDcrESG-gzGzoHsz", "czrXTwyStUFW7FeG3mI4l7Kk");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.0"></script>



</body>
</html>
